[{"filePath":"C:\\Sigtapsync\\SigtapSync\\src\\components\\MedicalProductionDashboard.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":172,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":172,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6965,6968],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6965,6968],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":260,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10234,10237],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10234,10237],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":269,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":269,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10561,10564],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10561,10564],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":273,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":273,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10861,10864],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10861,10864],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":274,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":274,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10918,10921],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10918,10921],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10985,10988],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10985,10988],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":275,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":275,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11004,11007],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11004,11007],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":281,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":281,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11206,11209],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11206,11209],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":295,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":295,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11770,11773],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11770,11773],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":296,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":296,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11898,11901],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11898,11901],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":329,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13646,13649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13646,13649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":329,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":329,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13671,13674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13671,13674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":330,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13732,13735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13732,13735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":330,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":330,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[13772,13775],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[13772,13775],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":338,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":338,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14119,14122],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14119,14122],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":358,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":358,"endColumn":22,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[15160,15161],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":382,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16081,16084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16081,16084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":382,"column":112,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":382,"endColumn":115,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16170,16173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16170,16173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":383,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":383,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16196,16199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16196,16199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":397,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":397,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16831,16834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16831,16834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":401,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":401,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[16993,16996],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[16993,16996],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":401,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":401,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17001,17004],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17001,17004],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":410,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":410,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[17489,17492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[17489,17492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":460,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":460,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20144,20147],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20144,20147],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":520,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":520,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22222,22225],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22222,22225],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'runDiagnostic'. Either include it or remove the dependency array.","line":536,"column":6,"nodeType":"ArrayExpression","endLine":536,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [runDiagnostic]","fix":{"range":[22648,22650],"text":"[runDiagnostic]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":653,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":653,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27992,27995],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27992,27995],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":655,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":655,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[28163,28166],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[28163,28166],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":692,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":692,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29279,29282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29279,29282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":762,"column":65,"nodeType":"BlockStatement","messageId":"unexpected","endLine":762,"endColumn":68,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[33189,33190],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":771,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":771,"endColumn":16,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[33745,33746],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":791,"column":74,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":791,"endColumn":77,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[34805,34808],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[34805,34808],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'excludedByDateFilter' is never reassigned. Use 'const' instead.","line":819,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":819,"endColumn":31,"fix":{"range":[35724,35752],"text":"const excludedByDateFilter = 0"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":822,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":822,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[35907,35910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[35907,35910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":825,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":825,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[36092,36095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[36092,36095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":843,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":843,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37205,37208],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37205,37208],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":844,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":844,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[37330,37333],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[37330,37333],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":853,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":853,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[38170,38173],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[38170,38173],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":907,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":907,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40415,40418],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40415,40418],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":915,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":915,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40901,40904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40901,40904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":916,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":916,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[40957,40960],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[40957,40960],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":933,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":933,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[41983,41986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[41983,41986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":954,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":954,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43094,43097],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43094,43097],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":957,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":957,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43279,43282],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43279,43282],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":968,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":968,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[43976,43979],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[43976,43979],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":972,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":972,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[44336,44339],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[44336,44339],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":982,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":982,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45385,45388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45385,45388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":987,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":987,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45768,45771],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45768,45771],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":988,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":988,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[45824,45827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[45824,45827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1005,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1005,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[46841,46844],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[46841,46844],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1023,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1023,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47843,47846],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47843,47846],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1026,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1026,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[47990,47993],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[47990,47993],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1028,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1028,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48117,48120],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48117,48120],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1031,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1031,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[48315,48318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[48315,48318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1044,"column":94,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1044,"endColumn":97,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[49240,49243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[49240,49243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1079,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1079,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[51917,51920],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[51917,51920],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1081,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1081,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[52212,52215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[52212,52215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'generateConferencePatientsReport', 'generateGeneralPatientsReport', 'generateSimplifiedPatientsReport', 'selectedCompetencia', 'selectedHospitals', and 'useSihSource'. Either include them or remove the dependency array.","line":1111,"column":6,"nodeType":"ArrayExpression","endLine":1111,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [filteredDoctors, generateConferencePatientsReport, generateGeneralPatientsReport, generateSimplifiedPatientsReport, selectedCompetencia, selectedHospitals, useSihSource]","fix":{"range":[53960,53977],"text":"[filteredDoctors, generateConferencePatientsReport, generateGeneralPatientsReport, generateSimplifiedPatientsReport, selectedCompetencia, selectedHospitals, useSihSource]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1113,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1113,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54032,54035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54032,54035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1119,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1119,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[54304,54307],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[54304,54307],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1142,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1142,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[55436,55439],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[55436,55439],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1159,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1159,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[56255,56258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[56255,56258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1170,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1170,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[56727,56728],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"prefer-const","severity":2,"message":"'nameByAih' is never reassigned. Use 'const' instead.","line":1186,"column":11,"nodeType":"Identifier","messageId":"useConst","endLine":1186,"endColumn":20,"fix":{"range":[57438,57479],"text":"const nameByAih = new Map<string, string>()"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1205,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1205,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58594,58597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58594,58597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1212,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1212,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[58987,58990],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[58987,58990],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1219,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1219,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59369,59372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59369,59372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1225,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1225,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[59636,59637],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1229,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1229,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[59754,59757],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[59754,59757],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1241,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1241,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60369,60372],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60369,60372],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1242,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1242,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60500,60503],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60500,60503],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1245,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1245,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60795,60798],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60795,60798],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1245,"column":122,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1245,"endColumn":125,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60866,60869],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60866,60869],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1245,"column":130,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1245,"endColumn":133,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[60874,60877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[60874,60877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1249,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1249,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61051,61054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61051,61054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1249,"column":85,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1249,"endColumn":88,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61092,61095],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61092,61095],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1249,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1249,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61103,61106],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61103,61106],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1253,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1253,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61350,61353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61350,61353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1260,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1260,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61825,61828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61825,61828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1261,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1261,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61956,61959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61956,61959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1261,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1261,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[61964,61967],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[61964,61967],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1270,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1270,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[62498,62501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[62498,62501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1290,"column":19,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1290,"endColumn":22,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[63915,63916],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1328,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1328,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[66059,66062],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[66059,66062],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1332,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1332,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[66237,66240],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[66237,66240],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1332,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1332,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[66245,66248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[66245,66248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1341,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1341,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[66753,66756],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[66753,66756],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1432,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1432,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[70562,70563],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1533,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1533,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[75128,75131],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[75128,75131],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchSihRemoteTotals' and 'remoteConfigured'. Either include them or remove the dependency array.","line":1598,"column":6,"nodeType":"ArrayExpression","endLine":1598,"endColumn":60,"suggestions":[{"desc":"Update the dependencies array to be: [useSihSource, selectedHospitals, selectedCompetencia, remoteConfigured, fetchSihRemoteTotals]","fix":{"range":[78294,78348],"text":"[useSihSource, selectedHospitals, selectedCompetencia, remoteConfigured, fetchSihRemoteTotals]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1677,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1677,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[81681,81684],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[81681,81684],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1690,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1690,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82243,82246],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82243,82246],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1691,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1691,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82301,82304],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82301,82304],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1695,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1695,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82445,82448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82445,82448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1697,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1697,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82558,82561],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82558,82561],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1698,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1698,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82630,82633],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82630,82633],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1702,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1702,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82738,82741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82738,82741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1703,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1703,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82801,82804],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82801,82804],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1704,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1704,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[82874,82877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[82874,82877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":1728,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":1728,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[84018,84021],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[84018,84021],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2058,"column":76,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2058,"endColumn":79,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[100193,100194],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2067,"column":76,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2067,"endColumn":79,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[100644,100645],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2088,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2088,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[101623,101626],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[101623,101626],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2089,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2089,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[101717,101720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[101717,101720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2145,"column":170,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2145,"endColumn":173,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[104907,104910],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[104907,104910],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2151,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2151,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[105195,105198],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[105195,105198],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2179,"column":74,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2179,"endColumn":77,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[106456,106457],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'dischargeDateRange', 'patientSearchTerm', and 'searchTerm'. Either include them or remove the dependency array.","line":2184,"column":6,"nodeType":"ArrayExpression","endLine":2184,"endColumn":188,"suggestions":[{"desc":"Update the dependencies array to be: [user, canAccessAllHospitals, hasFullAccess, selectedHospitals, refreshTick, selectedCompetencia, filterCareCharacter, dischargeDateRange.from, dischargeDateRange.to, useSihSource, dischargeDateRange, searchTerm, patientSearchTerm]","fix":{"range":[106508,106690],"text":"[user, canAccessAllHospitals, hasFullAccess, selectedHospitals, refreshTick, selectedCompetencia, filterCareCharacter, dischargeDateRange.from, dischargeDateRange.to, useSihSource, dischargeDateRange, searchTerm, patientSearchTerm]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2192,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2192,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[106994,106997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[106994,106997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2211,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2211,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[107736,107739],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[107736,107739],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2216,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2216,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[107972,107973],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2223,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2223,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[108378,108381],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[108378,108381],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2228,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2228,"endColumn":20,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[108614,108615],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2235,"column":54,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2235,"endColumn":57,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[108902,108903],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2258,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2258,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[109630,109631],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2281,"column":77,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2281,"endColumn":80,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[111012,111015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[111012,111015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'patientSearchTerm'. Either include it or remove the dependency array.","line":2374,"column":6,"nodeType":"ArrayExpression","endLine":2374,"endColumn":104,"suggestions":[{"desc":"Update the dependencies array to be: [debouncedSearchTerm, debouncedPatientSearchTerm, selectedCompetencia, doctors, selectedHospitals, patientSearchTerm]","fix":{"range":[115388,115486],"text":"[debouncedSearchTerm, debouncedPatientSearchTerm, selectedCompetencia, doctors, selectedHospitals, patientSearchTerm]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2402,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2402,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[116469,116472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[116469,116472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2439,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2439,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[117834,117837],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[117834,117837],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'name' is never reassigned. Use 'const' instead.","line":2444,"column":13,"nodeType":"Identifier","messageId":"useConst","endLine":2444,"endColumn":17,"fix":{"range":[118112,118158],"text":"const name = p?.patient_info?.name || 'Paciente'"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2446,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2446,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[118238,118241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[118238,118241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2448,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2448,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[118377,118380],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[118377,118380],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2449,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2449,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[118508,118511],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[118508,118511],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2449,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2449,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[118516,118519],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[118516,118519],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2457,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2457,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[118975,118978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[118975,118978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2470,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2470,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[119959,119962],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[119959,119962],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2471,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2471,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[120137,120140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[120137,120140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2481,"column":13,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2481,"endColumn":16,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[120637,120638],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2489,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2489,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[121036,121039],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[121036,121039],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2520,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2520,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[122239,122242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[122239,122242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'entry' is never reassigned. Use 'const' instead.","line":2523,"column":15,"nodeType":"Identifier","messageId":"useConst","endLine":2523,"endColumn":20,"fix":{"range":[122362,122465],"text":"const entry = { sum: 0, name: doctor.doctor_info.name || '', cboSet: new Set<string>(), isAnesth: false }"}},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useMemo has missing dependencies: 'dedupeReport.assignmentMap' and 'dischargeDateRange'. Either include them or remove the dependency array.","line":2671,"column":6,"nodeType":"ArrayExpression","endLine":2671,"endColumn":64,"suggestions":[{"desc":"Update the dependencies array to be: [doctors, useSihSource, remoteConfigured, sihRemoteTotals, dedupeReport.assignmentMap, dischargeDateRange]","fix":{"range":[128863,128921],"text":"[doctors, useSihSource, remoteConfigured, sihRemoteTotals, dedupeReport.assignmentMap, dischargeDateRange]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2690,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2690,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[129711,129714],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[129711,129714],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2702,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2702,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[130326,130329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[130326,130329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2745,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2745,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[131941,131944],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[131941,131944],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2746,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2746,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[131994,131997],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[131994,131997],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":2821,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":2821,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[135229,135230],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useMemo has missing dependencies: 'dischargeDateRange' and 'useSihSource'. Either include them or remove the dependency array.","line":2827,"column":6,"nodeType":"ArrayExpression","endLine":2827,"endColumn":51,"suggestions":[{"desc":"Update the dependencies array to be: [filteredDoctors, dedupeReport.assignmentMap, dischargeDateRange, useSihSource]","fix":{"range":[135404,135449],"text":"[filteredDoctors, dedupeReport.assignmentMap, dischargeDateRange, useSihSource]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2862,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2862,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[136673,136676],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[136673,136676],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook React.useCallback has missing dependencies: 'filterCareCharacter' and 'remoteConfigured'. Either include them or remove the dependency array.","line":2923,"column":6,"nodeType":"ArrayExpression","endLine":2923,"endColumn":60,"suggestions":[{"desc":"Update the dependencies array to be: [useSihSource, remoteConfigured, selectedHospitals, selectedCompetencia, filterCareCharacter]","fix":{"range":[138810,138864],"text":"[useSihSource, remoteConfigured, selectedHospitals, selectedCompetencia, filterCareCharacter]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2935,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2935,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[139368,139371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[139368,139371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2942,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2942,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[139864,139867],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[139864,139867],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":2974,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":2974,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[141346,141349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[141346,141349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3094,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3094,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[146829,146832],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[146829,146832],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3098,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3098,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[147055,147058],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[147055,147058],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3099,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3099,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[147124,147127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[147124,147127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3123,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3123,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[148199,148202],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[148199,148202],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3124,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3124,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[148293,148296],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[148293,148296],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3137,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3137,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[148928,148931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[148928,148931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3138,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3138,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[148988,148991],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[148988,148991],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'doctorStatsCache' and 'remoteConfigured'. Either include them or remove the dependency array.","line":3176,"column":6,"nodeType":"ArrayExpression","endLine":3176,"endColumn":97,"suggestions":[{"desc":"Update the dependencies array to be: [filteredDoctors, selectedHospitals, availableHospitals, selectedCompetencia, useSihSource, remoteConfigured, doctorStatsCache]","fix":{"range":[150728,150819],"text":"[filteredDoctors, selectedHospitals, availableHospitals, selectedCompetencia, useSihSource, remoteConfigured, doctorStatsCache]"}}]},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":3383,"column":64,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":3383,"endColumn":128},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":3385,"column":31,"nodeType":"BlockStatement","messageId":"unexpected","endLine":3385,"endColumn":34,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[159744,159745],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3558,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3558,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[167572,167575],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[167572,167575],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3563,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3563,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[167937,167940],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[167937,167940],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-constant-condition","severity":2,"message":"Unexpected constant condition.","line":3567,"column":31,"nodeType":"Literal","messageId":"unexpected","endLine":3567,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3618,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3618,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[171060,171063],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[171060,171063],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3625,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3625,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[171643,171646],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[171643,171646],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":3628,"column":71,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":3628,"endColumn":72,"suggestions":[{"messageId":"removeEscape","fix":{"range":[171897,171898],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[171897,171897],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3724,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3724,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[176646,176649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[176646,176649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'excludedByDateFilter' is never reassigned. Use 'const' instead.","line":3787,"column":27,"nodeType":"Identifier","messageId":"useConst","endLine":3787,"endColumn":47,"fix":{"range":[179774,179803],"text":"const excludedByDateFilter = 0;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3797,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3797,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[180411,180414],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[180411,180414],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3802,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3802,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[180782,180785],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[180782,180785],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3826,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3826,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[182315,182318],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[182315,182318],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3888,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3888,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[185560,185563],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[185560,185563],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3948,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3948,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[188646,188649],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[188646,188649],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'excludedByEmptyAIH' is never reassigned. Use 'const' instead.","line":3951,"column":27,"nodeType":"Identifier","messageId":"useConst","endLine":3951,"endColumn":45,"fix":{"range":[188785,188812],"text":"const excludedByEmptyAIH = 0;"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3960,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3960,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[189361,189364],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[189361,189364],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":3966,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":3966,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[189836,189839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[189836,189839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-constant-condition","severity":2,"message":"Unexpected constant condition.","line":3970,"column":31,"nodeType":"Literal","messageId":"unexpected","endLine":3970,"endColumn":36},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4002,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4002,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[191710,191713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[191710,191713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4025,"column":110,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4025,"endColumn":113,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[193303,193306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[193303,193306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4048,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4048,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[194420,194423],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[194420,194423],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4049,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4049,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[194489,194492],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[194489,194492],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4051,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4051,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[194635,194638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[194635,194638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4115,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4115,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[198155,198158],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[198155,198158],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4386,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4386,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[214995,214998],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[214995,214998],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4548,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4548,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[227215,227218],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[227215,227218],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-constant-condition","severity":2,"message":"Unexpected constant condition.","line":4550,"column":49,"nodeType":"Literal","messageId":"unexpected","endLine":4550,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4582,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4582,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[229611,229614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[229611,229614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4583,"column":123,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4583,"endColumn":126,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[229821,229824],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[229821,229824],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4588,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4588,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[230239,230242],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[230239,230242],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4680,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4680,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[236221,236224],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[236221,236224],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4703,"column":86,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4703,"endColumn":89,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[237973,237976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[237973,237976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4708,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4708,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[238498,238501],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[238498,238501],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4718,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4718,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[239423,239426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[239423,239426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'approvedSet' is never reassigned. Use 'const' instead.","line":4770,"column":47,"nodeType":"Identifier","messageId":"useConst","endLine":4770,"endColumn":58,"fix":{"range":[243324,243360],"text":"const approvedSet = new Set<string>();"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4773,"column":56,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4773,"endColumn":59,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[243557,243560],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[243557,243560],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4805,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4805,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[246404,246407],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[246404,246407],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4841,"column":79,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4841,"endColumn":82,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[249081,249084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[249081,249084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-constant-condition","severity":2,"message":"Unexpected constant condition.","line":4844,"column":49,"nodeType":"Literal","messageId":"unexpected","endLine":4844,"endColumn":54},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4863,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4863,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[250426,250429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[250426,250429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4863,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4863,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[250437,250440],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[250437,250440],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4867,"column":58,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4867,"endColumn":61,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[250831,250834],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[250831,250834],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4888,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4888,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[252761,252764],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[252761,252764],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4892,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4892,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[253083,253086],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[253083,253086],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4892,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4892,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[253091,253094],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[253091,253094],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":4901,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":4901,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[253923,253926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[253923,253926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":4982,"column":51,"nodeType":"BlockStatement","messageId":"unexpected","endLine":4982,"endColumn":54,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[259798,259799],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5105,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5105,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[268670,268673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[268670,268673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-constant-binary-expression","severity":2,"message":"Unexpected constant truthiness on the left-hand side of a `&&` expression.","line":5145,"column":38,"nodeType":"Literal","messageId":"constantShortCircuit","endLine":5145,"endColumn":43},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5177,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5177,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[274240,274243],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[274240,274243],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5183,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5183,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[274615,274618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[274615,274618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":5222,"column":93,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":5222,"endColumn":94,"suggestions":[{"messageId":"removeEscape","fix":{"range":[277728,277729],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[277728,277728],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":5296,"column":53,"nodeType":"BlockStatement","messageId":"unexpected","endLine":5296,"endColumn":56,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[283009,283010],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5410,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5410,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[290747,290750],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[290747,290750],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5494,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5494,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[296741,296744],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[296741,296744],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5514,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5514,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[298152,298155],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[298152,298155],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":5555,"column":93,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":5555,"endColumn":94,"suggestions":[{"messageId":"removeEscape","fix":{"range":[301333,301334],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[301333,301333],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":5625,"column":53,"nodeType":"BlockStatement","messageId":"unexpected","endLine":5625,"endColumn":56,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[305984,305985],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5732,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5732,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[312949,312952],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[312949,312952],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":5800,"column":80,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":5800,"endColumn":81,"suggestions":[{"messageId":"removeEscape","fix":{"range":[317789,317790],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[317789,317789],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":5804,"column":114,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":5804,"endColumn":115,"suggestions":[{"messageId":"removeEscape","fix":{"range":[318281,318282],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[318281,318281],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":5863,"column":78,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":5863,"endColumn":79,"suggestions":[{"messageId":"removeEscape","fix":{"range":[322728,322729],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[322728,322728],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":5867,"column":112,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":5867,"endColumn":113,"suggestions":[{"messageId":"removeEscape","fix":{"range":[323215,323216],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[323215,323215],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5909,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5909,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[326635,326638],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[326635,326638],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5910,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5910,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[326769,326772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[326769,326772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5915,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5915,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[327142,327145],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[327142,327145],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5916,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5916,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[327241,327244],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[327241,327244],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5917,"column":96,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5917,"endColumn":99,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[327360,327363],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[327360,327363],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5920,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5920,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[327529,327532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[327529,327532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5927,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5927,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[328079,328082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[328079,328082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5957,"column":66,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5957,"endColumn":69,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[330184,330187],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[330184,330187],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5961,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5961,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[330522,330525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[330522,330525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5961,"column":69,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5961,"endColumn":72,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[330530,330533],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[330530,330533],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":5970,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":5970,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[331398,331401],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[331398,331401],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6046,"column":190,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6046,"endColumn":193,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[337983,337986],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[337983,337986],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6050,"column":112,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6050,"endColumn":115,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[338514,338517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[338514,338517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6106,"column":98,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6106,"endColumn":101,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[344653,344656],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[344653,344656],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6148,"column":190,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6148,"endColumn":193,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[349218,349221],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[349218,349221],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6149,"column":116,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6149,"endColumn":119,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[349359,349362],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[349359,349362],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6152,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6152,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[349615,349618],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[349615,349618],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6155,"column":150,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6155,"endColumn":153,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[350081,350084],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[350081,350084],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6163,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6163,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[350799,350802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[350799,350802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6166,"column":143,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6166,"endColumn":146,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[351245,351248],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[351245,351248],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6169,"column":87,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6169,"endColumn":90,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[351496,351499],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[351496,351499],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6173,"column":113,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6173,"endColumn":116,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[352115,352118],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[352115,352118],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6313,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6313,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[365726,365729],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[365726,365729],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6313,"column":119,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6313,"endColumn":122,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[365750,365753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[365750,365753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6314,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6314,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[365877,365880],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[365877,365880],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6314,"column":119,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6314,"endColumn":122,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[365901,365904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[365901,365904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6331,"column":101,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6331,"endColumn":104,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[367844,367847],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[367844,367847],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6334,"column":110,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6334,"endColumn":113,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[368318,368321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[368318,368321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6334,"column":142,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6334,"endColumn":145,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[368350,368353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[368350,368353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6336,"column":145,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6336,"endColumn":148,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[368641,368644],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[368641,368644],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\..","line":6344,"column":144,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":6344,"endColumn":145,"suggestions":[{"messageId":"removeEscape","fix":{"range":[369678,369679],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[369678,369678],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6480,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6480,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[384950,384953],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[384950,384953],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6483,"column":159,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6483,"endColumn":162,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[385397,385400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[385397,385400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6668,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6668,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[398647,398650],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[398647,398650],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6669,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6669,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[398707,398710],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[398707,398710],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6766,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6766,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[403495,403498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[403495,403498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6781,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6781,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[404385,404388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[404385,404388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"prefer-const","severity":2,"message":"'remoteSet' is never reassigned. Use 'const' instead.","line":6789,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":6789,"endColumn":18,"fix":{"range":[404736,404769],"text":"const remoteSet = new Set<string>()"}},{"ruleId":"prefer-const","severity":2,"message":"'remoteMetaByAih' is never reassigned. Use 'const' instead.","line":6790,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":6790,"endColumn":24,"fix":{"range":[404775,404862],"text":"const remoteMetaByAih = new Map<string, { hospital_id?: string; competencia?: string }>()"}},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6795,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6795,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[405130,405133],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[405130,405133],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6796,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6796,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[405182,405185],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[405182,405185],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":6803,"column":15,"nodeType":"BlockStatement","messageId":"unexpected","endLine":6803,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[405514,405515],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6817,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6817,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[406078,406081],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[406078,406081],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6828,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6828,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[406438,406441],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[406438,406441],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6833,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6833,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[406670,406673],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[406670,406673],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6840,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6840,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[407030,407033],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[407030,407033],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6845,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6845,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[407277,407280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[407277,407280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":253,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":9,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react';\r\nimport * as XLSX from 'xlsx';\r\nimport { format as formatDateFns } from 'date-fns';\r\nimport jsPDF from 'jspdf';\r\nimport autoTable from 'jspdf-autotable';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from './ui/card';\r\nimport { Button } from './ui/button';\r\nimport { Switch } from './ui/switch';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from './ui/dialog';\r\nimport { Input } from './ui/input';\r\nimport { Badge } from './ui/badge';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from './ui/select';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from './ui/table';\r\nimport { isOperaParanaEligible as isOperaEligibleConfig } from '../config/operaParana';\r\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from './ui/collapsible';\r\nimport { Alert, AlertDescription } from './ui/alert';\r\nimport { toast } from 'sonner';\r\nimport { supabase } from '../lib/supabase';\r\nimport { getSigtapLocalMap, resolveSigtapDescriptionFromCsv } from '@/utils/sigtapLocal';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport {\r\n  Users,\r\n  ChevronDown,\r\n  ChevronRight,\r\n  ChevronLeft,\r\n  Search,\r\n  Stethoscope,\r\n  DollarSign,\r\n  FileText,\r\n  User,\r\n  Activity,\r\n  Calendar,\r\n  CheckCircle,\r\n  XCircle,\r\n  AlertCircle,\r\n  TrendingUp,\r\n  BarChart3,\r\n  Database,\r\n  RefreshCw,\r\n  Building,\r\n  FileSpreadsheet,\r\n  Loader2\r\n} from 'lucide-react';\r\n\r\nimport { DoctorPatientService, type DoctorWithPatients } from '../services/doctorPatientService';\r\nimport { DoctorsHierarchyV2Service } from '../services/doctorsHierarchyV2';\r\nimport { DoctorsCrudService } from '../services/doctorsCrudService';\r\nimport { ProcedureRecordsService, type ProcedureRecord } from '../services/simplifiedProcedureService';\r\nimport { DateRange } from '../types';\r\nimport { DoctorPaymentRules } from './DoctorPaymentRules';\r\nimport { calculateDoctorPayment, calculatePercentagePayment, calculateFixedPayment, hasIndividualPaymentRules, isFixedMonthlyPayment, ALL_HOSPITAL_RULES, detectHospitalFromContext } from '../config/doctorPaymentRules';\r\nimport ProcedurePatientDiagnostic from './ProcedurePatientDiagnostic';\r\nimport CleuezaDebugComponent from './CleuezaDebugComponent';\r\nimport ExecutiveDateFilters from './ExecutiveDateFilters';\r\nimport { CareCharacterUtils } from '../config/careCharacterCodes';\r\nimport {\r\n  shouldCalculateAnesthetistProcedure,\r\n  getAnesthetistProcedureType,\r\n  filterCalculableProcedures\r\n} from '../utils/anesthetistLogic';\r\nimport { calculateHonPayments } from '../config/doctorPaymentRules/importers/honCsv'\r\nimport ReportGenerator from './ReportGenerator';\r\nimport PatientAihInfoBadges from './PatientAihInfoBadges';\r\nimport AihDatesBadges from './AihDatesBadges';\r\nimport { isDoctorCoveredForOperaParana, computeIncrementForProcedures, hasAnyExcludedCodeInProcedures, isElectiveCare, isUrgencyCare } from '../config/operaParana';\r\nimport { sumProceduresBaseReais } from '@/utils/valueHelpers';\r\nimport { exportAllPatientsExcel } from '../services/exportService'\r\nimport { ENV_CONFIG } from '../config/env'\r\nimport { supabaseSih } from '../lib/sihSupabase'\r\nimport { dedupPatientsByAIH, normalizeAih, summarizeDedup } from '../utils/dedupTest'\r\nimport { loadGynHonMap } from '../config/doctorPaymentRules/importers/gynXlsx'\r\nimport { loadUroHonMap } from '../config/doctorPaymentRules/importers/uroXlsx'\r\nimport { loadOtoHonMap } from '../config/doctorPaymentRules/importers/otoXlsx'\r\nimport { loadOtoSaoJoseHonMap } from '../config/doctorPaymentRules/importers/otoSaoJoseXlsx'\r\nimport { loadVasHonMap } from '../config/doctorPaymentRules/importers/vasXlsx'\r\n\r\n//  FUNES UTILITRIAS LOCAIS\r\n// Funo para identificar procedimentos mdicos (cdigo 04)\r\nconst isMedicalProcedure = (procedureCode: string): boolean => {\r\n  if (!procedureCode) return false;\r\n  // Verifica se o cdigo inicia com '04'\r\n  const code = procedureCode.toString().trim();\r\n  return code.startsWith('04');\r\n};\r\nconst formatCurrency = (value: number | null | undefined): string => {\r\n  if (value == null || isNaN(value)) return 'R$ 0,00';\r\n  return value.toLocaleString('pt-BR', {\r\n    style: 'currency',\r\n    currency: 'BRL',\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2\r\n  });\r\n};\r\n\r\nconst formatNumber = (value: number | null | undefined): string => {\r\n  if (value == null || isNaN(value)) return '0';\r\n  return Math.round(value).toLocaleString('pt-BR');\r\n};\r\n\r\n// Determinar quando usar planilha HON (apenas hospital Torao Tokuda e cirurgia geral, com fonte remota ativa)\r\nconst shouldUseHonForHospital = (doctorName: string, hospitalId: string | undefined, isGeneralSurgery: boolean): boolean => {\r\n  if (!ENV_CONFIG.USE_SIH_SOURCE) return false;\r\n  if (!isGeneralSurgery) return false;\r\n  const hospitalKey = detectHospitalFromContext(doctorName, hospitalId, ALL_HOSPITAL_RULES);\r\n  return hospitalKey === 'TORAO_TOKUDA_APUCARANA';\r\n};\r\n\r\n//  FUNO SEGURA: Parse de data ISO sem problemas de timezone\r\nconst parseISODateToLocal = (isoString: string | undefined | null): string => {\r\n  if (!isoString) return '';\r\n\r\n  const s = String(isoString).trim();\r\n  if (!s) return '';\r\n\r\n  // Tentar extrair YYYY-MM-DD (ignora hora se houver)\r\n  const match = s.match(/^(\\d{4})-(\\d{2})-(\\d{2})/);\r\n  if (match) {\r\n    const [, year, month, day] = match;\r\n    return `${day}/${month}/${year}`;\r\n  }\r\n\r\n  // Se no encontrou padro esperado, tentar split manual\r\n  try {\r\n    const parts = s.split(/[-T]/);\r\n    if (parts.length >= 3) {\r\n      const [year, month, day] = parts;\r\n      if (year && month && day) {\r\n        return `${day.padStart(2, '0')}/${month.padStart(2, '0')}/${year}`;\r\n      }\r\n    }\r\n  } catch (err) {\r\n    console.warn(' Erro ao parsear data:', s, err);\r\n  }\r\n\r\n  // ltimo recurso: retornar indicador de erro\r\n  return ' Data invlida';\r\n};\r\n\r\n// Funo para formatar competncia (YYYYMM ou YYYY-MM[-DD] para MM/YYYY)\r\nconst formatCompetencia = (competencia: string | undefined): string => {\r\n  if (!competencia) return '';\r\n\r\n  try {\r\n    // Suporte oficial DATASUS: YYYYMM\r\n    const m6 = competencia.match(/^(\\d{4})(\\d{2})$/);\r\n    if (m6) {\r\n      const [, year, month] = m6;\r\n      return `${month}/${year}`;\r\n    }\r\n    // Formato alternativo: YYYY-MM[-DD]\r\n    const mDash = competencia.match(/^(\\d{4})-(\\d{2})/);\r\n    if (mDash) {\r\n      const [, year, month] = mDash;\r\n      return `${month}/${year}`;\r\n    }\r\n\r\n    // Tentar parsear como data\r\n    const date = new Date(competencia);\r\n    if (!isNaN(date.getTime())) {\r\n      const month = String(date.getMonth() + 1).padStart(2, '0');\r\n      const year = date.getFullYear();\r\n      return `${month}/${year}`;\r\n    }\r\n\r\n    return competencia;\r\n  } catch {\r\n    return competencia;\r\n  }\r\n};\r\n\r\n// Helper: obter competncia segura (MM/YYYY) com fallback para alta ou filtro selecionado\r\nconst getSafeCompetenciaLabel = (p: any, selectedCompetencia?: string, isApproved?: boolean): string => {\r\n  if (!isApproved) return ''\r\n  const raw = p?.aih_info?.competencia as string | undefined\r\n  const formatted = formatCompetencia(raw)\r\n  // Extrair ano do formatted MM/YYYY\r\n  const yr = (() => {\r\n    const m = String(formatted || '').match(/^(\\d{2})\\/(\\d{4})$/)\r\n    return m ? parseInt(m[2], 10) : NaN\r\n  })()\r\n  // Se ano invlido ou claramente errado (e.g., 2001), usar fallback\r\n  if (!yr || isNaN(yr) || yr < 2015 || yr > 2100) {\r\n    // Fallback 1: usar alta SUS\r\n    const dischargeISO = p?.aih_info?.discharge_date || ''\r\n    const dLabel = parseISODateToLocal(dischargeISO) // DD/MM/YYYY\r\n    if (dLabel && /\\d{2}\\/\\d{2}\\/\\d{4}/.test(dLabel)) {\r\n      const parts = dLabel.split('/')\r\n      return `${parts[1]}/${parts[2]}`\r\n    }\r\n    // Fallback 2: usar filtro selecionado\r\n    if (selectedCompetencia && selectedCompetencia !== 'all') {\r\n      return formatCompetencia(selectedCompetencia)\r\n    }\r\n  }\r\n  return formatted\r\n}\r\n\r\n// Helper para comparar datas por dia (UTC) e gerar chave YYYY-MM-DD\r\nconst toUTCDateKey = (d: Date | string | undefined): string | null => {\r\n  try {\r\n    if (!d) return null;\r\n    const dt = typeof d === 'string' ? new Date(d) : d;\r\n    return new Date(Date.UTC(dt.getUTCFullYear(), dt.getUTCMonth(), dt.getUTCDate())).toISOString().slice(0, 10);\r\n  } catch { return null; }\r\n};\r\nconst isSameUTCDate = (a?: Date, b?: Date): boolean => {\r\n  if (!a || !b) return false;\r\n  return toUTCDateKey(a) === toUTCDateKey(b);\r\n};\r\n\r\n// Ocultar pagamentos hospitalares: CNS todo zero (mantm alimentao, oculta na UI)\r\nconst isZeroCns = (cns?: string): boolean => {\r\n  if (!cns) return false;\r\n  const s = String(cns).trim();\r\n  return /^0+$/.test(s);\r\n};\r\n\r\n// Mapas para exibio\r\nconst ESPECIALIDADE_MAP: Record<string, string> = {\r\n  '01': 'Cirrgica',\r\n  '02': 'Obsttrica',\r\n  '03': 'Clnica Mdica',\r\n  '07': 'Pediatria'\r\n};\r\nconst CARACTER_MAP: Record<string, string> = {\r\n  '01': 'Eletivo',\r\n  '02': 'Urgncia'\r\n};\r\nconst formatEspecialidade = (raw?: string | number): string => {\r\n  const code = String(raw ?? '').trim().padStart(2, '0');\r\n  return ESPECIALIDADE_MAP[code] || (code ? code : '-');\r\n};\r\nconst formatCareCharacterLabel = (raw?: string | number): string => {\r\n  const code = String(raw ?? '').trim().padStart(2, '0');\r\n  return CARACTER_MAP[code] || (code ? code : '-');\r\n};\r\n\r\nconst careBadgeClass = (raw?: string | number): string => {\r\n  const label = formatCareCharacterLabel(raw);\r\n  return label === 'Urgncia'\r\n    ? 'bg-red-50 text-red-700 border-red-200'\r\n    : 'bg-blue-50 text-blue-700 border-blue-200';\r\n};\r\n\r\nconst normalizeAihNumber = (s: string | undefined | null): string => {\r\n  const v = String(s || '').trim()\r\n  return v.replace(/\\D/g, '').replace(/^0+/, '')\r\n}\r\n\r\nconst calculateDoctorStats = (\r\n  doctorData: DoctorWithPatients,\r\n  aihAssignmentMap?: Map<string, string>,\r\n  drRange?: { from?: string; to?: string }\r\n) => {\r\n  //  SIMPLIFICADO: Usar TODOS os pacientes (sem filtro de data)\r\n  let patientsForStats = doctorData.patients;\r\n  if (aihAssignmentMap) {\r\n    const cns = doctorData.doctor_info.cns || 'NO_CNS'\r\n    patientsForStats = patientsForStats.filter(p => {\r\n      const key = normalizeAihNumber((p as any)?.aih_info?.aih_number)\r\n      if (!key) return true\r\n      const assigned = aihAssignmentMap.get(key)\r\n      return assigned === cns\r\n    })\r\n  }\r\n\r\n  //  OTIMIZAO #4: Usar procedimentos pr-filtrados (calculable_procedures)\r\n  const totalProcedures = patientsForStats.reduce((sum, patient) =>\r\n    sum + ((patient as any).calculable_procedures?.length || patient.procedures.filter(filterCalculableProcedures).length), 0);\r\n\r\n  //  CORREO: USAR patient.total_value_reais QUE VEM DO calculated_total_value DA AIH\r\n  const totalValue = patientsForStats.reduce((sum, patient) => {\r\n    const base = typeof (patient as any).total_value_reais === 'number'\r\n      ? (patient as any).total_value_reais\r\n      : sumProceduresBaseReais((patient as any).procedures as any);\r\n    return sum + (base || 0);\r\n  }, 0);\r\n  const totalAIHsAll = (() => {\r\n    const set = new Set<string>();\r\n    for (const p of doctorData.patients) {\r\n      const k = normalizeAihNumber((p as any)?.aih_info?.aih_number);\r\n      if (k) set.add(k);\r\n    }\r\n    return set.size;\r\n  })();\r\n  const avgTicket = totalAIHsAll > 0 ? totalValue / totalAIHsAll : 0;\r\n\r\n  //  LOG PARA VERIFICAO DA CORREO\r\n  if (doctorData.patients.length > 0) {\r\n    console.log(` Mdico ${doctorData.doctor_info.name}: R$ ${totalValue.toFixed(2)} (usando patient.total_value_reais)`);\r\n  }\r\n\r\n  //  OTIMIZAO #4: Usar procedimentos pr-filtrados para aprovados\r\n  const approvedProcedures = patientsForStats.reduce((sum, patient) => {\r\n    const calculable = (patient as any).calculable_procedures || patient.procedures.filter(filterCalculableProcedures);\r\n    return sum + calculable.filter((proc: any) => proc.approval_status === 'approved').length;\r\n  }, 0);\r\n  const approvalRate = totalProcedures > 0 ? (approvedProcedures / totalProcedures) * 100 : 0;\r\n\r\n  //  CALCULAR valores especficos dos procedimentos mdicos (\"04\") COM REGRAS DE PAGAMENTO\r\n  //  EXCLUIR ANESTESISTAS 04.xxx dos procedimentos mdicos (03.xxx so permitidos)\r\n  const medicalProceduresCount = patientsForStats.reduce((sum, patient) =>\r\n    sum + patient.procedures.filter(proc =>\r\n      isMedicalProcedure(proc.procedure_code) &&\r\n      shouldCalculateAnesthetistProcedure(proc.cbo, proc.procedure_code)\r\n    ).length, 0\r\n  );\r\n\r\n  //  CALCULAR QUANTIDADE DE PROCEDIMENTOS DE ANESTESISTAS INICIADOS EM '04' POR MDICO\r\n  //  NOVA LGICA: Agrupar por paciente e contar apenas 1 procedimento por grupo de anestesia\r\n  const anesthetistProcedures04Count = patientsForStats.reduce((sum, patient) => {\r\n    // Verificar se o paciente tem pelo menos 1 procedimento de anestesia 04.xxx\r\n    const hasAnesthesiaProcedures = patient.procedures.some(proc =>\r\n      proc.cbo === '225151' && //  anestesista\r\n      proc.procedure_code?.startsWith('04') && // Procedimento inicia com '04'\r\n      proc.procedure_code !== '04.17.01.001-0' // Excluir cesariana (que  calculada)\r\n    );\r\n\r\n    // Se tem procedimentos de anestesia, conta apenas 1 (uma anestesia contempla todos os outros)\r\n    return sum + (hasAnesthesiaProcedures ? 1 : 0);\r\n  }, 0);\r\n\r\n  //  CALCULAR VALOR TOTAL BASEADO NAS REGRAS DE PAGAMENTO ESPECFICAS\r\n  let medicalProceduresValue = 0;\r\n  let calculatedPaymentValue = 0;\r\n  //  CONTAGEM DE PACIENTES NICOS (independente de n AIH)\r\n  const uniquePatientKeys = new Set<string>();\r\n  for (const p of patientsForStats) {\r\n    const k = String((p as any).patient_id || (p as any)?.patient_info?.medical_record || '')\r\n      || `${(p as any)?.patient_info?.name || ''}|${(p as any)?.aih_info?.admission_date || ''}`;\r\n    if (k) uniquePatientKeys.add(k);\r\n  }\r\n  const totalPatientsUnique = uniquePatientKeys.size;\r\n\r\n  //  CONTAGEM ALINHADA AO RELATRIO SIMPLIFICADO (uma linha por paciente)\r\n  const simplifiedReportLineCount = (() => {\r\n    const list = dedupPatientsByAIH(doctorData.patients || [])\r\n      .filter((p: any) => {\r\n        if (aihAssignmentMap) {\r\n          const cns = doctorData.doctor_info.cns || 'NO_CNS'\r\n          const key = normalizeAih(String(p?.aih_info?.aih_number || '').trim())\r\n          if (key) {\r\n            const assigned = aihAssignmentMap.get(key)\r\n            if (assigned && assigned !== cns) return false\r\n          }\r\n        }\r\n        if (drRange && (drRange.from || drRange.to)) {\r\n          try {\r\n            const dischargeISO = p?.aih_info?.discharge_date || ''\r\n            const d = dischargeISO ? new Date(dischargeISO) : null\r\n            const start = drRange.from ? new Date(drRange.from) : null\r\n            const end = drRange.to ? new Date(drRange.to) : null\r\n            const endExclusive = end ? new Date(end.getFullYear(), end.getMonth(), end.getDate() + 1) : null\r\n            if (d) {\r\n              if (start && d < new Date(start.getFullYear(), start.getMonth(), start.getDate())) return false\r\n              if (endExclusive && d >= endExclusive) return false\r\n            }\r\n          } catch { }\r\n        }\r\n        return true\r\n      })\r\n    return list.length\r\n  })()\r\n\r\n  // Calcular valor original de todos os procedimentos mdicos ( EXCLUINDO ANESTESISTAS 04.xxx)\r\n  medicalProceduresValue = patientsForStats.reduce((sum, patient) =>\r\n    sum + patient.procedures\r\n      .filter(proc =>\r\n        isMedicalProcedure(proc.procedure_code) &&\r\n        shouldCalculateAnesthetistProcedure(proc.cbo, proc.procedure_code)\r\n      )\r\n      .reduce((procSum, proc) => procSum + (proc.value_reais || 0), 0), 0\r\n  );\r\n\r\n  //  CALCULAR INCREMENTO OPERA PARAN (acrscimo ao valor base das AIHs)\r\n  const hospitalId = doctorData.hospitals?.[0]?.hospital_id;\r\n  const doctorCovered = isDoctorCoveredForOperaParana(doctorData.doctor_info.name, hospitalId);\r\n\r\n  const operaParanaIncrement = doctorCovered\r\n    ? patientsForStats.reduce((acc, patient) =>\r\n      acc + computeIncrementForProcedures(\r\n        (((patient as any).calculable_procedures) || patient.procedures.filter(filterCalculableProcedures)) as any,\r\n        (patient as any)?.aih_info?.care_character,\r\n        doctorData.doctor_info.name,\r\n        hospitalId\r\n      ), 0)\r\n    : 0;\r\n\r\n  //  CALCULAR SOMA DOS VALORES DO DETALHAMENTO POR PROCEDIMENTO (POR PACIENTE)\r\n  //  VERIFICAR TIPO DE REGRA: VALOR FIXO  PERCENTUAL  INDIVIDUAL\r\n\r\n  //  CORREO FINAL: Usar EXATAMENTE a mesma lgica do card do paciente\r\n  // - Usar patient.procedures diretamente (no calculable_procedures)\r\n  // - Ordenar por sequence e valor (igual ao card)\r\n  calculatedPaymentValue = patientsForStats.reduce((totalSum, patient) => {\r\n    const patientMedicalProcedures = (patient.procedures || [])\r\n      .filter((proc: any) =>\r\n        isMedicalProcedure(proc.procedure_code) &&\r\n        shouldCalculateAnesthetistProcedure(proc.cbo, proc.procedure_code)\r\n      )\r\n      .sort((a: any, b: any) => {\r\n        // Ordenar por sequence primeiro, depois por valor (decrescente) - IGUAL AO CARD\r\n        const sa = typeof a.sequence === 'number' ? a.sequence : 9999;\r\n        const sb = typeof b.sequence === 'number' ? b.sequence : 9999;\r\n        if (sa !== sb) return sa - sb;\r\n        const va = typeof a.value_reais === 'number' ? a.value_reais : 0;\r\n        const vb = typeof b.value_reais === 'number' ? b.value_reais : 0;\r\n        return vb - va;\r\n      })\r\n      .map((proc: any) => ({\r\n        procedure_code: proc.procedure_code,\r\n        procedure_description: proc.procedure_description,\r\n        value_reais: proc.value_reais || 0,\r\n        cbo: proc.cbo\r\n      }));\r\n    if (patientMedicalProcedures.length > 0) {\r\n      const isGeneralSurgery = /cirurg/i.test(doctorData.doctor_info.name || '') || (/cirurg/i.test(doctorData.doctor_info.specialty || '') && /geral/i.test(doctorData.doctor_info.specialty || ''))\r\n      const useHon = shouldUseHonForHospital(doctorData.doctor_info.name, hospitalId, isGeneralSurgery)\r\n      const paymentCalculation = useHon\r\n        ? calculateHonPayments(patientMedicalProcedures)\r\n        : calculateDoctorPayment(doctorData.doctor_info.name, patientMedicalProcedures, hospitalId);\r\n      const patientCalculatedSum = paymentCalculation.procedures.reduce((sum, proc) => sum + proc.calculatedPayment, 0);\r\n      return totalSum + patientCalculatedSum;\r\n    }\r\n    return totalSum;\r\n  }, 0);\r\n\r\n  //  CORREO (Re-aplicada): Valor fixo mensal no deve ser multiplicado por AIH.\r\n  // Se o mdico tem valor fixo MENSAL, o valor calculado pelo reduce estar errado (multiplicado pelo n de pacientes)\r\n  // porque calculateDoctorPayment retorna o valor fixo para CADA paciente.\r\n  // Devemos sobrescrever com o valor fixo nico.\r\n  if (isFixedMonthlyPayment(doctorData.doctor_info.name, hospitalId, ALL_HOSPITAL_RULES)) {\r\n    const fixed = calculateFixedPayment(doctorData.doctor_info.name, hospitalId, ALL_HOSPITAL_RULES);\r\n    if (fixed.hasFixedRule) {\r\n      console.log(` [FIX] Corrigindo pagamento mensal multiplicado para ${doctorData.doctor_info.name}: R$ ${calculatedPaymentValue.toFixed(2)} -> R$ ${fixed.calculatedPayment.toFixed(2)}`);\r\n      calculatedPaymentValue = fixed.calculatedPayment;\r\n    }\r\n  }\r\n\r\n  return {\r\n    totalProcedures,\r\n    totalValue,\r\n    totalAIHs: totalAIHsAll,\r\n    totalPatientsUnique,\r\n    simplifiedReportLineCount,\r\n    avgTicket,\r\n    approvalRate,\r\n    medicalProceduresValue,\r\n    medicalProceduresCount,\r\n    calculatedPaymentValue, //  Valor calculado baseado nas regras\r\n    anesthetistProcedures04Count, //  Quantidade de procedimentos de anestesistas iniciados em '04'\r\n    operaParanaIncrement, //  Incremento Opera Paran (acrscimo ao valor das AIHs)\r\n    totalValueWithOperaParana: totalValue + operaParanaIncrement //  Valor total das AIHs + incremento\r\n  };\r\n};\r\n\r\n// Chave nica por carto MdicoHospital\r\nconst getDoctorCardKey = (doctor: DoctorWithPatients): string => {\r\n  const cns = doctor.doctor_info.cns || 'NO_CNS';\r\n  const hospitalId = doctor.hospitals && doctor.hospitals.length > 0 ? (doctor.hospitals[0] as any).hospital_id || '' : '';\r\n  return `${cns}::${hospitalId}`;\r\n};\r\n\r\n//  INTERFACE PARA DIAGNSTICO DE DADOS\r\ninterface DataDiagnostic {\r\n  aihs_with_doctors: number;\r\n  unique_doctors: number;\r\n  unique_patients: number;\r\n  total_procedures: number;\r\n  procedures_with_patients: number;\r\n  association_rate: number;\r\n  sample_associations: Array<{\r\n    doctor_cns: string;\r\n    patient_id: string;\r\n    procedure_count: number;\r\n    sample_procedure_codes: string[];\r\n    sample_procedure_descriptions?: string[];\r\n  }>;\r\n}\r\n\r\n//  COMPONENTE DE DIAGNSTICO DE DADOS\r\nconst DataDiagnostics: React.FC<{ onClose: () => void }> = ({ onClose }) => {\r\n  const [diagnostic, setDiagnostic] = useState<DataDiagnostic | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Funo para buscar descries dos procedimentos no SIGTAP\r\n  const fetchProcedureDescriptions = async (codes: string[]): Promise<string[]> => {\r\n    if (!codes || codes.length === 0) return [];\r\n\r\n    try {\r\n      const { data: sigtapData } = await supabase\r\n        .from('sigtap_procedimentos_oficial')\r\n        .select('codigo, nome')\r\n        .in('codigo', codes);\r\n\r\n      if (sigtapData && sigtapData.length > 0) {\r\n        const descriptionMap = new Map(sigtapData.map(item => [item.codigo, item.nome]));\r\n        return codes.map(code => descriptionMap.get(code) || `Procedimento ${code}`);\r\n      }\r\n\r\n      return codes.map(code => `Procedimento ${code}`);\r\n    } catch (error) {\r\n      console.warn('Erro ao buscar descries SIGTAP:', error);\r\n      return codes.map(code => `Procedimento ${code}`);\r\n    }\r\n  };\r\n\r\n  const runDiagnostic = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const result = await DoctorPatientService.diagnoseDatabaseStructure();\r\n      if (result.success && result.data) {\r\n        const diagnosticData = result.data;\r\n\r\n        // Buscar descries para cada amostra\r\n        for (const sample of diagnosticData.sample_associations) {\r\n          (sample as any).sample_procedure_descriptions = await fetchProcedureDescriptions(sample.sample_procedure_codes);\r\n        }\r\n\r\n        setDiagnostic(diagnosticData);\r\n      } else {\r\n        setError(result.error || 'Erro ao executar diagnstico');\r\n      }\r\n    } catch (err) {\r\n      setError('Erro inesperado no diagnstico');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    runDiagnostic();\r\n  }, []);\r\n\r\n  if (loading) {\r\n    return (\r\n      <Card className=\"mb-6 border-blue-200\">\r\n        <CardContent className=\"p-6\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <RefreshCw className=\"h-5 w-5 animate-spin text-blue-600\" />\r\n            <span>Executando diagnstico da estrutura de dados...</span>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <Card className=\"mb-6 border-red-200\">\r\n        <CardContent className=\"p-6\">\r\n          <Alert>\r\n            <AlertCircle className=\"h-4 w-4\" />\r\n            <AlertDescription>{error}</AlertDescription>\r\n          </Alert>\r\n          <div className=\"mt-4 flex gap-2\">\r\n            <Button onClick={runDiagnostic} variant=\"outline\" size=\"sm\">\r\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n              Tentar Novamente\r\n            </Button>\r\n            <Button onClick={onClose} variant=\"ghost\" size=\"sm\">Fechar</Button>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  if (!diagnostic) return null;\r\n\r\n  const getAssociationColor = (rate: number) => {\r\n    if (rate >= 80) return 'text-green-600';\r\n    if (rate >= 60) return 'text-yellow-600';\r\n    return 'text-red-600';\r\n  };\r\n\r\n  return (\r\n    <Card className=\"mb-6 border-blue-200 bg-blue-50/30\">\r\n      <CardHeader className=\"pb-4\">\r\n        <div className=\"flex items-center justify-between\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <Database className=\"h-5 w-5 text-blue-600\" />\r\n            <CardTitle className=\"text-lg\">Diagnstico da Estrutura de Dados</CardTitle>\r\n          </div>\r\n          <Button onClick={onClose} variant=\"ghost\" size=\"sm\"></Button>\r\n        </div>\r\n      </CardHeader>\r\n      <CardContent>\r\n        {/* ESTATSTICAS PRINCIPAIS */}\r\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\r\n          <div className=\"text-center p-3 bg-white rounded-lg border\">\r\n            <div className=\"text-2xl font-bold text-blue-600\">{diagnostic.aihs_with_doctors}</div>\r\n            <div className=\"text-sm text-gray-600\">AIHs com Mdicos</div>\r\n          </div>\r\n          <div className=\"text-center p-3 bg-white rounded-lg border\">\r\n            <div className=\"text-2xl font-bold text-green-600\">{diagnostic.unique_doctors}</div>\r\n            <div className=\"text-sm text-gray-600\">Mdicos nicos</div>\r\n          </div>\r\n          <div className=\"text-center p-3 bg-white rounded-lg border\">\r\n            <div className=\"text-2xl font-bold text-purple-600\">{diagnostic.unique_patients}</div>\r\n            <div className=\"text-sm text-gray-600\">Pacientes nicos</div>\r\n          </div>\r\n          <div className=\"text-center p-3 bg-white rounded-lg border\">\r\n            <div className=\"text-2xl font-bold text-orange-600\">{diagnostic.total_procedures}</div>\r\n            <div className=\"text-sm text-gray-600\">Total Procedimentos</div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* TAXA DE ASSOCIAO */}\r\n        <div className=\"bg-white rounded-lg border p-4 mb-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <span className=\"font-medium\">Taxa de Associao:</span>\r\n            <span className={`text-xl font-bold ${getAssociationColor(diagnostic.association_rate)}`}>\r\n              {diagnostic.association_rate}%\r\n            </span>\r\n          </div>\r\n          <div className=\"text-sm text-gray-600 mt-1\">\r\n            {diagnostic.procedures_with_patients} de {diagnostic.total_procedures} procedimentos associados\r\n          </div>\r\n          <div className=\"w-full bg-gray-200 rounded-full h-2 mt-2\">\r\n            <div\r\n              className={`h-2 rounded-full ${diagnostic.association_rate >= 80 ? 'bg-green-500' :\r\n                diagnostic.association_rate >= 60 ? 'bg-yellow-500' : 'bg-red-500'\r\n                }`}\r\n              style={{ width: `${diagnostic.association_rate}%` }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* AMOSTRAS DE ASSOCIAO */}\r\n        {diagnostic.sample_associations.length > 0 && (\r\n          <div className=\"bg-white rounded-lg border p-4\">\r\n            <h4 className=\"font-medium mb-3\"> Amostras de Associao:</h4>\r\n            <div className=\"space-y-2\">\r\n              {diagnostic.sample_associations.map((sample, index) => (\r\n                <div key={index} className=\"bg-gray-50 rounded p-3 text-sm\">\r\n                  <div className=\"flex items-center gap-2 mb-1\">\r\n                    <User className=\"h-4 w-4 text-blue-600\" />\r\n                    <span className=\"font-medium\">Mdico {sample.doctor_cns.substring(0, 5)}...</span>\r\n                    <span className=\"text-gray-500\"></span>\r\n                    <span>Paciente {sample.patient_id.substring(0, 8)}...</span>\r\n                  </div>\r\n                  <div className=\"ml-6\">\r\n                    <Badge variant=\"outline\" className=\"mr-2\">\r\n                      {sample.procedure_count} procedimentos\r\n                    </Badge>\r\n                    <div className=\"text-gray-600 text-sm\">\r\n                      {sample.sample_procedure_codes.map((code, codeIndex) => (\r\n                        <div key={codeIndex} className=\"mt-1\">\r\n                          <span className=\"font-mono text-xs font-medium\">{code}</span>\r\n                          {(sample as any).sample_procedure_descriptions?.[codeIndex] && (\r\n                            <span className=\"ml-2 text-xs text-gray-500\">\r\n                              {(sample as any).sample_procedure_descriptions[codeIndex]}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* BOTES DE AO */}\r\n        <div className=\"flex gap-2 mt-4\">\r\n          <Button onClick={runDiagnostic} variant=\"outline\" size=\"sm\">\r\n            <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n            Atualizar Diagnstico\r\n          </Button>\r\n          <Button onClick={onClose} variant=\"ghost\" size=\"sm\">Fechar</Button>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n\r\n//  INTERFACE PARA PROPS DO COMPONENTE - SIMPLIFICADA\r\ninterface MedicalProductionDashboardProps {\r\n  onStatsUpdate?: (stats: {\r\n    totalRevenue: number;\r\n    totalDoctors: number;\r\n    totalPatients: number;\r\n    totalProcedures: number;\r\n    patientsWithMultipleAIHs?: number;\r\n    totalMultipleAIHs?: number;\r\n    totalAIHs?: number;\r\n    uniquePatients?: number;\r\n    multipleAIHsDetails?: any[];\r\n  }) => void;\r\n  selectedHospitals?: string[]; // Filtro de hospital\r\n  searchTerm?: string; // Busca de mdicos\r\n  patientSearchTerm?: string; // Busca de pacientes\r\n  selectedCompetencia?: string; //  NOVO: Filtro de competncia\r\n  filterCareCharacter?: 'all' | '1' | '2';\r\n  dischargeDateRange?: { from?: string; to?: string };\r\n}\r\n\r\n//  COMPONENTE PRINCIPAL - SIMPLIFICADO\r\nconst MedicalProductionDashboard: React.FC<MedicalProductionDashboardProps> = ({\r\n  onStatsUpdate,\r\n  selectedHospitals = ['all'],\r\n  searchTerm = '',\r\n  patientSearchTerm = '',\r\n  selectedCompetencia = 'all',\r\n  filterCareCharacter = 'all'\r\n  , dischargeDateRange\r\n}) => {\r\n  const useDebounced = <T,>(value: T, delay: number) => {\r\n    const [debounced, setDebounced] = useState<T>(value);\r\n    useEffect(() => {\r\n      const id = setTimeout(() => setDebounced(value), delay);\r\n      return () => clearTimeout(id);\r\n    }, [value, delay]);\r\n    return debounced;\r\n  };\r\n  const debouncedSearchTerm = useDebounced(searchTerm, 300);\r\n  const debouncedPatientSearchTerm = useDebounced(patientSearchTerm, 300);\r\n  const { user, canAccessAllHospitals, hasFullAccess } = useAuth();\r\n  const [doctors, setDoctors] = useState<DoctorWithPatients[]>([]);\r\n  const [filteredDoctors, setFilteredDoctors] = useState<DoctorWithPatients[]>([]);\r\n  const [availableHospitals, setAvailableHospitals] = useState<Array<{ id: string, name: string, cnes?: string }>>([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [dbAihCount, setDbAihCount] = useState<number | null>(null);\r\n  const [expandedDoctors, setExpandedDoctors] = useState<Set<string>>(new Set());\r\n  const [expandedPatients, setExpandedPatients] = useState<Set<string>>(new Set());\r\n  const [showDiagnostic, setShowDiagnostic] = useState(false); //  ESTADO PARA MOSTRAR DIAGNSTICO\r\n  //  Estado para cache de pacientes sem repasse mdico\r\n  const [patientsWithoutPaymentCache, setPatientsWithoutPaymentCache] = useState<Map<string, {\r\n    count: number;\r\n    total: number;\r\n    calculated: boolean;\r\n  }>>(new Map());\r\n  const [showProcedureDiagnostic, setShowProcedureDiagnostic] = useState(false); //  DIAGNSTICO DE PROCEDIMENTOS\r\n  const [showCleuezaDebug, setShowCleuezaDebug] = useState(false); //  DEBUG ESPECFICO CLEUZA\r\n  //  REFRESH CONTROL (manual e realtime)\r\n  const [refreshTick, setRefreshTick] = useState(0);\r\n  const realtimeDebounceRef = useRef<NodeJS.Timeout | null>(null);\r\n  const [autoRefresh, setAutoRefresh] = useState<boolean>(true);\r\n  //  MODAL RELATRIO SUS\r\n  const [reportModalOpen, setReportModalOpen] = useState<boolean>(false);\r\n  //  COMPETNCIA VEM DO PROP (no precisa de estado local)\r\n  const [availableCompetencias, setAvailableCompetencias] = useState<string[]>([]);\r\n  const [useSihSource, setUseSihSource] = useState<boolean>(false)\r\n  const [sigtapMap, setSigtapMap] = useState<Map<string, string> | null>(null)\r\n  const [discrepancyLoading, setDiscrepancyLoading] = useState<boolean>(false)\r\n  const [discrepancyTotals, setDiscrepancyTotals] = useState<{\r\n    cards_sum_reais: number\r\n    cards_distinct_sum_reais: number\r\n    remote_val_tot_distinct_reais: number\r\n    local_sigtap_total_reais: number\r\n    difference_cards_vs_sigtap: number\r\n  } | null>(null)\r\n  const [discrepancyDetails, setDiscrepancyDetails] = useState<Array<{ aih: string; cards: number; sigtap: number; sih?: number; diff: number }>>([])\r\n  const [discrepancyCounts, setDiscrepancyCounts] = useState<{ missingInLocal: number; missingInCards: number; missingInRemote: number; withoutNumber: number }>({ missingInLocal: 0, missingInCards: 0, missingInRemote: 0, withoutNumber: 0 })\r\n  const [showDiscrepancyDetails, setShowDiscrepancyDetails] = useState<boolean>(false)\r\n  const [showDedupList, setShowDedupList] = useState<boolean>(false)\r\n  useEffect(() => {\r\n    try { localStorage.setItem('useSihSource', 'false') } catch { }\r\n  }, [])\r\n  const [zeroRepasseOpen, setZeroRepasseOpen] = useState<boolean>(false)\r\n  const [zeroRepasseItems, setZeroRepasseItems] = useState<Array<{ medicalRecord: string; aihNumber: string; name: string; procedures: string; discharge: string }>>([])\r\n  const [zeroRepasseDoctorName, setZeroRepasseDoctorName] = useState<string>('')\r\n  useEffect(() => {\r\n    try {\r\n      localStorage.setItem('useSihSource', useSihSource ? 'true' : 'false')\r\n      window.dispatchEvent(new CustomEvent('sihsourcechange', { detail: { useSihSource } }))\r\n    } catch { }\r\n  }, [useSihSource])\r\n  useEffect(() => {\r\n    let mounted = true\r\n    const load = async () => {\r\n      if (!useSihSource) { setSigtapMap(null); return }\r\n      try {\r\n        const map = await getSigtapLocalMap()\r\n        if (mounted) setSigtapMap(map)\r\n      } catch { if (mounted) setSigtapMap(new Map()) }\r\n    }\r\n    load()\r\n    return () => { mounted = false }\r\n  }, [useSihSource])\r\n  const remoteConfigured = Boolean(ENV_CONFIG.SIH_SUPABASE_URL && ENV_CONFIG.SIH_SUPABASE_ANON_KEY)\r\n  const [simplifiedValidationOpen, setSimplifiedValidationOpen] = useState<boolean>(false)\r\n  const [simplifiedValidationLoading, setSimplifiedValidationLoading] = useState<boolean>(false)\r\n  const [simplifiedValidationStats, setSimplifiedValidationStats] = useState<{ total: number; approved: number; notApproved: number; remote: boolean } | null>(null)\r\n  const approvedSetRef = useRef<Set<string>>(new Set())\r\n  const approvalCompetenciaByAihRef = useRef<Map<string, string>>(new Map())\r\n  const [selectedDoctorForReport, setSelectedDoctorForReport] = useState<any>(null)\r\n  const [sihRemoteTotals, setSihRemoteTotals] = useState<{ totalValue: number; totalAIHs: number; source: string } | null>(null)\r\n  const generateGeneralPatientsReport = async () => {\r\n    try {\r\n      const rows: Array<Array<string | number>> = []\r\n      const allAihIds: Set<string> = new Set()\r\n      const aihIdsWithProcedures: Set<string> = new Set()\r\n      const header = [\r\n        '#',\r\n        'Pronturio',\r\n        'Nome do Paciente',\r\n        'N AIH',\r\n        'Cdigo Procedimento',\r\n        'Descrio Procedimento',\r\n        'Data Procedimento',\r\n        'Data Alta (SUS)',\r\n        'Especialidade de Atendimento',\r\n        'Carter de Atendimento',\r\n        'Mdico',\r\n        'Hospital',\r\n        'Pgt. Administrativo',\r\n        'Valor Procedimento',\r\n        'AIH Seca',\r\n        'Incremento',\r\n        'AIH c/ Incremento'\r\n      ]\r\n      let idx = 1\r\n      let totalAIHsFound = 0\r\n      let excludedByDateFilter = 0\r\n      let aihsWithoutNumber = 0\r\n      const normalizeAih = (s: string) => s.replace(/\\D/g, '').replace(/^0+/, '')\r\n      filteredDoctors.forEach((card: any) => {\r\n        const doctorName = card.doctor_info?.name || ''\r\n        const hospitalName = card.hospitals?.[0]?.hospital_name || ''\r\n          ; (card.patients || []).forEach((p: any) => {\r\n            totalAIHsFound++\r\n            const patientId = p.patient_id\r\n            const name = p.patient_info?.name || 'Paciente'\r\n            const medicalRecord = p.patient_info?.medical_record || '-'\r\n            const aihRaw = normalizeAih(String(p?.aih_info?.aih_number || '').trim())\r\n            const aih = aihRaw || 'Aguardando gerao'\r\n            const aihKey = String(p?.aih_id || aihRaw || `${patientId}|${p?.aih_info?.admission_date || ''}`)\r\n            if (aihKey) allAihIds.add(aihKey)\r\n            if (!aihRaw) aihsWithoutNumber++\r\n            const careSpec = (p?.aih_info?.specialty || '').toString()\r\n            const careCharacter = (() => {\r\n              const raw = (p?.aih_info?.care_character ?? '').toString()\r\n              try { return CareCharacterUtils.formatForDisplay(raw, false) } catch { return raw }\r\n            })()\r\n            const disISO = p?.aih_info?.discharge_date || ''\r\n            const disLabel = disISO ? parseISODateToLocal(disISO) : ''\r\n            // Usar o mesmo filtro da tela para garantir fidelidade\r\n            const procedures = (p as any).calculable_procedures || (p.procedures || []).filter(filterCalculableProcedures)\r\n            procedures.forEach((proc: any) => {\r\n              const procCode = proc.procedure_code || ''\r\n              const procDesc = proc.procedure_description || proc.sigtap_description || ''\r\n              const procDate = proc.procedure_date || ''\r\n              const procDateLabel = procDate ? (() => { const s = String(procDate); const m = s.match(/^(\\d{4})-(\\d{2})-(\\d{2})/); return m ? `${m[3]}/${m[2]}/${m[1]}` : parseISODateToLocal(s) })() : ''\r\n              const procValue = Number(proc.value_reais || 0)\r\n              const baseAih = Number(p.total_value_reais || 0)\r\n              const doctorCovered = isDoctorCoveredForOperaParana(doctorName, card.hospitals?.[0]?.hospital_id)\r\n              // Calcular incremento com o mesmo conjunto de procedimentos exibidos\r\n              const increment = doctorCovered ? computeIncrementForProcedures(procedures as any, p?.aih_info?.care_character, doctorName, card.hospitals?.[0]?.hospital_id) : 0\r\n              const aihWithIncrements = baseAih + increment\r\n              const pgtAdm = p?.aih_info?.pgt_adm || 'no'\r\n              aihIdsWithProcedures.add(aihKey)\r\n              rows.push([\r\n                idx++,\r\n                medicalRecord,\r\n                name,\r\n                aih,\r\n                procCode,\r\n                procDesc,\r\n                procDateLabel,\r\n                disLabel,\r\n                formatEspecialidade(careSpec),\r\n                careCharacter,\r\n                doctorName,\r\n                hospitalName,\r\n                pgtAdm,\r\n                formatCurrency(procValue),\r\n                formatCurrency(baseAih),\r\n                formatCurrency(increment),\r\n                formatCurrency(aihWithIncrements)\r\n              ])\r\n            })\r\n            // Garantir 1 linha por AIH mesmo sem procedimentos calculveis\r\n            if (procedures.length === 0) {\r\n              const doctorCovered = isDoctorCoveredForOperaParana(doctorName, card.hospitals?.[0]?.hospital_id)\r\n              const increment = doctorCovered ? computeIncrementForProcedures([], p?.aih_info?.care_character, doctorName, card.hospitals?.[0]?.hospital_id) : 0\r\n              const aihWithIncrements = Number(p.total_value_reais || 0) + increment\r\n              rows.push([\r\n                idx++,\r\n                medicalRecord,\r\n                name,\r\n                aih,\r\n                '',\r\n                'Sem procedimento calculvel no perodo/filtros',\r\n                '',\r\n                disLabel,\r\n                formatEspecialidade(careSpec),\r\n                careCharacter,\r\n                doctorName,\r\n                hospitalName,\r\n                p?.aih_info?.pgt_adm || 'no',\r\n                formatCurrency(0),\r\n                formatCurrency(Number(p.total_value_reais || 0)),\r\n                formatCurrency(increment),\r\n                formatCurrency(aihWithIncrements)\r\n              ])\r\n            }\r\n          })\r\n      })\r\n      rows.forEach((row, index) => { row[0] = index + 1 })\r\n      const wb = XLSX.utils.book_new()\r\n      const ws = XLSX.utils.aoa_to_sheet([header, ...rows])\r\n      const wsAny: any = ws\r\n      wsAny['!cols'] = [\r\n        { wch: 5 }, { wch: 15 }, { wch: 35 }, { wch: 18 }, { wch: 20 }, { wch: 45 }, { wch: 16 }, { wch: 16 }, { wch: 25 }, { wch: 22 }, { wch: 30 }, { wch: 35 }, { wch: 20 }, { wch: 18 }, { wch: 18 }, { wch: 18 }, { wch: 20 }\r\n      ]\r\n      XLSX.utils.book_append_sheet(wb, ws, 'Pacientes')\r\n\r\n      // Resumo com reconciliao (tela x relatrio)\r\n      const uniqueKeys: Record<string, true> = {}\r\n      for (const d of (filteredDoctors || []) as any[]) {\r\n        for (const p of (d.patients || []) as any[]) {\r\n          const aihId = String(p.aih_id || '').trim()\r\n          const aihNumber = String((p?.aih_info?.aih_number || '')).replace(/\\D/g, '').replace(/^0+/, '')\r\n          const key = aihId || aihNumber || `${p.patient_id || ''}|${p?.aih_info?.admission_date || ''}`\r\n          if (key) uniqueKeys[key] = true\r\n        }\r\n      }\r\n      const totalCardAihs = Object.keys(uniqueKeys).length\r\n      const totalAihsWithProcedures = aihIdsWithProcedures.size\r\n      const totalAihsWithoutProcedures = Math.max(0, totalCardAihs - totalAihsWithProcedures)\r\n      const summaryRows = [\r\n        ['AIHs (registros nicos) na tela', totalCardAihs],\r\n        ['AIHs com ao menos 1 procedimento calculvel (no relatrio)', totalAihsWithProcedures],\r\n        ['AIHs sem procedimento calculvel (no entram no relatrio)', totalAihsWithoutProcedures],\r\n        ['Linhas no relatrio (procedimentos)', rows.length]\r\n      ]\r\n      const wsSummary = XLSX.utils.aoa_to_sheet([['Resumo'], ...summaryRows])\r\n      const wsSummaryAny: any = wsSummary\r\n      wsSummaryAny['!cols'] = [{ wch: 52 }, { wch: 18 }]\r\n      XLSX.utils.book_append_sheet(wb, wsSummary, 'Resumo')\r\n      const fileName = `Relatorio_Pacientes_Procedimentos_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.xlsx`\r\n      XLSX.writeFile(wb, fileName)\r\n      if (aihsWithoutNumber > 0) toast.success(`Relatrio geral gerado! ${aihsWithoutNumber} registro(s) sem AIH includo(s).`)\r\n      else toast.success('Relatrio geral gerado com sucesso!')\r\n    } catch (e) {\r\n      console.error('Erro ao exportar Relatrio Pacientes:', e)\r\n      toast.error('Erro ao gerar relatrio geral')\r\n    }\r\n  }\r\n\r\n  const generateConferencePatientsReport = async () => {\r\n    try {\r\n      const rows: Array<Array<string | number>> = []\r\n      const aihIdsWithProcedures: Set<string> = new Set()\r\n      const header = ['#', 'Pronturio', 'Nome do Paciente', 'N AIH', 'Data Alta (SUS)', 'Mdico', 'Hospital', 'Pgt. Administrativo', 'AIH Seca', 'Incremento', 'AIH c/ Incremento']\r\n      let idx = 1\r\n      let totalAIHsFound = 0\r\n      let aihsWithoutNumber = 0\r\n      filteredDoctors.forEach((card: any) => {\r\n        const doctorName = card.doctor_info?.name || ''\r\n        const hospitalName = card.hospitals?.[0]?.hospital_name || ''\r\n          ; (card.patients || []).forEach((p: any) => {\r\n            totalAIHsFound++\r\n            const name = p.patient_info?.name || 'Paciente'\r\n            const medicalRecord = p.patient_info?.medical_record || '-'\r\n            const aihRaw = (p?.aih_info?.aih_number || '').toString().replace(/\\D/g, '')\r\n            const aih = aihRaw || 'Aguardando gerao'\r\n            if (!aihRaw) aihsWithoutNumber++\r\n            const disISO = p?.aih_info?.discharge_date || ''\r\n            const disLabel = parseISODateToLocal(disISO)\r\n            const baseAih = Number(p.total_value_reais || 0)\r\n            const doctorCovered = isDoctorCoveredForOperaParana(doctorName, card.hospitals?.[0]?.hospital_id)\r\n            const procedures = (p as any).calculable_procedures || (p.procedures || []).filter(filterCalculableProcedures)\r\n            if (procedures.length > 0) {\r\n              aihIdsWithProcedures.add(String(p.aih_id || aihRaw || `${p.patient_id}|${p?.aih_info?.admission_date || ''}`))\r\n            }\r\n            const increment = doctorCovered ? computeIncrementForProcedures(procedures as any, p?.aih_info?.care_character, doctorName, card.hospitals?.[0]?.hospital_id) : 0\r\n            const aihWithIncrements = baseAih + increment\r\n            const pgtAdm = p?.aih_info?.pgt_adm || 'no'\r\n            rows.push([idx++, medicalRecord, name, aih, disLabel, doctorName, hospitalName, pgtAdm, formatCurrency(baseAih), formatCurrency(increment), formatCurrency(aihWithIncrements)])\r\n          })\r\n      })\r\n      rows.sort((a, b) => { const da = a[4] as string; const db = b[4] as string; if (!da && !db) return 0; if (!da) return 1; if (!db) return -1; const pa = da.split('/'); const pb = db.split('/'); const dA = pa.length === 3 ? new Date(parseInt(pa[2]), parseInt(pa[1]) - 1, parseInt(pa[0])) : new Date(0); const dB = pb.length === 3 ? new Date(parseInt(pb[2]), parseInt(pb[1]) - 1, parseInt(pb[0])) : new Date(0); return dB.getTime() - dA.getTime() })\r\n      rows.forEach((row, index) => { row[0] = index + 1 })\r\n      const wb = XLSX.utils.book_new()\r\n      const ws = XLSX.utils.aoa_to_sheet([header, ...rows])\r\n      const wsAny: any = ws\r\n      wsAny['!cols'] = [{ wch: 5 }, { wch: 15 }, { wch: 35 }, { wch: 18 }, { wch: 16 }, { wch: 30 }, { wch: 35 }, { wch: 20 }, { wch: 18 }, { wch: 18 }, { wch: 20 }]\r\n      XLSX.utils.book_append_sheet(wb, ws, 'AIHs')\r\n      // Resumo com reconciliao (tela x relatrio)\r\n      const uniqueKeys: Record<string, true> = {}\r\n      for (const d of (filteredDoctors || []) as any[]) {\r\n        for (const p of (d.patients || []) as any[]) {\r\n          const aihId = String(p.aih_id || '').trim()\r\n          const aihNumber = String((p?.aih_info?.aih_number || '')).replace(/\\D/g, '').replace(/^0+/, '')\r\n          const key = aihId || aihNumber || `${p.patient_id || ''}|${p?.aih_info?.admission_date || ''}`\r\n          if (key) uniqueKeys[key] = true\r\n        }\r\n      }\r\n      const totalCardAihs = Object.keys(uniqueKeys).length\r\n      const totalAihsWithProcedures = aihIdsWithProcedures.size\r\n      const totalAihsWithoutProcedures = Math.max(0, totalCardAihs - totalAihsWithProcedures)\r\n      const summaryRows = [\r\n        ['AIHs (registros nicos) na tela', totalCardAihs],\r\n        ['AIHs com ao menos 1 procedimento calculvel (no relatrio)', totalAihsWithProcedures],\r\n        ['AIHs sem procedimento calculvel (no entram no relatrio)', totalAihsWithoutProcedures],\r\n        ['Linhas no relatrio (AIHs)', rows.length]\r\n      ]\r\n      const wsSummary = XLSX.utils.aoa_to_sheet([['Resumo'], ...summaryRows])\r\n      const wsSummaryAny: any = wsSummary\r\n      wsSummaryAny['!cols'] = [{ wch: 52 }, { wch: 18 }]\r\n      XLSX.utils.book_append_sheet(wb, wsSummary, 'Resumo')\r\n      const fileName = `Relatorio_AIHs_Conferencia_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.xlsx`\r\n      XLSX.writeFile(wb, fileName)\r\n      if (aihsWithoutNumber > 0) toast.success(`Relatrio de conferncia gerado! ${aihsWithoutNumber} AIH(s) sem nmero includa(s).`)\r\n      else toast.success('Relatrio de conferncia gerado com sucesso!')\r\n    } catch (e) {\r\n      console.error('Erro ao exportar Relatrio Conferncia:', e)\r\n      toast.error('Erro ao gerar relatrio de conferncia')\r\n    }\r\n  }\r\n\r\n  const generateSimplifiedPatientsReport = async () => {\r\n    try {\r\n      const rows: Array<Array<string | number>> = []\r\n      const header = ['#', 'Nome do Paciente', 'Pronturio', 'N AIH', 'Data de Admisso', 'Data de Alta', 'Mdico', 'Pgt. Administrativo', 'AIH Seca', 'Incremento', 'AIH c/ Incremento']\r\n      let idx = 1\r\n      const allPatients: any[] = []\r\n      const globalSeen = new Set<string>()\r\n      const cnsNameMap = new Map<string, string>(\r\n        (filteredDoctors || []).map((d: any) => [String(d?.doctor_info?.cns || '').trim(), d?.doctor_info?.name || ''])\r\n      )\r\n      filteredDoctors.forEach((card: any) => {\r\n        const doctorName = card.doctor_info?.name || 'Mdico no identificado'\r\n        const doctorPatients = dedupPatientsByAIH(card.patients || [])\r\n        doctorPatients.forEach((p: any) => {\r\n          const aih = normalizeAih((p?.aih_info?.aih_number || '').toString())\r\n          const aihDisplay = aih || 'Aguardando gerao'\r\n          if (aih && globalSeen.has(aih)) return\r\n          if (aih) globalSeen.add(aih)\r\n          const name = p.patient_info?.name || 'Paciente'\r\n          const medicalRecord = p.patient_info?.medical_record || '-'\r\n          const admissionISO = p?.aih_info?.admission_date || ''\r\n          const admissionLabel = parseISODateToLocal(admissionISO)\r\n          const dischargeISO = p?.aih_info?.discharge_date || ''\r\n          const dischargeLabel = parseISODateToLocal(dischargeISO)\r\n          const baseAih = Math.round((Number(p.total_value_reais || 0)) * 100) / 100\r\n          const doctorCovered = isDoctorCoveredForOperaParana(doctorName, card.hospitals?.[0]?.hospital_id)\r\n          const incrementRaw = doctorCovered ? computeIncrementForProcedures(p.procedures as any, p?.aih_info?.care_character, doctorName, card.hospitals?.[0]?.hospital_id) : 0\r\n          const increment = Math.round(incrementRaw * 100) / 100\r\n          const aihWithIncrements = Math.round((baseAih + increment) * 100) / 100\r\n          const pgtAdm = p?.aih_info?.pgt_adm || 'no'\r\n          const respCns = String(((p?.aih_info?.cns_responsavel ?? p?.aih_info?.cns_responsible) || '')).trim()\r\n          const resolvedDoctorName = (respCns && !isZeroCns(respCns)) ? (cnsNameMap.get(respCns) || doctorName) : doctorName\r\n          allPatients.push({ name, medicalRecord, aih: aihDisplay, admissionLabel, dischargeLabel, doctorName: resolvedDoctorName, pgtAdm, baseAih, increment, aihWithIncrements })\r\n        })\r\n      })\r\n      allPatients.sort((a, b) => {\r\n        const parseDate = (dateStr: string): Date | null => { if (!dateStr || dateStr === '') return null; const parts = dateStr.split('/'); if (parts.length === 3) return new Date(`${parts[2]}-${parts[1]}-${parts[0]}`); return null }\r\n        const dateA = parseDate(a.dischargeLabel)\r\n        const dateB = parseDate(b.dischargeLabel)\r\n        if (!dateA && !dateB) return 0; if (!dateA) return 1; if (!dateB) return -1\r\n        const cmp = dateA.getTime() - dateB.getTime()\r\n        if (cmp !== 0) return cmp\r\n        return a.name.toLowerCase().localeCompare(b.name.toLowerCase())\r\n      })\r\n      allPatients.forEach((patient) => {\r\n        if (dischargeDateRange && (dischargeDateRange.from || dischargeDateRange.to)) {\r\n          const parse = (s: string): Date | null => { const parts = s.split('/'); if (parts.length === 3) return new Date(`${parts[2]}-${parts[1]}-${parts[0]}`); return null }\r\n          const d = parse(patient.dischargeLabel)\r\n          const start = dischargeDateRange.from ? new Date(dischargeDateRange.from) : null\r\n          const end = dischargeDateRange.to ? new Date(dischargeDateRange.to) : null\r\n          const endExclusive = end ? new Date(end.getFullYear(), end.getMonth(), end.getDate() + 1) : null\r\n          const startFloor = start ? new Date(start.getFullYear(), start.getMonth(), start.getDate()) : null\r\n          if (d) {\r\n            if (startFloor && d < startFloor) return\r\n            if (endExclusive && d >= endExclusive) return\r\n          }\r\n        }\r\n        rows.push([idx++, patient.name, patient.medicalRecord, patient.aih, patient.admissionLabel, patient.dischargeLabel, patient.doctorName, patient.pgtAdm, formatCurrency(patient.baseAih), formatCurrency(patient.increment), formatCurrency(patient.aihWithIncrements)])\r\n      })\r\n      const wb = XLSX.utils.book_new()\r\n      const ws = XLSX.utils.aoa_to_sheet([header, ...rows])\r\n        ; (ws as any)['!cols'] = [{ wch: 5 }, { wch: 40 }, { wch: 16 }, { wch: 18 }, { wch: 18 }, { wch: 18 }, { wch: 30 }, { wch: 20 }, { wch: 18 }, { wch: 18 }, { wch: 20 }]\r\n      XLSX.utils.book_append_sheet(wb, ws, 'Pacientes Simplificado')\r\n      const summary = summarizeDedup(filteredDoctors.flatMap((c: any) => c.patients || []), approvedSetRef.current)\r\n      const summarySheet = XLSX.utils.aoa_to_sheet([\r\n        ['AIHs Locais (dedup)', 'Homologadas (SIH)', 'No Homologadas', 'Duplicatas Detectadas'],\r\n        [summary.aiHsLocais, summary.approved, summary.notApproved, summary.dupCount]\r\n      ])\r\n      XLSX.utils.book_append_sheet(wb, summarySheet, 'Dedup-Teste')\r\n      const fileName = `Relatorio_Pacientes_Simplificado_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.xlsx`\r\n      XLSX.writeFile(wb, fileName)\r\n      toast.success('Relatrio simplificado gerado com sucesso!')\r\n    } catch (e) {\r\n      console.error('Erro ao exportar Relatrio Simplificado:', e)\r\n      toast.error('Erro ao gerar relatrio simplificado')\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    const handlerGeneral = () => { generateGeneralPatientsReport() }\r\n    const handlerConference = () => { generateConferencePatientsReport() }\r\n    const handlerSimplified = () => { generateSimplifiedPatientsReport() }\r\n    const handlerValidation = () => { generateValidationReport(selectedHospitals, selectedCompetencia, useSihSource, filteredDoctors) }\r\n    window.addEventListener('mpd:report-general', handlerGeneral)\r\n    window.addEventListener('mpd:report-conference', handlerConference)\r\n    window.addEventListener('mpd:report-simplified', handlerSimplified)\r\n    window.addEventListener('mpd:report-validation', handlerValidation)\r\n    return () => {\r\n      window.removeEventListener('mpd:report-general', handlerGeneral)\r\n      window.removeEventListener('mpd:report-conference', handlerConference)\r\n      window.removeEventListener('mpd:report-simplified', handlerSimplified)\r\n      window.removeEventListener('mpd:report-validation', handlerValidation)\r\n    }\r\n  }, [filteredDoctors])\r\n\r\n  const validateSimplifiedReport = async (doctor: any) => {\r\n    try {\r\n      approvedSetRef.current = new Set()\r\n      approvalCompetenciaByAihRef.current = new Map()\r\n      const normalizeAih = (s: string) => s.replace(/\\D/g, '').replace(/^0+/, '')\r\n      const allAihNumbers = (doctor.patients || [])\r\n        .map((p: any) => normalizeAih(String(p?.aih_info?.aih_number || '').trim()))\r\n        .filter((v: string) => !!v)\r\n      const uniqueAih = Array.from(new Set(allAihNumbers))\r\n      const totalPatients = dedupPatientsByAIH(doctor.patients || []).length\r\n      if (uniqueAih.length === 0) {\r\n        setSimplifiedValidationStats({ total: totalPatients, approved: 0, notApproved: totalPatients, remote: remoteConfigured })\r\n        return\r\n      }\r\n      if (!remoteConfigured) {\r\n        setSimplifiedValidationStats({ total: totalPatients, approved: 0, notApproved: totalPatients, remote: false })\r\n        return\r\n      }\r\n      const { supabaseSih } = await import('../lib/sihSupabase')\r\n      let compYear: number | undefined\r\n      let compMonth: number | undefined\r\n      const chunkSize = 80\r\n      for (let i = 0; i < uniqueAih.length; i += chunkSize) {\r\n        const ch = uniqueAih.slice(i, i + chunkSize)\r\n        const { data: spRows } = await supabaseSih\r\n          .from('sih_sp')\r\n          .select('sp_naih, sp_mm, sp_aa')\r\n          .in('sp_naih', ch)\r\n        if (spRows && spRows.length > 0) {\r\n          spRows.forEach((r: any) => {\r\n            const k = normalizeAih(String(r.sp_naih || '').trim())\r\n            if (k) approvedSetRef.current.add(k)\r\n            const mm = String(r.sp_mm || '').padStart(2, '0')\r\n            const yy = String(r.sp_aa || '').padStart(4, '0')\r\n            if (yy && mm) approvalCompetenciaByAihRef.current.set(k, `${yy}-${mm}-01`)\r\n          })\r\n        }\r\n      }\r\n      const approved = uniqueAih.filter((k: string) => approvedSetRef.current.has(k)).length\r\n      const notApproved = Math.max(totalPatients - approved, 0)\r\n      setSimplifiedValidationStats({ total: totalPatients, approved, notApproved, remote: true })\r\n    } catch {\r\n      setSimplifiedValidationStats({ total: 0, approved: 0, notApproved: 0, remote: remoteConfigured })\r\n    }\r\n  }\r\n\r\n  const generateSimplifiedReport = async (doctor: any, approvedOnly: boolean, excludeZeros?: boolean) => {\r\n    try {\r\n      let logoBase64 = null as string | null\r\n      try {\r\n        const response = await fetch('/CIS Sem fundo.jpg')\r\n        const blob = await response.blob()\r\n        logoBase64 = await new Promise<string>((resolve) => {\r\n          const reader = new FileReader()\r\n          reader.onloadend = () => resolve(reader.result as string)\r\n          reader.readAsDataURL(blob)\r\n        })\r\n      } catch { }\r\n\r\n      const doctorName = doctor.doctor_info?.name || ''\r\n      const hospitalId = doctor.hospitals?.[0]?.hospital_id\r\n      const hospitalName = doctor.hospitals?.[0]?.hospital_name || 'Hospital no identificado'\r\n\r\n      //  DETECO DE PAGAMENTO FIXO MENSAL\r\n      const isMonthly = isFixedMonthlyPayment(doctorName, hospitalId, ALL_HOSPITAL_RULES)\r\n      const fixedCalcReport = calculateFixedPayment(doctorName, hospitalId, ALL_HOSPITAL_RULES)\r\n\r\n      const tableData: Array<Array<string>> = []\r\n      let totalRepasse = 0\r\n      let totalPatientsProcessed = 0\r\n      let patientsWithPayment = 0\r\n\r\n      // Mapear nomes de pacientes quando fonte remota est ativa (join local AIHpatients)\r\n      let nameByAih = new Map<string, string>()\r\n      if (useSihSource) {\r\n        try {\r\n          const normalizeAih = (s: string) => s.replace(/\\D/g, '').replace(/^0+/, '')\r\n          let q = supabase\r\n            .from('aihs')\r\n            .select('aih_number, patient_id, discharge_date, competencia, patients(name)')\r\n          if (hospitalId) q = q.eq('hospital_id', hospitalId)\r\n          if (selectedCompetencia && selectedCompetencia !== 'all') q = q.eq('competencia', selectedCompetencia)\r\n          if (dischargeDateRange && (dischargeDateRange.from || dischargeDateRange.to)) {\r\n            const from = dischargeDateRange.from || undefined\r\n            const to = dischargeDateRange.to || undefined\r\n            const endExclusive = to ? new Date(to) : undefined\r\n            if (endExclusive) endExclusive.setDate(endExclusive.getDate() + 1)\r\n            if (from) q = q.gte('discharge_date', from)\r\n            if (endExclusive) q = q.lt('discharge_date', endExclusive.toISOString().slice(0, 10))\r\n            q = q.not('discharge_date', 'is', null)\r\n          }\r\n          const { data: rows } = await q\r\n            ; (rows || []).forEach((r: any) => {\r\n              const key = normalizeAih(String(r.aih_number || ''))\r\n              const nm = String(r?.patients?.name || '')\r\n              if (key && nm) nameByAih.set(key, nm)\r\n            })\r\n          // Fallback: completar nomes para AIHs faltantes sem filtrar por competncia/alta\r\n          const missingAihs = dedupPatientsByAIH(doctor.patients || [])\r\n            .map((p: any) => normalizeAih(String(p?.aih_info?.aih_number || '').trim()))\r\n            .filter(k => k && !nameByAih.has(k))\r\n          if (missingAihs.length > 0) {\r\n            const { data: rows2 } = await supabase\r\n              .from('aihs')\r\n              .select('aih_number, patients(name)')\r\n              .in('aih_number', missingAihs)\r\n              ; (rows2 || []).forEach((r: any) => {\r\n                const key = normalizeAih(String(r.aih_number || ''))\r\n                const nm = String(r?.patients?.name || '')\r\n                if (key && nm && !nameByAih.has(key)) nameByAih.set(key, nm)\r\n              })\r\n          }\r\n        } catch { }\r\n      }\r\n\r\n      const patientsDedup = dedupPatientsByAIH(doctor.patients || [])\r\n      patientsDedup.forEach((p: any) => {\r\n        totalPatientsProcessed++\r\n        const aihNumber = normalizeAih(String(p?.aih_info?.aih_number || '').trim())\r\n        if (approvedOnly && (!aihNumber || !approvedSetRef.current.has(aihNumber))) return\r\n\r\n        const medicalRecord = p.patient_info?.medical_record || '-'\r\n        let name = p.patient_info?.name || ''\r\n        if (!name || name === 'Nome no disponvel' || name === 'Paciente') {\r\n          const candidate = nameByAih.get(aihNumber)\r\n          name = candidate || (name || 'Paciente')\r\n        }\r\n        const procsAll = p.procedures || []\r\n        const calculable = (p as any).calculable_procedures || procsAll.filter(filterCalculableProcedures)\r\n        const mainCandidates = calculable.filter((proc: any) => (typeof proc.registration_instrument === 'string' ? proc.registration_instrument.includes('03') : false) && (proc.cbo !== '225151'))\r\n        let mainProc = mainCandidates.length > 0 ? mainCandidates[0] : null\r\n        if (!mainProc) {\r\n          const seqSorted = calculable.filter((x: any) => x.cbo !== '225151' && typeof x.sequence === 'number').sort((a: any, b: any) => (a.sequence || 9999) - (b.sequence || 9999))\r\n          mainProc = seqSorted[0] || null\r\n        }\r\n        if (!mainProc) {\r\n          mainProc = calculable.filter((x: any) => x.cbo !== '225151').reduce((max: any, proc: any) => {\r\n            const v = typeof proc.value_reais === 'number' ? proc.value_reais : 0\r\n            const mv = typeof (max && max.value_reais) === 'number' ? max.value_reais : -1\r\n            return v > mv ? proc : max\r\n          }, null as any)\r\n        }\r\n        const mainCode = mainProc?.procedure_code || ''\r\n        const mainCodeDigits = mainCode.replace(/\\D/g, '')\r\n        const descFallback = mainCode && sigtapMap ? ((sigtapMap.get(mainCode) || sigtapMap.get(mainCodeDigits) || '') as string) : ''\r\n        const mainProcDesc = ((mainProc?.procedure_description || mainProc?.sigtap_description || descFallback || '') as string).trim()\r\n        const medicalForDisplay = calculable\r\n          .filter((x: any) => isMedicalProcedure(x.procedure_code) && shouldCalculateAnesthetistProcedure(x.cbo, x.procedure_code))\r\n          .sort((a: any, b: any) => {\r\n            const sa = typeof a.sequence === 'number' ? a.sequence : 9999\r\n            const sb = typeof b.sequence === 'number' ? b.sequence : 9999\r\n            if (sa !== sb) return sa - sb\r\n            const va = typeof a.value_reais === 'number' ? a.value_reais : 0\r\n            const vb = typeof b.value_reais === 'number' ? b.value_reais : 0\r\n            return vb - va\r\n          })\r\n        //  CORREO: Mostrar TODOS os procedimentos contemplados (no apenas 2)\r\n        const labels = medicalForDisplay.map((m: any) => {\r\n          const code = m.procedure_code || ''\r\n          const digits = code.replace(/\\D/g, '')\r\n          const descFallback2 = code && sigtapMap ? ((sigtapMap.get(code) || sigtapMap.get(digits) || '') as string) : ''\r\n          const desc = ((m.procedure_description || m.sigtap_description || descFallback2 || '') as string).trim()\r\n          return desc || (code ? `Procedimento ${code}` : 'Procedimento')\r\n        })\r\n        const proceduresDisplay = labels.length > 0 ? labels.join(' + ') : (mainProcDesc || (mainCode ? `Procedimento ${mainCode}` : 'Sem procedimento principal'))\r\n        const dischargeISO = p?.aih_info?.discharge_date || ''\r\n        const dischargeLabel = parseISODateToLocal(dischargeISO)\r\n        if (dischargeDateRange && (dischargeDateRange.from || dischargeDateRange.to)) {\r\n          try {\r\n            const d = dischargeISO ? new Date(dischargeISO) : null\r\n            const start = dischargeDateRange.from ? new Date(dischargeDateRange.from) : null\r\n            const end = dischargeDateRange.to ? new Date(dischargeDateRange.to) : null\r\n            const endExclusive = end ? new Date(end.getFullYear(), end.getMonth(), end.getDate() + 1) : null\r\n            if (d) {\r\n              if (start && d < new Date(start.getFullYear(), start.getMonth(), start.getDate())) return\r\n              if (endExclusive && d >= endExclusive) return\r\n            }\r\n          } catch { }\r\n        }\r\n\r\n        //  CORREO (CDIGO DUPLICADO): Lgica de pendncia sincronizada\r\n        const isApproved = approvedSetRef.current.has(aihNumber);\r\n        const approvedLabel = isApproved ? 'Sim' : 'No';\r\n        const prodCompISO = (p?.aih_info?.competencia || '') as string\r\n        const prodCompLabel = formatCompetencia(prodCompISO)\r\n        const apprCompISO = approvalCompetenciaByAihRef.current.get(aihNumber)\r\n        const apprCompLabel = apprCompISO ? formatCompetencia(apprCompISO) : ''\r\n        // Destacar produo em vermelho apenas quando ms de alta  competncia selecionada\r\n        let highlightProd = false\r\n        if (selectedCompetencia && selectedCompetencia !== 'all') {\r\n          const mDash = selectedCompetencia.match(/^(\\d{4})-(\\d{2})/)\r\n          const m6 = selectedCompetencia.match(/^(\\d{4})(\\d{2})$/)\r\n          const selY = mDash ? parseInt(mDash[1], 10) : (m6 ? parseInt(m6[1], 10) : undefined)\r\n          const selM = mDash ? parseInt(mDash[2], 10) : (m6 ? parseInt(m6[2], 10) : undefined)\r\n          if (selY && selM && dischargeISO) {\r\n            const d = new Date(dischargeISO)\r\n            highlightProd = (d.getUTCFullYear() !== selY) || (d.getUTCMonth() + 1 !== selM)\r\n          }\r\n        }\r\n        const disCompISO = (() => {\r\n          if (!dischargeISO) return ''\r\n          const d = new Date(dischargeISO)\r\n          const yy = String(d.getUTCFullYear()).padStart(4, '0')\r\n          const mm = String(d.getUTCMonth() + 1).padStart(2, '0')\r\n          return `${yy}-${mm}-01`\r\n        })()\r\n        const disCompLabel = formatCompetencia(disCompISO)\r\n        const leftLabel = highlightProd ? disCompLabel : prodCompLabel\r\n        const competenciaLabel = isApproved\r\n          ? (apprCompLabel ? `${highlightProd ? '' : ''}${leftLabel} | ${apprCompLabel}` : `${highlightProd ? '' : ''}${leftLabel}`)\r\n          : ''\r\n\r\n        //  CORREO FINAL: Usar p.procedures diretamente (IGUAL ao card do paciente)\r\n        // O card usa patient.procedures, ento o relatrio deve usar p.procedures\r\n        const proceduresWithPayment = (p.procedures || [])\r\n          .filter((proc: any) =>\r\n            isMedicalProcedure(proc.procedure_code) &&\r\n            shouldCalculateAnesthetistProcedure(proc.cbo, proc.procedure_code)\r\n          )\r\n          .sort((a: any, b: any) => {\r\n            // Ordenar por sequence primeiro, depois por valor (decrescente)\r\n            const sa = typeof a.sequence === 'number' ? a.sequence : 9999;\r\n            const sb = typeof b.sequence === 'number' ? b.sequence : 9999;\r\n            if (sa !== sb) return sa - sb;\r\n            const va = typeof a.value_reais === 'number' ? a.value_reais : 0;\r\n            const vb = typeof b.value_reais === 'number' ? b.value_reais : 0;\r\n            return vb - va;\r\n          })\r\n          .map((proc: any) => ({\r\n            procedure_code: proc.procedure_code,\r\n            procedure_description: proc.procedure_description,\r\n            value_reais: proc.value_reais || 0,\r\n            cbo: proc.cbo,\r\n          }))\r\n        let repasseValue = 0\r\n        if (proceduresWithPayment.length > 0) {\r\n          const isGenSurg = /cirurg/i.test(doctorName) || (/cirurg/i.test(doctor.doctor_info.specialty || '') && /geral/i.test(doctor.doctor_info.specialty || ''))\r\n          const useHon = shouldUseHonForHospital(doctorName, hospitalId, !!isGenSurg)\r\n          const paymentResult = useHon\r\n            ? calculateHonPayments(proceduresWithPayment)\r\n            : calculateDoctorPayment(\r\n              doctorName,\r\n              proceduresWithPayment,\r\n              hospitalId\r\n            )\r\n\r\n          // Se for fixo mensal, o repasse por paciente deve ser ZERO para no multiplicar\r\n          if (isMonthly) {\r\n            repasseValue = 0\r\n          } else {\r\n            repasseValue = paymentResult.totalPayment || 0\r\n          }\r\n\r\n          totalRepasse += repasseValue\r\n\r\n          //  DEBUG: Log detalhado para verificar clculo\r\n          if (name.includes('CICERO') || proceduresWithPayment.length >= 3) {\r\n            console.log(` [DEBUG RELATRIO] Paciente: ${name}`)\r\n            console.log(`    Procedimentos: ${proceduresWithPayment.map(p => p.procedure_code).join(', ')}`)\r\n            console.log(`    Valor calculado: R$ ${repasseValue.toFixed(2)}`)\r\n            console.log(`    Regra aplicada: ${paymentResult.appliedRule || 'N/A'}`)\r\n            paymentResult.procedures.forEach((p, i) => {\r\n              console.log(`   [${i + 1}] ${p.procedure_code}: R$ ${p.calculatedPayment.toFixed(2)} - ${p.paymentRule}`)\r\n            })\r\n          }\r\n        }\r\n        if (!excludeZeros || repasseValue > 0) {\r\n          patientsWithPayment++\r\n          tableData.push([\r\n            '',\r\n            medicalRecord,\r\n            aihNumber || '-',\r\n            name,\r\n            proceduresDisplay,\r\n            dischargeLabel,\r\n            formatCurrency(repasseValue)\r\n          ])\r\n        }\r\n      })\r\n\r\n      tableData.sort((a, b) => {\r\n        const dateA = a[5] as string\r\n        const dateB = b[5] as string\r\n        if (!dateA && !dateB) return 0\r\n        if (!dateA) return 1\r\n        if (!dateB) return -1\r\n        const partsA = dateA.split('/')\r\n        const partsB = dateB.split('/')\r\n        const da = partsA.length === 3 ? new Date(parseInt(partsA[2]), parseInt(partsA[1]) - 1, parseInt(partsA[0])) : new Date(0)\r\n        const db = partsB.length === 3 ? new Date(parseInt(partsB[2]), parseInt(partsB[1]) - 1, parseInt(partsB[0])) : new Date(0)\r\n        return db.getTime() - da.getTime()\r\n      })\r\n      tableData.forEach((row, idx) => { row[0] = String(idx + 1) })\r\n\r\n      //  ADICIONAR LINHA DE TOTAL FIXO MENSAL SE APLICVEL\r\n      if (isMonthly && fixedCalcReport.hasFixedRule) {\r\n        tableData.push([\r\n          '',\r\n          '',\r\n          '',\r\n          'PAGAMENTO FIXO MENSAL',\r\n          fixedCalcReport.paymentRule || 'Valor Fixo',\r\n          '-',\r\n          formatCurrency(fixedCalcReport.calculatedPayment)\r\n        ])\r\n        // Ajustar o total geral para ser o valor fixo (j que os individuais so 0)\r\n        totalRepasse = fixedCalcReport.calculatedPayment\r\n      }\r\n\r\n      const doc = new jsPDF('landscape')\r\n      const pageWidth = doc.internal.pageSize.getWidth()\r\n      const pageHeight = doc.internal.pageSize.getHeight()\r\n      // Fonte do relatrio (topo)\r\n      try {\r\n        const sourceLabel = useSihSource ? 'TABWIN' : 'GSUS'\r\n        doc.setFontSize(10)\r\n        doc.setFont('helvetica', 'bold')\r\n        doc.setTextColor(80, 80, 80)\r\n        doc.text(sourceLabel, pageWidth - 20, 10, { align: 'right' })\r\n      } catch { }\r\n      let yPosition = 20\r\n      if (logoBase64) {\r\n        const logoWidth = 40\r\n        const logoHeight = 20\r\n        const logoX = 20\r\n        const logoY = 8\r\n        doc.addImage(logoBase64, 'JPEG', logoX, logoY, logoWidth, logoHeight)\r\n        yPosition = logoY + logoHeight + 10\r\n      }\r\n      doc.setFontSize(16)\r\n      doc.setFont('helvetica', 'bold')\r\n      doc.setTextColor(0, 51, 102)\r\n      doc.text('RELATRIO DE PACIENTES - MDICO', pageWidth / 2, yPosition, { align: 'center' })\r\n      yPosition += 10\r\n      const careHeader = (filterCareCharacter && filterCareCharacter !== 'all')\r\n        ? CareCharacterUtils.formatForDisplay(filterCareCharacter, false)\r\n        : 'TODOS'\r\n      const compHeader = (selectedCompetencia && selectedCompetencia !== 'all')\r\n        ? formatCompetencia(selectedCompetencia)\r\n        : 'TODAS'\r\n      const dataGeracao = new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' })\r\n      const line1 = [\r\n        { label: 'Mdico: ', value: doctorName, bold: true },\r\n        { label: 'Hospital: ', value: hospitalName }\r\n      ]\r\n      const line2 = [\r\n        { label: 'Comp. Aprovao: ', value: compHeader },\r\n        { label: 'Carter: ', value: careHeader },\r\n        { label: 'Gerado em: ', value: dataGeracao }\r\n      ]\r\n      const separator = '  |  '\r\n      const drawSegments = (segments: Array<{ label: string; value: string; bold?: boolean }>, y: number, fontSize = 10) => {\r\n        doc.setFontSize(fontSize)\r\n        doc.setTextColor(60, 60, 60)\r\n        let totalWidth = 0\r\n        segments.forEach((seg, idx) => {\r\n          totalWidth += doc.getTextWidth(seg.label) + doc.getTextWidth(seg.value)\r\n          if (idx < segments.length - 1) totalWidth += doc.getTextWidth(separator)\r\n        })\r\n        let x = (pageWidth / 2) - (totalWidth / 2)\r\n        segments.forEach((seg, idx) => {\r\n          doc.setFont('helvetica', 'normal')\r\n          doc.text(seg.label, x, y)\r\n          x += doc.getTextWidth(seg.label)\r\n          doc.setFont('helvetica', seg.bold ? 'bold' : 'normal')\r\n          doc.text(seg.value, x, y)\r\n          x += doc.getTextWidth(seg.value)\r\n          if (idx < segments.length - 1) {\r\n            doc.setFont('helvetica', 'normal')\r\n            doc.setTextColor(100, 100, 100)\r\n            doc.text(separator, x, y)\r\n            doc.setTextColor(60, 60, 60)\r\n            x += doc.getTextWidth(separator)\r\n          }\r\n        })\r\n      }\r\n      drawSegments(line1, yPosition, 11)\r\n      yPosition += 6\r\n      drawSegments(line2, yPosition, 10)\r\n      yPosition += 8\r\n      doc.setDrawColor(200, 200, 200)\r\n      doc.setLineWidth(0.5)\r\n      doc.line(20, yPosition, pageWidth - 20, yPosition)\r\n      const metricY = yPosition + 7\r\n      const patientsCount = tableData.length\r\n      doc.setFontSize(10)\r\n      doc.setTextColor(60, 60, 60)\r\n      doc.text('Pacientes:', 20, metricY)\r\n      doc.setFont('helvetica', 'bold')\r\n      doc.setTextColor(0, 51, 102)\r\n      doc.text(String(patientsCount), 48, metricY)\r\n      doc.setFont('helvetica', 'normal')\r\n      doc.setTextColor(60, 60, 60)\r\n      doc.text('Valor Total:', pageWidth - 90, metricY)\r\n      doc.setFont('helvetica', 'bold')\r\n      doc.setTextColor(0, 102, 0)\r\n      doc.text(formatCurrency(totalRepasse), pageWidth - 20, metricY, { align: 'right' })\r\n      const startY = yPosition + 16\r\n      autoTable(doc, {\r\n        head: [['#', 'Pronturio', 'N da AIH', 'Nome do Paciente', 'Procedimentos', 'Data Alta', 'Valor de Repasse']],\r\n        body: tableData,\r\n        startY,\r\n        theme: 'striped',\r\n        tableWidth: 'auto',\r\n        headStyles: { fillColor: [0, 51, 102], textColor: [255, 255, 255], fontStyle: 'bold', fontSize: 9, halign: 'center', cellPadding: 2 },\r\n        bodyStyles: { fontSize: 8, textColor: [50, 50, 50], cellPadding: 2 },\r\n        columnStyles: {\r\n          0: { cellWidth: 'auto', halign: 'center' },\r\n          1: { cellWidth: 'auto', halign: 'center' },\r\n          2: { cellWidth: 'auto', halign: 'center' },\r\n          3: { cellWidth: 'auto', halign: 'left' },\r\n          4: { cellWidth: 'auto', halign: 'left', fontSize: 7 },\r\n          5: { cellWidth: 'auto', halign: 'center' },\r\n          6: { cellWidth: 'auto', halign: 'right', fontStyle: 'bold', textColor: [0, 102, 0] }\r\n        },\r\n        styles: { overflow: 'linebreak', cellPadding: 2, fontSize: 8 },\r\n        margin: { left: 20, right: 20 },\r\n        alternateRowStyles: { fillColor: [245, 245, 245] },\r\n\r\n      })\r\n      const finalY = (doc as any).lastAutoTable?.finalY || startY + 50\r\n      const footerBaseY = pageHeight - 20\r\n      doc.setDrawColor(200, 200, 200)\r\n      doc.setLineWidth(0.5)\r\n      const lineY = Math.max(finalY + 8, footerBaseY - 10)\r\n      doc.line(20, lineY, pageWidth - 20, lineY)\r\n      doc.setFontSize(8)\r\n      doc.setFont('helvetica', 'normal')\r\n      doc.setTextColor(120, 120, 120)\r\n      doc.text('CIS - Centro Integrado em Sade', pageWidth / 2, lineY + 5, { align: 'center' })\r\n      doc.setFontSize(9)\r\n      doc.setFont('helvetica', 'bold')\r\n      doc.setTextColor(0, 51, 102)\r\n      doc.text(`Valor Total de Repasse: ${formatCurrency(totalRepasse)}`, pageWidth / 2, lineY + 15, { align: 'center' })\r\n      const fileName = `Relatorio_Pacientes_Simplificado_${doctorName.replace(/\\s+/g, '_')}_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.pdf`\r\n      doc.save(fileName)\r\n      toast.success('Relatrio PDF gerado com sucesso!')\r\n    } catch (err) {\r\n      console.error('Erro ao exportar Relatrio Simplificado (PDF):', err)\r\n      toast.error('Erro ao gerar relatrio PDF')\r\n    }\r\n  }\r\n\r\n  //  FUNO PARA DETERMINAR HOSPITAL CORRETO BASEADO NO CONTEXTO\r\n  const getDoctorContextualHospitalId = (doctor: DoctorWithPatients): string | undefined => {\r\n    // Se h filtro de hospital especfico (no 'all'), usar o primeiro selecionado\r\n    if (selectedHospitals.length > 0 && !selectedHospitals.includes('all')) {\r\n      // Verificar se o mdico atende no hospital selecionado\r\n      const selectedHospitalId = selectedHospitals[0];\r\n      const doctorWorksInSelectedHospital = doctor.hospitals?.some(h => h.hospital_id === selectedHospitalId);\r\n\r\n      if (doctorWorksInSelectedHospital) {\r\n        console.log(` Usando hospital selecionado ${selectedHospitalId} para ${doctor.doctor_info.name}`);\r\n        return selectedHospitalId;\r\n      }\r\n    }\r\n\r\n    // Fallback: usar o primeiro hospital do mdico\r\n    const fallbackHospitalId = doctor.hospitals?.[0]?.hospital_id;\r\n    console.log(` Usando hospital fallback ${fallbackHospitalId} para ${doctor.doctor_info.name}`);\r\n    return fallbackHospitalId;\r\n  };\r\n  const [reportPreset, setReportPreset] = useState<{ hospitalId?: string; doctorName?: string } | null>(null);\r\n  //  ESTADOS PARA PAGINAO DE PACIENTES\r\n  const [currentPatientPage, setCurrentPatientPage] = useState<Map<string, number>>(new Map());\r\n  const [localPatientSearchTerm, setLocalPatientSearchTerm] = useState<Map<string, string>>(new Map());\r\n  const [procedureSearchTerm, setProcedureSearchTerm] = useState<Map<string, string>>(new Map());\r\n  const PATIENTS_PER_PAGE = 10;\r\n\r\n  //  ESTADOS PARA PAGINAO DE MDICOS\r\n  const [currentDoctorPage, setCurrentDoctorPage] = useState<number>(1);\r\n  const DOCTORS_PER_PAGE = 10;\r\n\r\n  //  BUSCAR TOTAIS SIH REMOTOS QUANDO TOGGLE ATIVO\r\n  useEffect(() => {\r\n    if (useSihSource && remoteConfigured) {\r\n      fetchSihRemoteTotals().then(totals => {\r\n        setSihRemoteTotals(totals);\r\n      }).catch(error => {\r\n        console.error(' Erro ao buscar totais SIH remotos:', error);\r\n        setSihRemoteTotals(null);\r\n      });\r\n    } else {\r\n      setSihRemoteTotals(null);\r\n    }\r\n  }, [useSihSource, selectedHospitals, selectedCompetencia]);\r\n\r\n  //  CARREGAR LISTA DE HOSPITAIS DISPONVEIS\r\n  const loadAvailableHospitals = async (doctorsData: DoctorWithPatients[]) => {\r\n    try {\r\n      // Extrair hospitais nicos dos dados dos mdicos\r\n      const hospitalSet = new Set<string>();\r\n      const hospitalMap = new Map<string, string>();\r\n\r\n      doctorsData.forEach(doctor => {\r\n        doctor.hospitals?.forEach(hospital => {\r\n          if (hospital.hospital_id && hospital.hospital_name && hospital.hospital_name !== 'Hospital no definido') {\r\n            hospitalSet.add(hospital.hospital_id);\r\n            hospitalMap.set(hospital.hospital_id, hospital.hospital_name);\r\n          }\r\n        });\r\n      });\r\n\r\n      // Buscar hospitais adicionais da tabela hospitals se necessrio\r\n      const { data: hospitalsFromDB } = await supabase\r\n        .from('hospitals')\r\n        .select('id, name, cnes') //  Incluir CNES (identificador SUS)\r\n        .order('name');\r\n\r\n      if (hospitalsFromDB) {\r\n        // Criar mapa para armazenar tambm o CNES\r\n        const hospitalCnesMap = new Map<string, string>();\r\n        hospitalsFromDB.forEach(hospital => {\r\n          hospitalSet.add(hospital.id);\r\n          hospitalMap.set(hospital.id, hospital.name);\r\n          if (hospital.cnes) {\r\n            hospitalCnesMap.set(hospital.id, hospital.cnes);\r\n          }\r\n        });\r\n\r\n        // Converter para array ordenado incluindo CNES\r\n        const hospitalsList = Array.from(hospitalSet)\r\n          .map(id => ({\r\n            id,\r\n            name: hospitalMap.get(id) || `Hospital ${id}`,\r\n            cnes: hospitalCnesMap.get(id) //  Incluir CNES\r\n          }))\r\n          .sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n        setAvailableHospitals(hospitalsList);\r\n        console.log(' Hospitais disponveis:', hospitalsList);\r\n        return; // Early return aps processar hospitais do DB\r\n      }\r\n\r\n      // Fallback se no houver hospitais do DB\r\n      const hospitalsList = Array.from(hospitalSet)\r\n        .map(id => ({ id, name: hospitalMap.get(id) || `Hospital ${id}` }))\r\n        .sort((a, b) => a.name.localeCompare(b.name));\r\n\r\n      setAvailableHospitals(hospitalsList);\r\n      console.log(' Hospitais disponveis:', hospitalsList);\r\n    } catch (error) {\r\n      console.error(' Erro ao carregar hospitais:', error);\r\n    }\r\n  };\r\n\r\n  //  FUNO PARA CARREGAR PROCEDIMENTOS SEPARADAMENTE (SOLUO IMEDIATA)\r\n  const loadProceduresForPatients = async (doctorsData: DoctorWithPatients[]) => {\r\n    try {\r\n      console.log(' SOLUO IMEDIATA: Carregando procedimentos separadamente...');\r\n\r\n      // 1. ESTRATGIA DIRETA: Buscar TODOS os procedimentos da tabela procedure_records\r\n      console.log(' [SOLUO DEFINITIVA] Buscando TODOS os procedimentos (sem qualquer limite)...');\r\n      const sampleResult = await ProcedureRecordsService.getAllProcedures(); // Buscar TODOS sem limite\r\n\r\n      if (!sampleResult.success) {\r\n        console.error(' Erro ao buscar amostra de procedimentos:', sampleResult.error);\r\n        return;\r\n      }\r\n\r\n      console.log(` Encontrados ${sampleResult.procedures.length} procedimentos TOTAIS`);\r\n      console.log(' Exemplo de procedure_record:', sampleResult.procedures[0]);\r\n\r\n      // 2. Coletar informaes dos pacientes dos mdicos PRIMEIRO\r\n      const doctorPatients = new Map<string, any>();\r\n      const doctorPatientIds = new Set<string>();\r\n\r\n      doctorsData.forEach(doctor => {\r\n        doctor.patients.forEach(patient => {\r\n          // Buscar por patient_id real (UUID da tabela patients)\r\n          const patientRecord = patient.patient_info || patient;\r\n\r\n          // Tentar encontrar o patient_id real atravs da relao AIH  patient\r\n          // Normalmente estar em patient.patient_id ou similar\r\n          let realPatientId = null;\r\n\r\n          // Estratgia 1: Buscar na estrutura patient_info\r\n          if ((patientRecord as any).id) {\r\n            realPatientId = (patientRecord as any).id;\r\n          }\r\n\r\n          // Estratgia 2: Buscar atravs do CNS na tabela patients\r\n          if (!realPatientId && (patientRecord as any).cns) {\r\n            // Adicionar CNS para possvel lookup\r\n            doctorPatients.set((patientRecord as any).cns, patient);\r\n            doctorPatientIds.add((patientRecord as any).cns);\r\n          }\r\n\r\n          // Estratgia 3: Se tiver patient_id direto\r\n          if ((patient as any).patient_id) {\r\n            doctorPatients.set((patient as any).patient_id, patient);\r\n            doctorPatientIds.add((patient as any).patient_id);\r\n          }\r\n\r\n          // Registrar tambm o realPatientId se encontrado\r\n          if (realPatientId) {\r\n            doctorPatients.set(realPatientId, patient);\r\n            doctorPatientIds.add(realPatientId);\r\n          }\r\n        });\r\n      });\r\n\r\n      console.log(` Pacientes dos mdicos registrados: ${doctorPatients.size}`);\r\n      console.log(' [DEBUG] Patient IDs dos mdicos (primeiros 10):', Array.from(doctorPatientIds).slice(0, 10));\r\n\r\n      // 3. Coletar patient_ids nicos dos procedimentos encontrados\r\n      const procedurePatientIds = [...new Set(sampleResult.procedures.map(p => p.patient_id))];\r\n      console.log(` Patient IDs nicos nos procedimentos: ${procedurePatientIds.length}`);\r\n      console.log(' Primeiros patient_ids dos procedimentos:', procedurePatientIds.slice(0, 5));\r\n\r\n      // 4.  SOLUO DEFINITIVA: Associao via CNS (nico e confivel)\r\n      console.log('\\n SOLUO VIA CNS: Usando CNS como chave nica de associao!');\r\n\r\n      // Coletar CNS dos pacientes dos mdicos\r\n      const patientCNSs = new Set<string>();\r\n      const cnsToPatientMap = new Map<string, any>();\r\n\r\n      doctorsData.forEach(doctor => {\r\n        doctor.patients.forEach(patient => {\r\n          const cns = patient.patient_info?.cns;\r\n          if (cns) {\r\n            patientCNSs.add(cns);\r\n            cnsToPatientMap.set(cns, patient);\r\n          }\r\n        });\r\n      });\r\n\r\n      console.log(` Coletados ${patientCNSs.size} CNS nicos dos pacientes`);\r\n      console.log(' Exemplos de CNS:', Array.from(patientCNSs).slice(0, 3));\r\n\r\n      // Buscar patient_ids na tabela patients usando CNS\r\n      const cnsToPatientIdMap = new Map<string, string>();\r\n\r\n      if (patientCNSs.size > 0) {\r\n        try {\r\n          console.log(' Buscando patient_ids via CNS na tabela patients...');\r\n\r\n          // Buscar em lotes para evitar URLs muito grandes\r\n          const cnsArray = Array.from(patientCNSs);\r\n          const batchSize = 100;\r\n\r\n          for (let i = 0; i < cnsArray.length; i += batchSize) {\r\n            const batch = cnsArray.slice(i, i + batchSize);\r\n\r\n            const { data: patientsData, error } = await supabase\r\n              .from('patients')\r\n              .select('id, cns')\r\n              .in('cns', batch);\r\n\r\n            if (!error && patientsData) {\r\n              patientsData.forEach(patient => {\r\n                cnsToPatientIdMap.set(patient.cns, patient.id);\r\n              });\r\n            }\r\n          }\r\n\r\n          console.log(` Encontrados ${cnsToPatientIdMap.size} patient_ids via CNS`);\r\n          console.log(' Exemplos CNS  Patient_ID:', Array.from(cnsToPatientIdMap.entries()).slice(0, 3));\r\n\r\n        } catch (error) {\r\n          console.error(' Erro ao buscar patient_ids via CNS:', error);\r\n        }\r\n      }\r\n\r\n      // Buscar procedimentos usando os patient_ids obtidos via CNS\r\n      let directResult = null;\r\n      const patientIdsViaCNS = new Set(Array.from(cnsToPatientIdMap.values()));\r\n\r\n      if (patientIdsViaCNS.size > 0) {\r\n        console.log(' Buscando procedimentos via PATIENT_IDs obtidos do CNS...');\r\n\r\n        // Filtrar procedimentos da amostra que tm patient_id correspondente\r\n        const proceduresViaPatientId = sampleResult.procedures.filter(proc =>\r\n          proc.patient_id && patientIdsViaCNS.has(proc.patient_id)\r\n        );\r\n\r\n        if (proceduresViaPatientId.length > 0) {\r\n          directResult = {\r\n            success: true,\r\n            procedures: proceduresViaPatientId,\r\n            uniquePatientIds: [...new Set(proceduresViaPatientId.map(p => p.patient_id))]\r\n          };\r\n          console.log(` SUCESSO VIA CNS! Encontrados ${proceduresViaPatientId.length} procedimentos`);\r\n          console.log(` Patient IDs nicos nos procedimentos: ${[...new Set(proceduresViaPatientId.map(p => p.patient_id))].length}`);\r\n        } else {\r\n          console.log(` Nenhum procedimento encontrado via CNS. Verificando incompatibilidade...`);\r\n\r\n          // Debug: verificar alguns patient_ids dos procedimentos vs CNS\r\n          const procedurePatientIds = [...new Set(sampleResult.procedures.map(p => p.patient_id).filter(Boolean))];\r\n          console.log(' Exemplos de patient_ids nos procedimentos:', procedurePatientIds.slice(0, 5));\r\n          console.log(' Exemplos de patient_ids via CNS:', Array.from(patientIdsViaCNS).slice(0, 5));\r\n\r\n          // Tentar busca por proximidade de UUID\r\n          const similarPatientIds = procedurePatientIds.filter(patientId =>\r\n            Array.from(patientIdsViaCNS).some(cnsPatientId =>\r\n              patientId.substring(0, 8) === cnsPatientId.substring(0, 8)\r\n            )\r\n          );\r\n          console.log(' Patient IDs com prefixos similares:', similarPatientIds.slice(0, 3));\r\n        }\r\n      } else {\r\n        console.log(' Nenhum patient_id encontrado via CNS - possvel problema na tabela patients');\r\n      }\r\n\r\n      // 5. Usar resultado via CNS se disponvel, seno usar amostra geral\r\n      const result = (directResult?.success && directResult.procedures.length > 0)\r\n        ? directResult\r\n        : sampleResult;\r\n\r\n      console.log(` USANDO RESULTADO: ${directResult?.success ? 'BUSCA VIA CNS (CORRETO)' : 'AMOSTRA GERAL'}`);\r\n      console.log(` Total de procedimentos: ${result.procedures.length}`);\r\n\r\n      //  DEBUG CRTICO: VERIFICAR DISPONIBILIDADE DE PATIENT_IDs VIA CNS\r\n      const currentProcedurePatientIds = [...new Set(result.procedures.map(p => p.patient_id).filter(Boolean))];\r\n      const intersection = Array.from(patientIdsViaCNS).filter(id => currentProcedurePatientIds.includes(id));\r\n      console.log(` [DEBUG] INTERSEO VIA CNS: ${intersection.length} IDs em comum`);\r\n      if (intersection.length > 0) {\r\n        console.log(' [DEBUG] Patient_IDs em comum via CNS:', intersection.slice(0, 5));\r\n      } else {\r\n        console.log(' [DEBUG] NENHUM PATIENT_ID em comum via CNS!');\r\n        console.log(' [DEBUG] Exemplo Patient_ID via CNS:', Array.from(patientIdsViaCNS)[0]);\r\n        console.log(' [DEBUG] Exemplo Patient_ID procedimento:', currentProcedurePatientIds[0]);\r\n        console.log(' [DEBUG] Total Patient_IDs via CNS:', patientIdsViaCNS.size);\r\n        console.log(' [DEBUG] Total Patient_IDs dos procedimentos:', currentProcedurePatientIds.length);\r\n      }\r\n\r\n      if (!result.success) {\r\n        console.error(' Erro ao carregar procedimentos:', result.error);\r\n        return;\r\n      }\r\n\r\n      console.log(` Encontrados ${result.procedures.length} procedimentos`);\r\n\r\n      //  DEBUG CRTICO: INVESTIGAR DADOS\r\n      if (result.procedures.length > 0) {\r\n        console.log(' [DEBUG] Exemplo de procedimento da tabela:', result.procedures[0]);\r\n        console.log(' [DEBUG] Patient IDs nicos nos procedimentos:', result.uniquePatientIds.slice(0, 10));\r\n        console.log(` [DEBUG] Total de patient_ids nicos: ${result.uniquePatientIds.length}`);\r\n      } else {\r\n        console.log(' [DEBUG] NENHUM PROCEDIMENTO encontrado na tabela procedure_records!');\r\n        // Se no h procedimentos, vamos buscar informaes da tabela\r\n        const debugTableInfo = await ProcedureRecordsService.getTableInfo();\r\n        console.log(' [DEBUG] Info da tabela procedure_records:', debugTableInfo);\r\n      }\r\n\r\n      // 3.  CORREO FINAL: Agrupar procedimentos por patient_id (correto)\r\n      const proceduresByPatientId = new Map<string, ProcedureRecord[]>();\r\n      result.procedures.forEach(proc => {\r\n        if (proc.patient_id) { // S considerar procedimentos com patient_id vlido\r\n          if (!proceduresByPatientId.has(proc.patient_id)) {\r\n            proceduresByPatientId.set(proc.patient_id, []);\r\n          }\r\n          proceduresByPatientId.get(proc.patient_id)!.push(proc);\r\n        }\r\n      });\r\n\r\n      console.log(` Procedimentos agrupados para ${proceduresByPatientId.size} pacientes`);\r\n      console.log(' Exemplos de patient_ids com procedimentos:', Array.from(proceduresByPatientId.keys()).slice(0, 3));\r\n\r\n      // 4. ESTRATGIA INTELIGENTE DE ASSOCIAO COM ESTATSTICAS\r\n      let totalProceduresAssociated = 0;\r\n      let associationsFound = 0;\r\n\r\n      // Contadores de diagnstico\r\n      let patientsWithoutCNS = 0;\r\n      let patientsWithCNSNotInDB = 0;\r\n      let patientsWithValidIdButNoProcedures = 0;\r\n      let patientsWithProcedures = 0;\r\n\r\n      console.log('\\n === INICIANDO ASSOCIAO INTELIGENTE ===');\r\n\r\n      doctorsData.forEach((doctor, doctorIndex) => {\r\n        console.log(`\\n Mdico ${doctorIndex + 1}: ${doctor.doctor_info.name}`);\r\n\r\n        doctor.patients.forEach((patient, patientIndex) => {\r\n          // Limpar procedimentos existentes\r\n          patient.procedures = [];\r\n\r\n          console.log(`   Paciente ${patientIndex + 1}: ${patient.patient_info.name}`);\r\n          console.log(`      CNS: ${patient.patient_info.cns}`);\r\n\r\n          let proceduresToAssign = [];\r\n\r\n          // ESTRATGIA 1:  BUSCA VIA CNS  PATIENT_ID (SOLUO DEFINITIVA)\r\n          const patientCNS = patient.patient_info?.cns;\r\n\r\n          if (patientCNS) {\r\n            console.log(`       Buscando procedimentos via CNS: ${patientCNS}`);\r\n\r\n            // Buscar patient_id atravs do CNS\r\n            const patientIdViaCNS = cnsToPatientIdMap.get(patientCNS);\r\n\r\n            if (patientIdViaCNS) {\r\n              console.log(`       Patient_ID encontrado via CNS: ${patientIdViaCNS}`);\r\n\r\n              // Buscar procedimentos usando o patient_id\r\n              const foundProcedures = proceduresByPatientId.get(patientIdViaCNS);\r\n              if (foundProcedures && foundProcedures.length > 0) {\r\n                proceduresToAssign = foundProcedures;\r\n                console.log(`       ENCONTRADOS ${foundProcedures.length} procedimentos via CNS!`);\r\n                associationsFound++;\r\n                patientsWithProcedures++;\r\n              } else {\r\n                console.log(`       Patient_ID encontrado mas sem procedimentos: ${patientIdViaCNS}`);\r\n                patientsWithValidIdButNoProcedures++;\r\n              }\r\n            } else {\r\n              console.log(`       CNS no encontrado na tabela patients: ${patientCNS}`);\r\n              patientsWithCNSNotInDB++;\r\n            }\r\n          } else {\r\n            console.log(`       Paciente sem CNS: ${patient.patient_info?.name}`);\r\n            patientsWithoutCNS++;\r\n          }\r\n\r\n          // ESTRATGIA 2: Debug especfico para identificar o problema\r\n          if (proceduresToAssign.length === 0) {\r\n            console.log(`       DIAGNSTICO DETALHADO PARA: ${patient.patient_info?.name}`);\r\n            console.log(`         CNS do paciente: ${patientCNS}`);\r\n\r\n            if (!patientCNS) {\r\n              console.log(`         PROBLEMA: Paciente sem CNS`);\r\n            } else {\r\n              const patientIdViaCNS = cnsToPatientIdMap.get(patientCNS);\r\n              console.log(`         Patient_ID via CNS: ${patientIdViaCNS}`);\r\n\r\n              if (!patientIdViaCNS) {\r\n                console.log(`         PROBLEMA: CNS no encontrado na tabela patients`);\r\n                console.log(`         SOLUO: Verificar se CNS ${patientCNS} existe na tabela patients`);\r\n\r\n                // Verificar se  problema de formatao do CNS\r\n                const similarCNS = Array.from(cnsToPatientIdMap.keys()).filter(cns =>\r\n                  cns.replace(/\\D/g, '') === patientCNS.replace(/\\D/g, '')\r\n                );\r\n                if (similarCNS.length > 0) {\r\n                  console.log(`         CNS com formatao similar encontrado: ${similarCNS[0]}`);\r\n                }\r\n              } else {\r\n                const hasProcs = proceduresByPatientId.has(patientIdViaCNS);\r\n                console.log(`         Tem procedimentos: ${hasProcs}`);\r\n\r\n                if (!hasProcs) {\r\n                  console.log(`         PROBLEMA: Patient_ID encontrado mas sem procedimentos em procedure_records`);\r\n                  console.log(`         SOLUO: Verificar se patient_id ${patientIdViaCNS} tem registros em procedure_records`);\r\n\r\n                  // Verificar IDs similares\r\n                  const similarPatientIds = Array.from(proceduresByPatientId.keys()).filter(id =>\r\n                    id.substring(0, 8) === patientIdViaCNS.substring(0, 8)\r\n                  );\r\n                  if (similarPatientIds.length > 0) {\r\n                    console.log(`         Patient_IDs similares com procedimentos: ${similarPatientIds.slice(0, 2)}`);\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n\r\n\r\n          if (proceduresToAssign.length > 0) {\r\n            // Converter ProcedureRecord para ProcedureDetail\r\n            const convertedProcedures = proceduresToAssign.map(proc => ({\r\n              procedure_id: proc.id,\r\n              procedure_code: proc.procedure_code,\r\n              procedure_description: proc.procedure_description,\r\n              procedure_date: proc.procedure_date,\r\n              value_reais: (proc.value_charged || proc.total_value || 0) / 100, // Converter centavos para reais\r\n              value_cents: proc.value_charged || proc.total_value || 0,\r\n              approval_status: proc.billing_status || 'pending',\r\n              professional_name: proc.professional_name || proc.professional || 'Profissional no informado',\r\n              cbo: proc.professional_cbo,\r\n              participation: 'Executante'\r\n            }));\r\n\r\n            patient.procedures.push(...convertedProcedures);\r\n            totalProceduresAssociated += convertedProcedures.length;\r\n\r\n            console.log(`       Associados ${convertedProcedures.length} procedimentos`);\r\n            console.log(`       Cdigos: ${convertedProcedures.map(p => p.procedure_code).join(', ')}`);\r\n          } else {\r\n            console.log(`        Nenhum procedimento encontrado`);\r\n          }\r\n        });\r\n      });\r\n\r\n      console.log('\\n === RESULTADO DA ASSOCIAO (VIA CNS) ===');\r\n      console.log(` Total de procedimentos associados: ${totalProceduresAssociated}`);\r\n      console.log(` Associaes diretas encontradas: ${associationsFound}`);\r\n      console.log(` Total de pacientes processados: ${doctorsData.reduce((sum, d) => sum + d.patients.length, 0)}`);\r\n\r\n      //  RESUMO ESTATSTICO DETALHADO\r\n      const totalPatients = doctorsData.reduce((sum, d) => sum + d.patients.length, 0);\r\n\r\n      console.log('\\n === RESUMO ESTATSTICO DETALHADO ===');\r\n      console.log(` Procedimentos na tabela: ${result.procedures.length}`);\r\n      console.log(` Patient IDs nicos nos procedimentos: ${currentProcedurePatientIds.length}`);\r\n      console.log(` CNS nicos dos mdicos: ${patientCNSs.size}`);\r\n      console.log(` Patient_IDs via CNS: ${cnsToPatientIdMap.size}`);\r\n      console.log(` Interseco via CNS: ${intersection.length}`);\r\n\r\n      console.log('\\n === BREAKDOWN POR CATEGORIA ===');\r\n      console.log(` Total de pacientes: ${totalPatients}`);\r\n      console.log(` Pacientes COM procedimentos: ${patientsWithProcedures} (${((patientsWithProcedures / totalPatients) * 100).toFixed(1)}%)`);\r\n      console.log(` Pacientes SEM procedimentos: ${totalPatients - patientsWithProcedures} (${(((totalPatients - patientsWithProcedures) / totalPatients) * 100).toFixed(1)}%)`);\r\n\r\n      console.log('\\n === DETALHAMENTO DOS PROBLEMAS ===');\r\n      if (patientsWithoutCNS > 0) {\r\n        console.log(` Pacientes sem CNS: ${patientsWithoutCNS}`);\r\n        console.log(`    SOLUO: Verificar por que alguns pacientes no tm CNS`);\r\n      }\r\n      if (patientsWithCNSNotInDB > 0) {\r\n        console.log(` CNS no encontrado na tabela patients: ${patientsWithCNSNotInDB}`);\r\n        console.log(`    SOLUO: Verificar se esses CNS existem na tabela patients`);\r\n      }\r\n      if (patientsWithValidIdButNoProcedures > 0) {\r\n        console.log(` Patient_ID vlido mas sem procedimentos: ${patientsWithValidIdButNoProcedures}`);\r\n        console.log(`    SOLUO: Verificar se esses patient_ids tm registros em procedure_records`);\r\n      }\r\n\r\n      if (patientsWithProcedures > 0) {\r\n        console.log(`\\n SUCESSO PARCIAL!`);\r\n        console.log(`    ${patientsWithProcedures} pacientes j esto recebendo procedimentos`);\r\n        console.log(`    Taxa de sucesso: ${((patientsWithProcedures / totalPatients) * 100).toFixed(1)}%`);\r\n      }\r\n\r\n      console.log(` RESULTADO: ${totalProceduresAssociated} procedimentos associados aos pacientes`);\r\n\r\n      //  Log de informao - sem toast (carregamento automtico, no precisa notificar usurio)\r\n      if (totalProceduresAssociated === 0) {\r\n        console.warn(' Nenhum procedimento associado. Verifique os dados.');\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(' Erro ao carregar procedimentos separadamente:', error);\r\n      //  Toast apenas para erro crtico (impacta visualizao de dados)\r\n      toast.error('Erro ao carregar procedimentos');\r\n    }\r\n  };\r\n\r\n  //  CARREGAR DADOS DOS MDICOS COM FILTRO POR HOSPITAL\r\n  useEffect(() => {\r\n    const loadDoctorsData = async () => {\r\n      if (!user) return;\r\n      try {\r\n        setIsLoading(true);\r\n        try { window.dispatchEvent(new Event('mpd:loading-start')) } catch { }\r\n        // Guardar estado inicial vazio quando fonte SIH est ativa sem filtros\r\n        const isRemoteInitial = useSihSource && (\r\n          !selectedHospitals || selectedHospitals.length === 0 || selectedHospitals.includes('all')\r\n        );\r\n        if (isRemoteInitial) {\r\n          setDoctors([]);\r\n          setFilteredDoctors([]);\r\n          setIsLoading(false);\r\n          try { window.dispatchEvent(new Event('mpd:loading-end')) } catch { }\r\n          return;\r\n        }\r\n\r\n        //  DETECTAR MODO DE ACESSO\r\n        const isAdminMode = canAccessAllHospitals() || hasFullAccess() || user.hospital_id === 'ALL';\r\n        const userHospitalId = user.hospital_id;\r\n\r\n        console.log(' Carregando dados dos mdicos...');\r\n        console.log(` Modo de acesso: ${isAdminMode ? 'ADMINISTRADOR (todos os hospitais)' : `USURIO (hospital: ${userHospitalId})`}`);\r\n\r\n        // Para o teste solicitado: carregar TODOS os mdicos que existem em doctor_hospital (sem filtros)\r\n        const doctorsList = await DoctorsCrudService.getAllDoctors();\r\n        const doctorsData = (doctorsList.success ? (doctorsList.data || []) : []).map(d => ({\r\n          doctor_info: {\r\n            name: d.name,\r\n            cns: d.cns,\r\n            crm: d.crm,\r\n            specialty: d.speciality,\r\n          },\r\n          // Construir hospitais com base na lista agregada presente em DoctorsCrudService\r\n          hospitals: (d as any).hospitals?.map((hospitalName: string, idx: number) => ({\r\n            hospital_id: (d as any).hospitalIds?.[idx] || '',\r\n            hospital_name: hospitalName,\r\n            hospital_cnpj: '',\r\n            role: undefined,\r\n            department: undefined,\r\n            is_active: true\r\n          })) || [],\r\n          // Para teste: iniciar pacientes vazio; procedimentos carregados depois se necessrio\r\n          patients: []\r\n        })) as unknown as DoctorWithPatients[];\r\n        console.log(' Mdicos carregados de doctor_hospital:', doctorsData.length);\r\n\r\n        //  CARREGAR PACIENTES VIA AIH PARA CADA MDICO (associao Mdicos  Pacientes)\r\n        // Usa fonte real do banco (aihs + patients), via servio agregador\r\n        let mergedDoctors = doctorsData;\r\n        try {\r\n          //  SIMPLIFICADO: Usar APENAS competncia como filtro (sem filtros de data)\r\n          const selectedHospitalIds = (selectedHospitals && !selectedHospitals.includes('all')) ? selectedHospitals : undefined;\r\n          //  CORREO: Verificar se competncia  vlida (no 'all', no vazia, no undefined/null)\r\n          const competenciaFilter = (selectedCompetencia &&\r\n            selectedCompetencia !== 'all' &&\r\n            selectedCompetencia.trim() !== '' &&\r\n            selectedCompetencia !== undefined &&\r\n            selectedCompetencia !== null)\r\n            ? selectedCompetencia.trim()\r\n            : undefined;\r\n          const careFilter = (filterCareCharacter && filterCareCharacter !== 'all') ? filterCareCharacter : undefined;\r\n\r\n          console.log(' [MedicalProductionDashboard] Carregando dados:', {\r\n            competencia: competenciaFilter || 'TODAS',\r\n            care_character: careFilter || 'TODOS',\r\n            hospitals: selectedHospitalIds || 'TODOS',\r\n            selectedCompetenciaRaw: selectedCompetencia\r\n          });\r\n\r\n          const doctorsWithPatients = await DoctorPatientService.getDoctorsWithPatientsFromProceduresView({\r\n            hospitalIds: selectedHospitalIds,\r\n            competencia: competenciaFilter, //  Passar undefined se no houver filtro\r\n            filterCareCharacter: careFilter,\r\n            dischargeDateRange,\r\n            useSihSource,\r\n            doctorNameContains: searchTerm?.trim() || undefined,\r\n            patientNameContains: patientSearchTerm?.trim() || undefined\r\n          });\r\n          // Usar diretamente a fonte das tabelas, garantindo pacientes e procedimentos\r\n          mergedDoctors = doctorsWithPatients;\r\n          console.log(' Associao Mdicos  Pacientes carregada:', mergedDoctors.filter(d => d.patients.length > 0).length, 'mdicos com pacientes');\r\n        } catch (assocErr) {\r\n          console.warn(' Falha ao carregar associao de pacientes; mantendo lista de mdicos sem pacientes.', assocErr);\r\n        }\r\n\r\n        //  CARREGAR LISTA DE HOSPITAIS DISPONVEIS\r\n        await loadAvailableHospitals(mergedDoctors);\r\n\r\n        //  DUPLICAR POR HOSPITAL: 1 card por par (mdico, hospital)\r\n        const explodedByHospitalRaw: DoctorWithPatients[] = mergedDoctors.flatMap((doc) => {\r\n          const hospitals = doc.hospitals && doc.hospitals.length > 0 ? doc.hospitals : [{ hospital_id: '', hospital_name: 'Hospital no definido', is_active: true } as any];\r\n          return hospitals.map(h => ({\r\n            doctor_info: { ...doc.doctor_info },\r\n            hospitals: [h],\r\n            // Filtrar pacientes para o hospital quando possvel\r\n            patients: doc.patients.filter(p => {\r\n              const patientHospitalId = (p as any).aih_info?.hospital_id;\r\n              if (!patientHospitalId) return true; // se no h hospital na AIH, no filtra\r\n              if (!h.hospital_id) return true;     // se o card no tem hospital_id, mantm\r\n              return patientHospitalId === h.hospital_id;\r\n            })\r\n          }));\r\n        });\r\n\r\n        //  REMOVER DUPLICATAS POR (CNS::HOSPITAL_ID) AO VOLTAR  TELA\r\n        const dedupMap = new Map<string, DoctorWithPatients>();\r\n        for (const d of explodedByHospitalRaw) {\r\n          const key = getDoctorCardKey(d);\r\n          if (!dedupMap.has(key)) {\r\n            dedupMap.set(key, d);\r\n          }\r\n        }\r\n        const explodedByHospital = Array.from(dedupMap.values());\r\n\r\n        setDoctors(explodedByHospital);\r\n        setFilteredDoctors(explodedByHospital);\r\n\r\n        //  Log de informao - sem toast (carregamento inicial automtico)\r\n        console.log(` ${explodedByHospital.length} cartes (mdicohospital) carregados`);\r\n      } catch (error) {\r\n        console.error(' Erro ao carregar dados dos mdicos:', error);\r\n        toast.error('Erro ao carregar dados dos mdicos');\r\n      } finally {\r\n        setIsLoading(false);\r\n        try { window.dispatchEvent(new Event('mpd:loading-end')) } catch { }\r\n      }\r\n    };\r\n\r\n    loadDoctorsData();\r\n  }, [user, canAccessAllHospitals, hasFullAccess, selectedHospitals, refreshTick, selectedCompetencia, filterCareCharacter, dischargeDateRange?.from, dischargeDateRange?.to, useSihSource]);\r\n\r\n  //  CARREGAR COMPETNCIAS DISPONVEIS (apenas das AIHs carregadas atualmente)\r\n  useEffect(() => {\r\n    if (doctors.length > 0) {\r\n      const competencias = new Set<string>();\r\n      doctors.forEach(doctor => {\r\n        doctor.patients.forEach(patient => {\r\n          const comp = (patient as any)?.aih_info?.competencia;\r\n          if (comp) competencias.add(comp);\r\n        });\r\n      });\r\n      const sorted = Array.from(competencias).sort((a, b) => b.localeCompare(a));\r\n      setAvailableCompetencias(sorted);\r\n    } else {\r\n      setAvailableCompetencias([]);\r\n    }\r\n  }, [doctors]);\r\n\r\n  //  SUBSCRIO REALTIME: AIHs e PROCEDURE_RECORDS (apenas inserts)\r\n  useEffect(() => {\r\n    if (!autoRefresh) return; // no assinar realtime se desligado\r\n    const channel = supabase\r\n      .channel('medical-production-realtime')\r\n      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'aihs' }, (payload) => {\r\n        // Filtrar por hospital e perodo ativos, quando possvel\r\n        try {\r\n          const row: any = payload.new;\r\n          if (selectedHospitals && !selectedHospitals.includes('all')) {\r\n            if (!selectedHospitals.includes(row.hospital_id)) return;\r\n          }\r\n          //  REMOVIDO: Filtro de data\r\n        } catch { }\r\n        if (realtimeDebounceRef.current) clearTimeout(realtimeDebounceRef.current);\r\n        realtimeDebounceRef.current = setTimeout(() => setRefreshTick((t) => t + 1), 800);\r\n      })\r\n      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'procedure_records' }, (payload) => {\r\n        try {\r\n          // Se o insert no pertence aos filtros atuais, ignore\r\n          const row: any = payload.new;\r\n          if (selectedHospitals && !selectedHospitals.includes('all')) {\r\n            if (!selectedHospitals.includes(row.hospital_id)) return;\r\n          }\r\n          //  REMOVIDO: Filtro de data\r\n        } catch { }\r\n        if (realtimeDebounceRef.current) clearTimeout(realtimeDebounceRef.current);\r\n        realtimeDebounceRef.current = setTimeout(() => setRefreshTick((t) => t + 1), 800);\r\n      })\r\n      .subscribe();\r\n\r\n    return () => {\r\n      try { supabase.removeChannel(channel); } catch { }\r\n      if (realtimeDebounceRef.current) clearTimeout(realtimeDebounceRef.current);\r\n    };\r\n  }, [autoRefresh, selectedHospitals]);\r\n\r\n  //  POLLING DE BACKUP: desativado por padro para evitar recargas\r\n  // useEffect(() => {\r\n  //   const id = setInterval(() => setRefreshTick(t => t + 1), 60000);\r\n  //   return () => clearInterval(id);\r\n  // }, []);\r\n\r\n  //  Pr-carregar mapas de HON (VBA) para garantir aplicao imediata\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        await Promise.all([\r\n          loadGynHonMap(),\r\n          loadUroHonMap(),\r\n          loadOtoHonMap(),\r\n          loadOtoSaoJoseHonMap(),\r\n          loadVasHonMap()\r\n        ])\r\n        setRefreshTick(t => t + 1)\r\n      } catch { }\r\n    })()\r\n  }, [])\r\n  //  Contagem de AIHs via RPC otimizada (mesmos filtros da tela)\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const hospitalIds = (selectedHospitals.length > 0 && !selectedHospitals.includes('all')) ? selectedHospitals : null;\r\n        const rawCare = String(filterCareCharacter || '').trim();\r\n        const careNormalized = rawCare === '01' ? '1' : rawCare === '02' ? '2' : (rawCare === 'all' ? null : rawCare || null);\r\n        const { data, error } = await supabase.rpc('get_aih_count', {\r\n          hospital_ids: hospitalIds,\r\n          competencia: (selectedCompetencia && selectedCompetencia !== 'all' && selectedCompetencia.trim() !== '') ? selectedCompetencia.trim() : null,\r\n          care_character: careNormalized,\r\n          discharge_from: dischargeDateRange?.from || null,\r\n          discharge_to: dischargeDateRange?.to || null,\r\n          doctor_name: (searchTerm && searchTerm.trim() !== '') ? searchTerm.trim() : null,\r\n          patient_name: (patientSearchTerm && patientSearchTerm.trim() !== '') ? patientSearchTerm.trim() : null\r\n        });\r\n        if (error) {\r\n          console.warn(' Falha RPC get_aih_count:', error);\r\n          try {\r\n            let query = supabase.from('aihs').select('id', { count: 'exact', head: true });\r\n            if (hospitalIds) query = query.in('hospital_id', hospitalIds as any);\r\n            const comp = (selectedCompetencia && selectedCompetencia !== 'all' && selectedCompetencia.trim() !== '') ? selectedCompetencia.trim() : null;\r\n            if (comp) query = query.eq('competencia', comp);\r\n            if (careNormalized) query = query.eq('care_character', careNormalized);\r\n            const from = dischargeDateRange?.from || null;\r\n            const to = dischargeDateRange?.to || null;\r\n            if (from) query = query.gte('discharge_date', from);\r\n            if (to) query = query.lt('discharge_date', new Date(new Date(to).getTime() + 24 * 60 * 60 * 1000).toISOString());\r\n            const { count, error: countErr } = await query;\r\n            if (countErr) {\r\n              console.warn(' Fallback count em aihs falhou:', countErr);\r\n              setDbAihCount(null);\r\n            } else {\r\n              setDbAihCount(typeof count === 'number' ? count : null);\r\n            }\r\n          } catch (fallbackErr) {\r\n            console.warn(' Erro fallback count:', fallbackErr);\r\n            setDbAihCount(null);\r\n          }\r\n        } else {\r\n          setDbAihCount(typeof data === 'number' ? data : null);\r\n        }\r\n      } catch (err) {\r\n        console.warn(' Erro ao obter contagem de AIHs no banco:', err);\r\n        setDbAihCount(null);\r\n      }\r\n    })();\r\n  }, [selectedHospitals, selectedCompetencia, filterCareCharacter, dischargeDateRange, patientSearchTerm, searchTerm]);\r\n\r\n  //  FILTRAR MDICOS BASEADO NO TERMO DE BUSCA, HOSPITAL, CARTER DE ATENDIMENTO E DATAS\r\n  useEffect(() => {\r\n    let filtered = doctors;\r\n\r\n    //  FILTRAR POR HOSPITAL USANDO FILTROS GLOBAIS\r\n    if (selectedHospitals.length > 0 && !selectedHospitals.includes('all')) {\r\n      filtered = filtered.filter(doctor => {\r\n        return doctor.hospitals?.some(hospital =>\r\n          selectedHospitals.includes(hospital.hospital_id)\r\n        );\r\n      });\r\n      console.log(' Aplicando filtros globais de hospital na aba Mdicos:', selectedHospitals);\r\n    }\r\n\r\n    // Auditoria: NO remover pacientes por perodo; manter todos os pacientes associados ao mdico\r\n\r\n    // Auditoria: NO filtrar pacientes por carter de atendimento; manter todos\r\n\r\n    //  FILTRAR POR TERMO DE BUSCA DE MDICO\r\n    if (debouncedSearchTerm.trim()) {\r\n      const searchLower = debouncedSearchTerm.toLowerCase();\r\n      filtered = filtered.filter(doctor => {\r\n        return doctor.doctor_info.name.toLowerCase().includes(searchLower) ||\r\n          doctor.doctor_info.cns.includes(debouncedSearchTerm) ||\r\n          doctor.doctor_info.crm?.toLowerCase().includes(searchLower) ||\r\n          doctor.doctor_info.specialty?.toLowerCase().includes(searchLower);\r\n      });\r\n    }\r\n\r\n    //  Ocultar card \"Dr(a). CNS 000...\" (pagamentos hospitalares)\r\n    filtered = filtered.filter(doctor => !isZeroCns(doctor.doctor_info?.cns));\r\n\r\n    //  NOVO: FILTRAR POR NOME DO PACIENTE\r\n    if (debouncedPatientSearchTerm.trim()) {\r\n      const patientSearchLower = debouncedPatientSearchTerm.toLowerCase();\r\n      console.log(' [FILTRO PACIENTE] Buscando por:', patientSearchTerm);\r\n\r\n      filtered = filtered.map(doctor => {\r\n        // Filtrar apenas os pacientes que coincidem com a busca\r\n        const matchingPatients = doctor.patients.filter(patient => {\r\n          const patientName = patient.patient_info?.name || '';\r\n          const matches = patientName.toLowerCase().includes(patientSearchLower);\r\n          if (matches) {\r\n            console.log(` [FILTRO PACIENTE] Encontrado: ${patientName} (Mdico: ${doctor.doctor_info.name})`);\r\n          }\r\n          return matches;\r\n        });\r\n\r\n        // Retornar mdico apenas se tiver pacientes que coincidem\r\n        return { ...doctor, patients: matchingPatients };\r\n      }).filter(doctor => doctor.patients.length > 0); // Remover mdicos sem pacientes correspondentes\r\n\r\n      console.log(` [FILTRO PACIENTE] Resultado: ${filtered.length} mdicos com pacientes correspondentes`);\r\n    }\r\n\r\n    //  REMOVIDO: Filtros de especialidade mdica e especialidade de atendimento\r\n\r\n    //  SIMPLIFICADO: Filtro de competncia removido (j aplicado no backend)\r\n    // A competncia j  filtrada no carregamento dos dados via DoctorPatientService\r\n\r\n    setFilteredDoctors(filtered);\r\n\r\n    // Reset da pgina atual quando filtros so aplicados\r\n    setCurrentDoctorPage(1);\r\n  }, [debouncedSearchTerm, debouncedPatientSearchTerm, selectedCompetencia, doctors, selectedHospitals]);\r\n\r\n  //  TOGGLE EXPANDIR MDICO\r\n  const toggleDoctorExpansion = (doctorKey: string) => {\r\n    const newExpanded = new Set(expandedDoctors);\r\n    if (newExpanded.has(doctorKey)) {\r\n      newExpanded.delete(doctorKey);\r\n    } else {\r\n      newExpanded.add(doctorKey);\r\n    }\r\n    setExpandedDoctors(newExpanded);\r\n  };\r\n\r\n  //  CALCULAR PACIENTES SEM REPASSE (sob demanda)\r\n  const calculatePatientsWithoutPayment = React.useCallback((doctor: DoctorWithPatients, doctorKey: string) => {\r\n    // Se j calculou, no recalcular\r\n    if (patientsWithoutPaymentCache.has(doctorKey)) {\r\n      return;\r\n    }\r\n\r\n    const hospitalId = doctor.hospitals?.[0]?.hospital_id;\r\n    let patientsWithoutPayment = 0;\r\n    const totalPatients = doctor.patients?.length || 0;\r\n\r\n    // Contar pacientes com pagamento = 0\r\n    (doctor.patients || []).forEach((patient) => {\r\n      const proceduresWithPayment = patient.procedures\r\n        .filter(filterCalculableProcedures)\r\n        .map((proc: any) => ({\r\n          procedure_code: proc.procedure_code,\r\n          procedure_description: proc.procedure_description,\r\n          value_reais: proc.value_reais || 0,\r\n          cbo: proc.cbo,\r\n        }));\r\n\r\n      if (proceduresWithPayment.length > 0) {\r\n        const paymentResult = calculateDoctorPayment(\r\n          doctor.doctor_info.name,\r\n          proceduresWithPayment,\r\n          hospitalId\r\n        );\r\n\r\n        if ((paymentResult.totalPayment || 0) === 0) {\r\n          patientsWithoutPayment++;\r\n        }\r\n      } else {\r\n        // Sem procedimentos calculveis = sem repasse\r\n        patientsWithoutPayment++;\r\n      }\r\n    });\r\n\r\n    // Armazenar no cache\r\n    setPatientsWithoutPaymentCache(prev => new Map(prev).set(doctorKey, {\r\n      count: patientsWithoutPayment,\r\n      total: totalPatients,\r\n      calculated: true\r\n    }));\r\n  }, [patientsWithoutPaymentCache]);\r\n\r\n  const openZeroRepasseModal = React.useCallback(async (doctor: DoctorWithPatients) => {\r\n    try {\r\n      const hospitalId = doctor.hospitals?.[0]?.hospital_id\r\n      const normalizeAih = (s: string) => String(s || '').replace(/\\D/g, '').replace(/^0+/, '')\r\n      const items: Array<{ medicalRecord: string; aihNumber: string; name: string; procedures: string; discharge: string }> = []\r\n      const localMap = sigtapMap\r\n      for (const p of (doctor.patients || []) as any[]) {\r\n        const medicalRecord = p?.patient_info?.medical_record || '-'\r\n        const aihNumber = normalizeAih(p?.aih_info?.aih_number)\r\n        const dischargeISO = p?.aih_info?.discharge_date || ''\r\n        const discharge = parseISODateToLocal(dischargeISO)\r\n        let name = p?.patient_info?.name || 'Paciente'\r\n        const procsAll = p.procedures || []\r\n        const calculable = (p as any).calculable_procedures || procsAll.filter(filterCalculableProcedures)\r\n        const medicalSorted = calculable\r\n          .filter((x: any) => isMedicalProcedure(x.procedure_code) && shouldCalculateAnesthetistProcedure(x.cbo, x.procedure_code))\r\n          .sort((a: any, b: any) => {\r\n            const sa = typeof a.sequence === 'number' ? a.sequence : 9999\r\n            const sb = typeof b.sequence === 'number' ? b.sequence : 9999\r\n            if (sa !== sb) return sa - sb\r\n            const va = typeof a.value_reais === 'number' ? a.value_reais : 0\r\n            const vb = typeof b.value_reais === 'number' ? b.value_reais : 0\r\n            return vb - va\r\n          })\r\n        const labels = medicalSorted.slice(0, 3).map((m: any) => {\r\n          const code = m.procedure_code || ''\r\n          const digits = code.replace(/\\D/g, '')\r\n          const descFallback = code && localMap ? ((localMap.get(code) || localMap.get(digits) || '') as string) : ''\r\n          const desc = ((m.procedure_description || m.sigtap_description || descFallback || '') as string).trim()\r\n          return desc || (code ? `Procedimento ${code}` : 'Procedimento')\r\n        })\r\n        const proceduresLabel = labels.length > 0 ? labels.join(' + ') : 'Sem procedimento principal'\r\n        let repasseValue = 0\r\n        if (medicalSorted.length > 0) {\r\n          const doctorName = doctor.doctor_info?.name || ''\r\n          const isGenSurg = /cirurg/i.test(doctorName) || (/cirurg/i.test(doctor.doctor_info.specialty || '') && /geral/i.test(doctor.doctor_info.specialty || ''))\r\n          const paymentResult = (shouldUseHonForHospital(doctorName, hospitalId, !!isGenSurg)\r\n            ? calculateHonPayments(medicalSorted.map((proc: any) => ({ procedure_code: proc.procedure_code, value_reais: proc.value_reais || 0, cbo: proc.cbo })))\r\n            : calculateDoctorPayment(doctorName, medicalSorted.map((proc: any) => ({ procedure_code: proc.procedure_code, value_reais: proc.value_reais || 0, cbo: proc.cbo })), hospitalId))\r\n          repasseValue = paymentResult.totalPayment || 0\r\n        }\r\n        if (repasseValue === 0) {\r\n          items.push({ medicalRecord, aihNumber: aihNumber || '-', name, procedures: proceduresLabel, discharge })\r\n        }\r\n      }\r\n      setZeroRepasseDoctorName(doctor.doctor_info?.name || '')\r\n      setZeroRepasseItems(items)\r\n      setZeroRepasseOpen(true)\r\n    } catch { }\r\n  }, [sigtapMap])\r\n\r\n  const exportZeroRepasseExcel = React.useCallback(() => {\r\n    const header = ['Pronturio', 'N AIH', 'Nome', 'Procedimentos', 'Data Alta']\r\n    const rows = zeroRepasseItems.map(it => [it.medicalRecord, it.aihNumber, it.name, it.procedures, it.discharge])\r\n    const wb = XLSX.utils.book_new()\r\n    const ws = XLSX.utils.aoa_to_sheet([header, ...rows])\r\n    const wsAny: any = ws\r\n    wsAny['!cols'] = [\r\n      { wch: 14 },\r\n      { wch: 18 },\r\n      { wch: 30 },\r\n      { wch: 50 },\r\n      { wch: 12 }\r\n    ]\r\n    XLSX.utils.book_append_sheet(wb, ws, 'Sem Repasse')\r\n    const fileName = `Sem_Repasse_${(zeroRepasseDoctorName || 'Medico').replace(/\\s+/g, '_')}_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.xlsx`\r\n    XLSX.writeFile(wb, fileName)\r\n  }, [zeroRepasseItems, zeroRepasseDoctorName])\r\n\r\n  //  TOGGLE EXPANDIR PACIENTE\r\n  const togglePatientExpansion = (patientKey: string) => {\r\n    const newExpanded = new Set(expandedPatients);\r\n    if (newExpanded.has(patientKey)) {\r\n      newExpanded.delete(patientKey);\r\n    } else {\r\n      newExpanded.add(patientKey);\r\n    }\r\n    setExpandedPatients(newExpanded);\r\n  };\r\n\r\n  const dedupeReport = React.useMemo(() => {\r\n    try {\r\n      const perAihPerDoctor = new Map<string, Map<string, { sum: number; name: string; cboSet: Set<string>; isAnesth: boolean }>>()\r\n      const nameByCns = new Map<string, string>()\r\n      for (const doctor of filteredDoctors) {\r\n        const cns = doctor.doctor_info.cns || 'NO_CNS'\r\n        nameByCns.set(cns, doctor.doctor_info.name || '')\r\n        for (const p of doctor.patients as any[]) {\r\n          const aihKey = normalizeAihNumber(p?.aih_info?.aih_number)\r\n          if (!aihKey) continue\r\n          let entry = { sum: 0, name: doctor.doctor_info.name || '', cboSet: new Set<string>(), isAnesth: false }\r\n          for (const proc of (p.procedures || [])) {\r\n            const belongs = (proc?.professional_name || '') === (doctor.doctor_info.name || '')\r\n            if (!belongs) continue\r\n            const val = Number(proc.value_reais || 0)\r\n            entry.sum += val\r\n            const cbo = String(proc.cbo || '')\r\n            if (cbo) entry.cboSet.add(cbo)\r\n            if (cbo === '225151') entry.isAnesth = true\r\n          }\r\n          if (!perAihPerDoctor.has(aihKey)) perAihPerDoctor.set(aihKey, new Map<string, { sum: number; name: string; cboSet: Set<string>; isAnesth: boolean }>())\r\n          const byDoctor = perAihPerDoctor.get(aihKey)!\r\n          const prev = byDoctor.get(cns)\r\n          if (prev) {\r\n            prev.sum += entry.sum\r\n            entry.cboSet.forEach(v => prev.cboSet.add(v))\r\n            prev.isAnesth = prev.isAnesth || entry.isAnesth\r\n          } else {\r\n            byDoctor.set(cns, entry)\r\n          }\r\n        }\r\n      }\r\n      const assignment = new Map<string, string>()\r\n      const dedupList: Array<{ aih: string; cns: string; cbo?: string; doctorName?: string; value: number }> = []\r\n      for (const [aihKey, byDoctor] of perAihPerDoctor.entries()) {\r\n        const entries = Array.from(byDoctor.entries())\r\n        const hasNonAnesth = entries.some(([_, info]) => !info.isAnesth && info.sum > 0)\r\n        let candidates = entries\r\n        if (hasNonAnesth) candidates = entries.filter(([_, info]) => !info.isAnesth)\r\n        let bestCns: string | null = null\r\n        let bestVal = -1\r\n        for (const [cns, info] of candidates) {\r\n          if (info.sum > bestVal) { bestVal = info.sum; bestCns = cns }\r\n        }\r\n        if (bestCns) {\r\n          assignment.set(aihKey, bestCns)\r\n          for (const [cns, info] of entries) {\r\n            if (cns !== bestCns && info.sum > 0) {\r\n              const cbo = Array.from(info.cboSet.values())[0]\r\n              dedupList.push({ aih: aihKey, cns, cbo, doctorName: nameByCns.get(cns) || '', value: info.sum })\r\n            }\r\n          }\r\n        }\r\n      }\r\n      const dedupCns = Array.from(new Set(dedupList.map(x => x.cns).filter(Boolean)))\r\n      const dedupCbos = Array.from(new Set(dedupList.map(x => x.cbo).filter(Boolean)))\r\n      return { assignmentMap: assignment, dedupList, dedupCns, dedupCbos }\r\n    } catch {\r\n      return { assignmentMap: new Map<string, string>(), dedupList: [], dedupCns: [], dedupCbos: [] }\r\n    }\r\n  }, [filteredDoctors])\r\n\r\n  //  CALCULAR ESTATSTICAS GLOBAIS AVANADAS\r\n  const globalStats = React.useMemo(() => {\r\n    const totalDoctors = doctors.length;\r\n\r\n    //  PRIORIDADE: Usar totais SIH remotos quando disponveis\r\n    let totalAIHs, totalRevenue, avgTicket;\r\n\r\n    if (useSihSource && remoteConfigured && sihRemoteTotals) {\r\n      // Usar dados SIH remotos para totais principais\r\n      totalAIHs = sihRemoteTotals.totalAIHs;\r\n      totalRevenue = sihRemoteTotals.totalValue;\r\n      avgTicket = totalAIHs > 0 ? totalRevenue / totalAIHs : 0;\r\n\r\n      console.log(` [GLOBAL STATS] Usando SIH remoto: ${totalAIHs} AIHs | R$ ${totalRevenue.toFixed(2)}`);\r\n    } else {\r\n      // Usar clculo local tradicional\r\n      //  CONTAGEM DUPLA: Total de AIHs E Pacientes nicos\r\n      totalAIHs = doctors.reduce((sum, doctor) => sum + doctor.patients.length, 0);\r\n\r\n      // Coletar todos os procedimentos ( EXCLUINDO ANESTESISTAS 04.xxx)\r\n      const allProcedures = doctors.flatMap(doctor =>\r\n        doctor.patients.flatMap(patient =>\r\n          patient.procedures.filter(filterCalculableProcedures)\r\n        )\r\n      );\r\n\r\n      totalRevenue = allProcedures.reduce((sum, proc) => sum + (proc.value_reais || 0), 0);\r\n      avgTicket = totalAIHs > 0 ? totalRevenue / totalAIHs : 0;\r\n    }\r\n\r\n    // Contar pacientes nicos (pessoas diferentes) - sempre local\r\n    const uniquePatientIds = new Set<string>();\r\n    doctors.forEach(doctor => {\r\n      doctor.patients.forEach(patient => {\r\n        if (patient.patient_id) {\r\n          uniquePatientIds.add(patient.patient_id);\r\n        }\r\n      });\r\n    });\r\n    const uniquePatients = uniquePatientIds.size;\r\n\r\n    const totalPatients = totalAIHs; // Mantm compatibilidade (totalPatients = total de AIHs)\r\n\r\n    // Coletar todos os procedimentos ( EXCLUINDO ANESTESISTAS 04.xxx) - sempre local\r\n    const allProcedures = doctors.flatMap(doctor =>\r\n      doctor.patients.flatMap(patient =>\r\n        patient.procedures.filter(filterCalculableProcedures)\r\n      )\r\n    );\r\n\r\n    // Calcular total de procedimentos de anestesistas iniciados em '04' (excluindo cesarianas)\r\n    const totalAnesthetistProcedures04 = doctors.reduce((total, doctor) => {\r\n      const doctorStats = calculateDoctorStats(doctor, dedupeReport.assignmentMap, dischargeDateRange);\r\n      return total + doctorStats.anesthetistProcedures04Count;\r\n    }, 0);\r\n\r\n    const totalProcedures = allProcedures.length;\r\n\r\n    // Anlise de aprovao - sempre local\r\n    const approvedProcedures = allProcedures.filter(p => p.approval_status === 'approved').length;\r\n    const pendingProcedures = allProcedures.filter(p => p.approval_status === 'pending').length;\r\n    const rejectedProcedures = allProcedures.filter(p => p.approval_status === 'rejected').length;\r\n    const approvalRate = totalProcedures > 0 ? (approvedProcedures / totalProcedures) * 100 : 0;\r\n\r\n    // Procedimentos mais comuns\r\n    const procedureFrequency = allProcedures.reduce((acc, proc) => {\r\n      const key = proc.procedure_code;\r\n      acc[key] = (acc[key] || 0) + 1;\r\n      return acc;\r\n    }, {} as Record<string, number>);\r\n\r\n    const mostCommonProcedures = Object.entries(procedureFrequency)\r\n      .sort(([, a], [, b]) => b - a)\r\n      .slice(0, 3)\r\n      .map(([code, count]) => ({ code, count }));\r\n\r\n    // Detectar se so dados de demonstrao\r\n    const isDemoData = doctors.length > 0 && doctors[0].doctor_info.name.includes('Joo Silva') &&\r\n      doctors[0].doctor_info.cns === '123456789012345';\r\n\r\n    return {\r\n      totalDoctors,\r\n      totalPatients, // Total de AIHs (para compatibilidade)\r\n      totalAIHs, // Total de AIHs/internaes\r\n      uniquePatients, // Pacientes nicos\r\n      totalProcedures,\r\n      totalRevenue,\r\n      avgTicket,\r\n      approvedProcedures,\r\n      pendingProcedures,\r\n      rejectedProcedures,\r\n      approvalRate,\r\n      mostCommonProcedures,\r\n      totalAnesthetistProcedures04,\r\n      isDemoData\r\n    };\r\n  }, [doctors, useSihSource, remoteConfigured, sihRemoteTotals]);\r\n\r\n  //  CALCULAR ESTATSTICAS DOS MDICOS FILTRADOS\r\n  const filteredStats = React.useMemo(() => {\r\n    const totalDoctors = filteredDoctors.length;\r\n\r\n    //  PRIORIDADE: Usar totais SIH remotos quando disponveis\r\n    let totalAIHs, totalRevenue;\r\n\r\n    if (useSihSource && remoteConfigured && sihRemoteTotals) {\r\n      // Usar dados SIH remotos para totais principais\r\n      totalAIHs = sihRemoteTotals.totalAIHs;\r\n      totalRevenue = sihRemoteTotals.totalValue;\r\n\r\n      console.log(` [FILTERED STATS] Usando SIH remoto: ${totalAIHs} AIHs | R$ ${totalRevenue.toFixed(2)}`);\r\n    } else {\r\n      // Usar clculo local com deduplicao por AIH\r\n      const uniqueAihSet = new Set<string>();\r\n      filteredDoctors.forEach(doctor => {\r\n        (doctor.patients || []).forEach((p: any) => {\r\n          const aihId = String(p.aih_id || '').trim();\r\n          const aihNumber = String(p?.aih_info?.aih_number || '').replace(/\\D/g, '').replace(/^0+/, '');\r\n          const key = aihId || aihNumber || `${p.patient_id || ''}|${p?.aih_info?.admission_date || ''}`;\r\n          if (key) uniqueAihSet.add(key);\r\n        });\r\n      });\r\n      totalAIHs = uniqueAihSet.size;\r\n\r\n      // Coletar todos os procedimentos dos mdicos filtrados ( EXCLUINDO ANESTESISTAS 04.xxx)\r\n      const allProcedures = filteredDoctors.flatMap(doctor =>\r\n        doctor.patients.flatMap(patient =>\r\n          ((patient as any).calculable_procedures || patient.procedures.filter(filterCalculableProcedures))\r\n        )\r\n      );\r\n\r\n      totalRevenue = allProcedures.reduce((sum, proc) => sum + (proc.value_reais || 0), 0);\r\n    }\r\n\r\n    // Contar pacientes nicos (pessoas diferentes) - sempre local\r\n    const uniquePatientIds = new Set<string>();\r\n    filteredDoctors.forEach(doctor => {\r\n      doctor.patients.forEach(patient => {\r\n        if (patient.patient_id) {\r\n          uniquePatientIds.add(patient.patient_id);\r\n        }\r\n      });\r\n    });\r\n    const uniquePatients = uniquePatientIds.size;\r\n\r\n    const totalPatients = totalAIHs; // Mantm compatibilidade (totalPatients = total de AIHs)\r\n\r\n    // Coletar todos os procedimentos dos mdicos filtrados ( EXCLUINDO ANESTESISTAS 04.xxx) - sempre local\r\n    const allProcedures = filteredDoctors.flatMap(doctor =>\r\n      doctor.patients.flatMap(patient =>\r\n        patient.procedures.filter(filterCalculableProcedures)\r\n      )\r\n    );\r\n\r\n    const totalProcedures = allProcedures.length;\r\n\r\n    return {\r\n      totalDoctors,\r\n      totalPatients, // Total de AIHs (para compatibilidade)\r\n      totalAIHs, // Total de AIHs/internaes\r\n      uniquePatients, // Pacientes nicos\r\n      totalProcedures,\r\n      totalRevenue\r\n    };\r\n  }, [filteredDoctors, useSihSource, remoteConfigured, sihRemoteTotals]);\r\n\r\n  //  NOVO: Calcular pacientes com mltiplas AIHs (igual PatientManagement)\r\n  const multipleAIHsStats = React.useMemo(() => {\r\n    const aihIds = new Set<string>();\r\n    const patientAIHCount = new Map<string, number>();\r\n    const patientDetails = new Map<string, any>();\r\n    const patientAIHsList = new Map<string, any[]>();\r\n\r\n    filteredDoctors.forEach(doctor => {\r\n      doctor.patients.forEach(patient => {\r\n        const aihId = String(patient.aih_id || '').trim();\r\n        if (aihId) aihIds.add(aihId);\r\n        const pid = patient.patient_id || undefined;\r\n        if (pid) {\r\n          const current = patientAIHCount.get(pid) || 0;\r\n          patientAIHCount.set(pid, current + 1);\r\n          if (!patientAIHsList.has(pid)) patientAIHsList.set(pid, []);\r\n          patientAIHsList.get(pid)!.push({\r\n            aih_number: String(patient.aih_info?.aih_number || '').trim() || 'No informado',\r\n            admission_date: patient.aih_info?.admission_date,\r\n            discharge_date: patient.aih_info?.discharge_date,\r\n            competencia: patient.aih_info?.competencia\r\n          });\r\n          if (!patientDetails.has(pid)) {\r\n            patientDetails.set(pid, {\r\n              patient_id: pid,\r\n              patient_name: patient.patient_info?.name || 'Nome no informado',\r\n              patient_cns: patient.patient_info?.cns || 'No informado',\r\n              hospital_name: doctor.hospitals?.[0]?.hospital_name || 'Hospital no informado'\r\n            });\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    const patientsWithMultiple = new Map<string, number>();\r\n    patientAIHCount.forEach((count, patientId) => {\r\n      if (count > 1) patientsWithMultiple.set(patientId, count);\r\n    });\r\n    const totalMultipleAIHs = Array.from(patientsWithMultiple.values()).reduce((sum, count) => sum + count, 0);\r\n    const multipleAIHsDetails = Array.from(patientsWithMultiple.entries())\r\n      .map(([patientId, count]) => ({\r\n        ...patientDetails.get(patientId),\r\n        aih_count: count,\r\n        aihs: patientAIHsList.get(patientId) || []\r\n      }))\r\n      .sort((a, b) => b.aih_count - a.aih_count);\r\n\r\n    return {\r\n      totalAIHs: aihIds.size,\r\n      patientsWithMultipleAIHs: patientsWithMultiple.size,\r\n      totalMultipleAIHs,\r\n      aihsWithoutPatients: 0,\r\n      multipleAIHsDetails\r\n    };\r\n  }, [filteredDoctors]);\r\n\r\n  //  OTIMIZAO CRTICA: CACHE DE STATS POR MDICO\r\n  // Calcula doctorStats UMA VEZ por mdico e reutiliza em todos os contextos\r\n  // Evita reclculos redundantes (5x por mdico  1x por mdico)\r\n  const doctorStatsCache = React.useMemo(() => {\r\n    const cache = new Map<string, ReturnType<typeof calculateDoctorStats>>();\r\n\r\n    for (const doctor of filteredDoctors) {\r\n      const key = getDoctorCardKey(doctor);\r\n      let stats = calculateDoctorStats(doctor, dedupeReport.assignmentMap, dischargeDateRange);\r\n      //  Regra especial: quando a fonte SIH remota est ativa e a especialidade  Anestesiologia,\r\n      // zerar os cards financeiros para evitar dupla contagem (pagamento por AIH  tratado separadamente)\r\n      try {\r\n        const spec = doctor.doctor_info.specialty || '';\r\n        const isAnesth = /anestesiolog/i.test(spec);\r\n        const isPhysio = /fisioterap/i.test(spec);\r\n        if (useSihSource && (isAnesth || isPhysio)) {\r\n          stats = {\r\n            ...stats,\r\n            totalValue: 0,\r\n            operaParanaIncrement: 0,\r\n            totalValueWithOperaParana: 0,\r\n            calculatedPaymentValue: 0,\r\n          };\r\n        }\r\n      } catch { }\r\n      cache.set(key, stats);\r\n    }\r\n\r\n    console.log(` [CACHE] Stats calculados para ${cache.size} mdicos (otimizao: 5x  1x por mdico)`);\r\n    return cache;\r\n  }, [filteredDoctors, dedupeReport.assignmentMap]);\r\n\r\n  //  BUSCAR TOTAIS SIH REMOTOS\r\n  const fetchSihRemoteTotals = React.useCallback(async () => {\r\n    if (!useSihSource || !remoteConfigured) return null;\r\n\r\n    try {\r\n      console.log(' Buscando totais SIH remotos...');\r\n\r\n      // Obter filtros atuais\r\n      const hospitalIds = selectedHospitals?.filter(h => h !== 'all') || [];\r\n      let compYear: number | undefined;\r\n      let compMonth: number | undefined;\r\n\r\n      if (selectedCompetencia && selectedCompetencia !== 'all') {\r\n        const raw = selectedCompetencia.trim();\r\n        if (/^\\d{6}$/.test(raw)) {\r\n          compYear = parseInt(raw.slice(0, 4), 10);\r\n          compMonth = parseInt(raw.slice(4, 6), 10);\r\n        } else {\r\n          const mDash = raw.match(/^(\\d{4})-(\\d{2})/);\r\n          if (mDash) {\r\n            compYear = parseInt(mDash[1], 10);\r\n            compMonth = parseInt(mDash[2], 10);\r\n          }\r\n        }\r\n      }\r\n\r\n      // Mapear hospitalIds locais  CNES\r\n      let cnesList: string[] = [];\r\n      if (hospitalIds.length > 0) {\r\n        const { data: hospData } = await supabase\r\n          .from('hospitals')\r\n          .select('id,cnes')\r\n          .in('id', hospitalIds);\r\n        cnesList = (hospData || []).map((h: any) => String(h.cnes)).filter(Boolean);\r\n      }\r\n\r\n      // Construir query para sih_rd (resumo por competncia/hospital)\r\n      let query = supabaseSih\r\n        .from('sih_rd')\r\n        .select('rd_val_tot, rd_qt_aih, rd_mnem, rd_ano, rd_mes, cnes, ano_cmpt, mes_cmpt, car_int')\r\n        .not('rd_val_tot', 'is', null)\r\n        .not('rd_qt_aih', 'is', null);\r\n\r\n      // Aplicar filtros\r\n      if (cnesList.length > 0) {\r\n        query = query.in('cnes', cnesList);\r\n      } else if (hospitalIds.length > 0) {\r\n        // Fallback\r\n        query = query.in('rd_mnem', hospitalIds);\r\n      }\r\n      if (typeof compYear === 'number') {\r\n        query = query.eq('ano_cmpt', compYear).eq('rd_ano', compYear);\r\n      }\r\n      if (typeof compMonth === 'number') {\r\n        query = query.eq('mes_cmpt', compMonth).eq('rd_mes', compMonth);\r\n      }\r\n      // Filtro por Carter de Atendimento quando aplicvel\r\n      if (filterCareCharacter && filterCareCharacter !== 'all') {\r\n        const raw = String(filterCareCharacter).trim();\r\n        const carIntValue = raw === '1' ? '01' : raw === '2' ? '02' : raw;\r\n        query = query.eq('car_int', carIntValue);\r\n      }\r\n\r\n      const { data, error } = await query;\r\n\r\n      if (error) {\r\n        console.error(' Erro ao buscar totais SIH remotos:', error);\r\n        return null;\r\n      }\r\n\r\n      if (!data || data.length === 0) {\r\n        console.warn(' Nenhum dado SIH remoto encontrado');\r\n        return null;\r\n      }\r\n\r\n      // Calcular totais agregados\r\n      const totals = data.reduce((acc, row) => {\r\n        acc.totalValue += Number(row.rd_val_tot ?? row.val_tot) || 0;\r\n        acc.totalAIHs += Number(row.rd_qt_aih ?? row.qt_aih) || 0;\r\n        return acc;\r\n      }, { totalValue: 0, totalAIHs: 0 });\r\n\r\n      console.log(` Totais SIH remotos: R$ ${totals.totalValue.toFixed(2)} | ${totals.totalAIHs} AIHs`);\r\n\r\n      return {\r\n        totalValue: totals.totalValue,\r\n        totalAIHs: totals.totalAIHs,\r\n        source: 'sih_remote'\r\n      };\r\n\r\n    } catch (error) {\r\n      console.error(' Erro ao buscar totais SIH remotos:', error);\r\n      return null;\r\n    }\r\n  }, [useSihSource, selectedHospitals, selectedCompetencia]);\r\n\r\n  //  NOVOS KPIs: Incremento Eletivo e Incremento Urgncia (separados)\r\n  const aggregatedIncrementBreakdown = React.useMemo(() => {\r\n    try {\r\n      let elective = 0;\r\n      let urgency = 0;\r\n      const countedAihs = new Set<string>();\r\n      for (const doctor of filteredDoctors) {\r\n        const doctorName = doctor.doctor_info?.name || '';\r\n        const hospitalId = doctor.hospitals?.[0]?.hospital_id;\r\n        const patients = doctor.patients || [];\r\n        for (const p of patients as any[]) {\r\n          const aihNumRaw = String(p?.aih_info?.aih_number || '').trim();\r\n          const dis = String(p?.aih_info?.discharge_date || '');\r\n          const aihKey = normalizeAih(aihNumRaw) || `${hospitalId || ''}::${p?.aih_id || ''}::${dis}`;\r\n          if (countedAihs.has(aihKey)) continue;\r\n          countedAihs.add(aihKey);\r\n          const care = (p?.aih_info?.care_character ?? '') as string | number | null;\r\n          const inc = computeIncrementForProcedures(p.procedures as any, care, doctorName, hospitalId) || 0;\r\n          if (isElectiveCare(care)) elective += inc;\r\n          else if (isUrgencyCare(care)) urgency += inc;\r\n        }\r\n      }\r\n      return { elective, urgency };\r\n    } catch {\r\n      return { elective: 0, urgency: 0 };\r\n    }\r\n  }, [filteredDoctors]);\r\n\r\n  //  TOTAIS AGREGADOS PARA O CABEALHO (SIGTAP, Incrementos, Total)\r\n  const aggregatedOperaParanaTotals = React.useMemo(() => {\r\n    try {\r\n      let totalBaseSigtap = 0;\r\n      let totalIncrement = 0;\r\n\r\n      //  PRIORIDADE: Usar dados SIH remotos quando disponveis\r\n      if (useSihSource && remoteConfigured && sihRemoteTotals) {\r\n        console.log(` [TOTAIS AGREGADOS] Usando dados SIH remotos: R$ ${sihRemoteTotals.totalValue.toFixed(2)} | ${sihRemoteTotals.totalAIHs} AIHs`);\r\n        totalBaseSigtap = sihRemoteTotals.totalValue;\r\n\r\n        // Incremento: usar soma deduplicada por AIH (breakdown eletivo/urgncia)\r\n        totalIncrement = (aggregatedIncrementBreakdown.elective || 0) + (aggregatedIncrementBreakdown.urgency || 0);\r\n      } else {\r\n        //  CORREO: Base SIGTAP deve somar AIHs nicas (no por mdico)\r\n        // Deduplificar por (hospital_id, aih_number) para evitar dupla contagem\r\n        const uniqueAihKeys = new Set<string>();\r\n\r\n        for (const doctor of filteredDoctors) {\r\n          // Usar pacientes carregados para cada mdico\r\n          const patients = doctor.patients || [];\r\n          for (const patient of patients as any[]) {\r\n            const hospId = (patient?.aih_info?.hospital_id) || (doctor.hospitals?.[0]?.hospital_id) || '';\r\n            const aihNumRaw = String(patient?.aih_info?.aih_number || '').trim();\r\n            const dis = String(patient?.aih_info?.discharge_date || '');\r\n            const aihKey = `${hospId}::${aihNumRaw || `NOAIH:${patient?.aih_id || patient?.patient_id || ''}:${dis}`}`;\r\n            if (!uniqueAihKeys.has(aihKey)) {\r\n              uniqueAihKeys.add(aihKey);\r\n              totalBaseSigtap += Number(patient?.total_value_reais || 0);\r\n            }\r\n          }\r\n\r\n          // Incremento segue usando valor pr-calculado por mdico (mantm comportamento atual)\r\n          const stats = doctorStatsCache.get(getDoctorCardKey(doctor));\r\n          if (stats) totalIncrement += stats.operaParanaIncrement || 0;\r\n        }\r\n      }\r\n\r\n      console.log(` [TOTAIS AGREGADOS] Base SIGTAP: R$ ${totalBaseSigtap.toFixed(2)} | Incremento: R$ ${totalIncrement.toFixed(2)} | Total: R$ ${(totalBaseSigtap + totalIncrement).toFixed(2)}`);\r\n\r\n      return {\r\n        totalBaseSigtap,\r\n        totalIncrement,\r\n        totalWithIncrement: totalBaseSigtap + totalIncrement\r\n      };\r\n    } catch {\r\n      return { totalBaseSigtap: 0, totalIncrement: 0, totalWithIncrement: 0 };\r\n    }\r\n  }, [filteredDoctors, doctorStatsCache, useSihSource, remoteConfigured, sihRemoteTotals, aggregatedIncrementBreakdown]);\r\n\r\n\r\n\r\n  //  NOVO KPI: Soma dos Pagamentos Mdicos (por mdico) para comparao\r\n  //  CORREO: Somar repasses individuais de cada paciente (igual aos cards individuais)\r\n  const aggregatedMedicalPayments = React.useMemo(() => {\r\n    try {\r\n      let totalPayments = 0;\r\n      console.log(' [TOTAL PAGAMENTOS] Calculando agregado para', filteredDoctors.length, 'mdicos');\r\n\r\n      for (const doctor of filteredDoctors) {\r\n        //  PERFORMANCE: Usar cache de stats (evita reclculo)\r\n        const key = getDoctorCardKey(doctor);\r\n        const stats = doctorStatsCache.get(key);\r\n\r\n        if (!stats) continue;\r\n\r\n        //  USAR O MESMO CLCULO DOS CARDS INDIVIDUAIS\r\n        const doctorPayment = stats.calculatedPaymentValue;\r\n\r\n        console.log(` [TOTAL] ${doctor.doctor_info.name}: R$ ${doctorPayment.toFixed(2)}`);\r\n\r\n        totalPayments += doctorPayment;\r\n      }\r\n\r\n      console.log(' [TOTAL PAGAMENTOS] FINAL: R$', totalPayments.toFixed(2));\r\n      return totalPayments;\r\n    } catch (error) {\r\n      console.error('Erro ao calcular pagamentos mdicos agregados:', error);\r\n      return 0;\r\n    }\r\n  }, [filteredDoctors, doctorStatsCache]);\r\n\r\n  //  ATUALIZAR ESTATSTICAS NO COMPONENTE PAI (BASEADO NOS MDICOS FILTRADOS)\r\n  useEffect(() => {\r\n    if (onStatsUpdate && !isLoading) {\r\n      onStatsUpdate({\r\n        totalRevenue: filteredStats.totalRevenue,\r\n        totalDoctors: filteredStats.totalDoctors,\r\n        totalPatients: filteredStats.totalPatients,\r\n        totalProcedures: filteredStats.totalProcedures,\r\n        patientsWithMultipleAIHs: multipleAIHsStats.patientsWithMultipleAIHs,\r\n        totalMultipleAIHs: multipleAIHsStats.totalMultipleAIHs,\r\n        totalAIHs: (dbAihCount ?? multipleAIHsStats.totalAIHs),\r\n        uniquePatients: filteredStats.uniquePatients, //  Pacientes nicos\r\n        multipleAIHsDetails: multipleAIHsStats.multipleAIHsDetails //  Passar detalhes dos pacientes\r\n      });\r\n    }\r\n  }, [filteredStats, multipleAIHsStats, dbAihCount, onStatsUpdate, isLoading]);\r\n\r\n  //  Nome do hospital selecionado para exibir como badge no ttulo (incluindo CNES)\r\n  const selectedHospitalName = React.useMemo(() => {\r\n    try {\r\n      if (selectedHospitals && selectedHospitals.length > 0 && !selectedHospitals.includes('all')) {\r\n        const id = selectedHospitals[0];\r\n        const match = availableHospitals.find(h => h.id === id);\r\n        if (match) {\r\n          //  Incluir CNES (identificador SUS) se disponvel\r\n          const cnesInfo = match.cnes ? ` - CNES: ${match.cnes}` : '';\r\n          return `${match.name}${cnesInfo}`;\r\n        }\r\n        return 'Hospital selecionado';\r\n      }\r\n      return 'Todos os hospitais';\r\n    } catch {\r\n      return 'Hospital';\r\n    }\r\n  }, [selectedHospitals, availableHospitals]);\r\n\r\n  useEffect(() => {\r\n    const run = async () => {\r\n      try {\r\n        setDiscrepancyLoading(true)\r\n        const hospitalId = (selectedHospitals && !selectedHospitals.includes('all')) ? selectedHospitals[0] : ''\r\n        const hospital = availableHospitals.find(h => h.id === hospitalId)\r\n        const hospitalNameOnly = hospital ? hospital.name : ''\r\n        let month: number | undefined\r\n        let year: number | undefined\r\n        if (selectedCompetencia && selectedCompetencia !== 'all') {\r\n          const raw = selectedCompetencia.trim()\r\n          if (/^\\d{6}$/.test(raw)) {\r\n            year = parseInt(raw.slice(0, 4), 10)\r\n            month = parseInt(raw.slice(4, 6), 10)\r\n          } else {\r\n            const mDash = raw.match(/^(\\d{4})-(\\d{2})/)\r\n            const mSlash = raw.match(/^(\\d{2})\\/(\\d{4})$/)\r\n            if (mDash) { year = parseInt(mDash[1], 10); month = parseInt(mDash[2], 10) }\r\n            else if (mSlash) { month = parseInt(mSlash[1], 10); year = parseInt(mSlash[2], 10) }\r\n          }\r\n        }\r\n        const cardsPatients = filteredDoctors.flatMap(d => d.patients || [])\r\n        const normalizeAih = (s: string) => s.replace(/\\D/g, '').replace(/^0+/, '')\r\n        const cardsSum = cardsPatients.reduce((sum, p: any) => sum + Number(p.total_value_reais || 0), 0)\r\n        const distinctMap = new Map<string, number>()\r\n        let withoutNumber = 0\r\n        for (const p of cardsPatients) {\r\n          const k = normalizeAih(String((p as any)?.aih_info?.aih_number || ''))\r\n          const v = Number((p as any).total_value_reais || 0)\r\n          if (k) {\r\n            if (!distinctMap.has(k)) distinctMap.set(k, v)\r\n          } else {\r\n            withoutNumber++\r\n          }\r\n        }\r\n        const cardsDistinct = Array.from(distinctMap.values()).reduce((a, b) => a + b, 0)\r\n        const cardsAssigned = filteredDoctors.reduce((sum, d) => {\r\n          const key = getDoctorCardKey(d)\r\n          const stats = doctorStatsCache.get(key)\r\n          return sum + (stats ? Number(stats.totalValue || 0) : 0)\r\n        }, 0)\r\n        let remoteDistinct = 0\r\n        const remoteMap = new Map<string, number>()\r\n        if (useSihSource && remoteConfigured && hospital?.cnes && month) {\r\n          const { data: rdRows } = await supabaseSih\r\n            .from('sih_rd')\r\n            .select('n_aih,val_tot')\r\n            .eq('cnes', hospital.cnes)\r\n            .eq('mes_cmpt', month)\r\n            .eq('ano_cmpt', year || new Date().getFullYear())\r\n          const seen = new Set<string>()\r\n          for (const r of rdRows || []) {\r\n            const key = normalizeAih(String((r as any).n_aih || ''))\r\n            if (!seen.has(key)) { seen.add(key); const val = Number((r as any).val_tot || 0); remoteDistinct += val; if (key) remoteMap.set(key, val) }\r\n          }\r\n        }\r\n        let localSigtap = 0\r\n        const localMap = new Map<string, number>()\r\n        if (hospitalId) {\r\n          let q = supabase\r\n            .from('aihs')\r\n            .select('aih_number,calculated_total_value,competencia')\r\n            .eq('hospital_id', hospitalId)\r\n          if (selectedCompetencia && selectedCompetencia !== 'all') q = q.eq('competencia', selectedCompetencia)\r\n          const { data: localRows } = await q\r\n          for (const a of localRows || []) {\r\n            const k = normalizeAih(String((a as any).aih_number || ''))\r\n            const v = Number((a as any).calculated_total_value || 0) / 100\r\n            if (k) localMap.set(k, v)\r\n            localSigtap += v\r\n          }\r\n        }\r\n        const difference = cardsDistinct - (useSihSource && remoteConfigured ? remoteDistinct : localSigtap)\r\n        const unionKeys = new Set<string>([...distinctMap.keys(), ...localMap.keys(), ...remoteMap.keys()])\r\n        const details: Array<{ aih: string; cards: number; sigtap: number; sih?: number; diff: number }> = []\r\n        let missingInLocal = 0\r\n        let missingInCards = 0\r\n        let missingInRemote = 0\r\n        for (const k of unionKeys) {\r\n          const cardsVal = distinctMap.get(k) || 0\r\n          const sigtapVal = localMap.get(k) || 0\r\n          const sihVal = remoteMap.get(k)\r\n          if (!localMap.has(k)) missingInLocal++\r\n          if (!distinctMap.has(k)) missingInCards++\r\n          if (useSihSource && remoteConfigured && !remoteMap.has(k)) missingInRemote++\r\n          details.push({ aih: k, cards: cardsVal, sigtap: sigtapVal, sih: sihVal, diff: cardsVal - sigtapVal })\r\n        }\r\n        details.sort((a, b) => Math.abs(b.diff) - Math.abs(a.diff))\r\n        setDiscrepancyTotals({\r\n          cards_sum_reais: cardsAssigned,\r\n          cards_distinct_sum_reais: cardsDistinct,\r\n          remote_val_tot_distinct_reais: remoteDistinct,\r\n          local_sigtap_total_reais: localSigtap,\r\n          difference_cards_vs_sigtap: difference\r\n        })\r\n        setDiscrepancyDetails(details)\r\n        setDiscrepancyCounts({ missingInLocal, missingInCards, missingInRemote, withoutNumber })\r\n      } catch {\r\n        setDiscrepancyTotals(null)\r\n        setDiscrepancyDetails([])\r\n      } finally {\r\n        setDiscrepancyLoading(false)\r\n      }\r\n    }\r\n    run()\r\n  }, [filteredDoctors, selectedHospitals, availableHospitals, selectedCompetencia, useSihSource])\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-[400px]\">\r\n        <div className=\"text-center\">\r\n          <Loader2 className=\"h-12 w-12 animate-spin text-blue-600 mx-auto mb-4\" />\r\n          <div className=\"text-lg font-semibold\">Carregando dados dos mdicos...</div>\r\n          <div className=\"text-sm text-gray-600\">Aguarde um momento</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n\r\n\r\n      {/*  COMPONENTE DE DIAGNSTICO */}\r\n      {showDiagnostic && (\r\n        <DataDiagnostics onClose={() => setShowDiagnostic(false)} />\r\n      )}\r\n\r\n      {/*  DIAGNSTICO DE PROCEDIMENTOS */}\r\n      {showProcedureDiagnostic && (\r\n        <ProcedurePatientDiagnostic />\r\n      )}\r\n\r\n      {/*  DEBUG ESPECFICO CLEUZA */}\r\n      {showCleuezaDebug && (\r\n        <CleuezaDebugComponent />\r\n      )}\r\n\r\n      {/*  SOLUO IMEDIATA IMPLEMENTADA - SEO OCULTADA */}\r\n      {/* \r\n      <Card className=\"border-2 border-green-200 bg-green-50/30 mb-4\">\r\n        <CardContent className=\"p-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h3 className=\"font-semibold text-green-900\"> Soluo Imediata: Procedimentos Simplificados</h3>\r\n              <p className=\"text-sm text-green-700\">Sistema de carregamento direto da tabela procedure_records implementado</p>\r\n              <div className=\"flex gap-2 mt-2\">\r\n                <Badge variant=\"outline\" className=\"bg-green-100 text-green-800 border-green-300\">\r\n                   SimplifiedProcedureService ativo\r\n                </Badge>\r\n                <Badge variant=\"outline\" className=\"bg-blue-100 text-blue-800 border-blue-300\">\r\n                   Carregamento automtico\r\n                </Badge>\r\n                <Badge variant=\"outline\" className=\"bg-purple-100 text-purple-800 border-purple-300\">\r\n                   Modo debug disponvel\r\n                </Badge>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n      */}\r\n\r\n      {/*  PAINEL DE DIAGNSTICOS - SEO OCULTADA */}\r\n      {/* \r\n      <Card className=\"border-2 border-dashed border-blue-200 bg-blue-50/30\">\r\n        <CardContent className=\"p-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <h3 className=\"font-semibold text-blue-900\"> Ferramentas de Diagnstico</h3>\r\n              <p className=\"text-sm text-blue-700\">Identifique problemas na associao de dados</p>\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <Button\r\n                onClick={() => setShowDiagnostic(!showDiagnostic)}\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                className=\"bg-yellow-50 border-yellow-300 text-yellow-700 hover:bg-yellow-100\"\r\n              >\r\n                <Database className=\"h-4 w-4 mr-1\" />\r\n                {showDiagnostic ? 'Ocultar' : 'Diagnstico Estrutural'}\r\n              </Button>\r\n              <Button\r\n                onClick={() => setShowProcedureDiagnostic(!showProcedureDiagnostic)}\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                className=\"bg-blue-50 border-blue-300 text-blue-700 hover:bg-blue-100\"\r\n              >\r\n                <Activity className=\"h-4 w-4 mr-1\" />\r\n                {showProcedureDiagnostic ? 'Ocultar' : 'Diagnstico Procedimentos'}\r\n              </Button>\r\n              <Button\r\n                onClick={() => setShowCleuezaDebug(!showCleuezaDebug)}\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                className=\"bg-red-50 border-red-300 text-red-700 hover:bg-red-100\"\r\n              >\r\n                <Search className=\"h-4 w-4 mr-1\" />\r\n                {showCleuezaDebug ? 'Ocultar' : 'Debug Cleuza'}\r\n              </Button>\r\n              \r\n              <Button\r\n                onClick={async () => {\r\n                  console.log(' [MANUAL DEBUG] Recarregando procedimentos...');\r\n                  const currentDoctors = doctors;\r\n                  if (currentDoctors.length > 0) {\r\n                    await loadProceduresForPatients(currentDoctors);\r\n                  } else {\r\n                    console.log(' Nenhum mdico disponvel para debug');\r\n                  }\r\n                }}\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                className=\"bg-purple-50 border-purple-300 text-purple-700 hover:bg-purple-100\"\r\n              >\r\n                <RefreshCw className=\"h-4 w-4 mr-1\" />\r\n                Debug Procedimentos\r\n              </Button>\r\n              <Button\r\n                onClick={async () => {\r\n                  console.log(' TESTE MANUAL: Recarregando procedimentos...');\r\n                  await loadProceduresForPatients(doctors);\r\n                }}\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                className=\"bg-green-50 border-green-300 text-green-700 hover:bg-green-100\"\r\n              >\r\n                <RefreshCw className=\"h-4 w-4 mr-1\" />\r\n                 Teste Procedimentos\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n      */}\r\n\r\n      {/*  AVISO DE DADOS DE DEMONSTRAO */}\r\n      {globalStats.isDemoData && (\r\n        <div className=\"bg-gradient-to-r from-yellow-50 to-orange-50 border-l-4 border-l-yellow-400 p-4 rounded-lg\">\r\n          <div className=\"flex items-center gap-3\">\r\n            <div className=\"w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center\">\r\n              <AlertCircle className=\"h-5 w-5 text-yellow-600\" />\r\n            </div>\r\n            <div>\r\n              <div className=\"font-semibold text-yellow-800\">Dados de Demonstrao</div>\r\n              <div className=\"text-sm text-yellow-700\">\r\n                Os dados exibidos so fictcios para demonstrao. Para ver dados reais, processe algumas AIHs atravs do sistema de upload.\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      {/* Cabealho branco e preto */}\r\n      <Card className=\"shadow-sm border border-gray-200 bg-white\">\r\n        <CardHeader className=\"pb-4\">\r\n          <CardTitle>\r\n            {/* HEADER COM DESIGN MINIMALISTA */}\r\n            <div className=\"mb-4 pb-4 border-b border-gray-200\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <div className=\"flex items-center gap-3\">\r\n                  <div className=\"flex items-center justify-center w-12 h-12 bg-gray-100 rounded-xl\">\r\n                    <Stethoscope className=\"h-6 w-6 text-black\" />\r\n                  </div>\r\n                  <div>\r\n                    <div className=\"flex items-center gap-2 flex-wrap\">\r\n                      <h3 className=\"text-2xl font-bold text-black\">Produo Mdica - Pagamentos Mdicos</h3>\r\n                      <Badge\r\n                        variant=\"outline\"\r\n                        className=\"bg-white text-black border-gray-300 px-2.5 py-0.5 text-xs font-semibold\"\r\n                      >\r\n                        {selectedHospitalName}\r\n                      </Badge>\r\n                    </div>\r\n                    <p className=\"text-sm text-neutral-700 mt-1\">Visualizao hierrquica completa: Mdicos  Pacientes  Procedimentos</p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center gap-2\">\r\n                  {useSihSource && (\r\n                    remoteConfigured ? (\r\n                      <Badge\r\n                        variant=\"outline\"\r\n                        className=\"bg-white text-black border-gray-300 px-2.5 py-0.5 text-xs font-semibold\"\r\n                      >\r\n                        Fonte: SIH Remoto\r\n                      </Badge>\r\n                    ) : (\r\n                      <Badge\r\n                        variant=\"outline\"\r\n                        className=\"bg-white text-black border-gray-300 px-2.5 py-0.5 text-xs font-semibold\"\r\n                      >\r\n                         Fonte SIH remota desativada ou no configurada\r\n                      </Badge>\r\n                    )\r\n                  )}\r\n                  <div className=\"flex items-center gap-2 mr-2\">\r\n                    <span className=\"text-xs text-neutral-700\">Fonte SIH</span>\r\n                    <Switch checked={useSihSource} onCheckedChange={setUseSihSource} />\r\n                  </div>\r\n                  <Button\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    onClick={() => {\r\n                      try {\r\n                        const { invalidateOtoSaoJoseHonMap } = require('../config/doctorPaymentRules/importers/otoSaoJoseXlsx');\r\n                        if (invalidateOtoSaoJoseHonMap) invalidateOtoSaoJoseHonMap();\r\n                      } catch { }\r\n                      setRefreshTick(t => t + 1)\r\n                    }}\r\n                    className=\"h-9 px-3 border-black text-black hover:bg-neutral-100\"\r\n                  >\r\n                    <RefreshCw className=\"h-4 w-4 mr-2\" /> Atualizar\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Indicadores  branco/preto com contorno colorido */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-4 lg:grid-cols-6 gap-3 mb-4\">\r\n              {/* Valor Total (Remote/Local) */}\r\n              <div className=\"bg-white rounded-lg p-3 border-2 border-gray-300\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <div className=\"text-[11px] font-bold text-black uppercase tracking-wide mb-1\">\r\n                      {useSihSource && remoteConfigured ? 'Valor Total (Remoto)' : 'Valor Total SIGTAP'}\r\n                    </div>\r\n                    <div className=\"text-xl font-black text-black\">\r\n                      {formatCurrency(aggregatedOperaParanaTotals.totalBaseSigtap)}\r\n                    </div>\r\n                    {useSihSource && remoteConfigured && sihRemoteTotals && (\r\n                      <div className=\"text-[11px] text-black mt-1 flex items-center gap-1\">\r\n                        <span className=\"inline-block w-2 h-2 bg-black rounded-full\"></span>\r\n                        Fonte: SIH Remoto\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n\r\n              {/* Total AIHs (SIH Remoto quando disponvel) */}\r\n              {useSihSource && remoteConfigured && sihRemoteTotals && (\r\n                <div className=\"bg-white rounded-lg p-3 border-2 border-blue-400\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <div>\r\n                      <div className=\"text-[11px] font-bold text-black uppercase tracking-wide mb-1\">\r\n                        Total AIHs (SIH Remoto)\r\n                      </div>\r\n                      <div className=\"text-xl font-black text-black\">\r\n                        {formatNumber(sihRemoteTotals.totalAIHs)}\r\n                      </div>\r\n                      <div className=\"text-[11px] text-black mt-1 flex items-center gap-1\">\r\n                        <span className=\"inline-block w-2 h-2 bg-black rounded-full\"></span>\r\n                        Fonte: Banco SIH\r\n                      </div>\r\n                    </div>\r\n\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              {/* Valor Total Incrementos */}\r\n              <div className=\"bg-white rounded-lg p-3 border-2 border-emerald-400\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <div className=\"text-[11px] font-bold text-black uppercase tracking-wide mb-1\">\r\n                      Incrementos\r\n                    </div>\r\n                    <div className=\"text-xl font-black text-black\">\r\n                      {formatCurrency(aggregatedOperaParanaTotals.totalIncrement)}\r\n                    </div>\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n\r\n              {/* Incremento Eletivo */}\r\n              <div className=\"bg-white rounded-lg p-3 border-2 border-teal-400\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <div className=\"text-[11px] font-bold text-black uppercase tracking-wide mb-1\">\r\n                      Incremento Eletivo\r\n                    </div>\r\n                    <div className=\"text-xl font-black text-black\">\r\n                      {formatCurrency(aggregatedIncrementBreakdown.elective)}\r\n                    </div>\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n\r\n              {/* Incremento Urgncia */}\r\n              <div className=\"bg-white rounded-lg p-3 border-2 border-amber-400\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <div className=\"text-[11px] font-bold text-black uppercase tracking-wide mb-1\">\r\n                      Incremento Urgncia\r\n                    </div>\r\n                    <div className=\"text-xl font-black text-black\">\r\n                      {formatCurrency(aggregatedIncrementBreakdown.urgency)}\r\n                    </div>\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n\r\n              {/* Valor Total (com Opera Paran) */}\r\n              <div className=\"bg-white rounded-lg p-3 border-2 border-blue-400\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <div className=\"text-[11px] font-bold text-black uppercase tracking-wide mb-1\">\r\n                      Valor Total\r\n                    </div>\r\n                    <div className=\"text-xl font-black text-black\">\r\n                      {formatCurrency(aggregatedOperaParanaTotals.totalWithIncrement)}\r\n                    </div>\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n\r\n              {/* Pagamento Mdico Total - DESTAQUE */}\r\n              <div className=\"bg-white rounded-lg p-3 border-2 border-green-500 shadow-sm\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <div>\r\n                    <div className=\"text-[11px] font-bold text-black uppercase tracking-wide mb-1\">\r\n                      Pagamento Mdico Total\r\n                    </div>\r\n                    <div className=\"text-xl font-black text-black\">\r\n                      {formatCurrency(aggregatedMedicalPayments)}\r\n                    </div>\r\n                  </div>\r\n\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n\r\n\r\n            {/* BOTES DE RELATRIO - LINHA COMPACTA  ESQUERDA */}\r\n            <div className=\"mb-4 hidden\">\r\n              <div className=\"flex flex-wrap gap-2 justify-start items-center\">\r\n                <Button\r\n                  variant=\"default\"\r\n                  size=\"sm\"\r\n                  onClick={async () => {\r\n                    try {\r\n                      const rows: Array<Array<string | number>> = [];\r\n                      const header = [\r\n                        '#',\r\n                        'Pronturio',\r\n                        'Nome do Paciente',\r\n                        'N AIH',\r\n                        'Cdigo Procedimento',\r\n                        'Descrio Procedimento',\r\n                        'Data Procedimento',\r\n                        'Data Alta (SUS)',\r\n                        'Especialidade de Atendimento',\r\n                        'Carter de Atendimento',\r\n                        'Mdico',\r\n                        'Hospital',\r\n                        'Pgt. Administrativo',\r\n                        'Valor Procedimento',\r\n                        'AIH Seca',\r\n                        'Incremento',\r\n                        'AIH c/ Incremento'\r\n                      ];\r\n                      let idx = 1;\r\n                      let totalAIHsFound = 0;\r\n                      let excludedByDateFilter = 0;\r\n                      let aihsWithoutNumber = 0;\r\n\r\n                      //  CORREO: NO deduplicate por paciente - cada AIH  um registro nico\r\n                      // Um paciente com mltiplas AIHs deve gerar mltiplas linhas no relatrio\r\n\r\n                      console.log(' [RELATRIO GERAL] Iniciando coleta de dados...');\r\n                      console.log(' [RELATRIO GERAL] Mdicos filtrados:', filteredDoctors.length);\r\n                      console.log(' [RELATRIO GERAL] Sem filtro de data');\r\n\r\n                      filteredDoctors.forEach((card: any) => {\r\n                        const doctorName = card.doctor_info?.name || '';\r\n                        const hospitalName = card.hospitals?.[0]?.hospital_name || '';\r\n                        console.log(` [RELATRIO GERAL] Mdico: ${doctorName} - Pacientes: ${(card.patients || []).length}`);\r\n\r\n                        (card.patients || []).forEach((p: any) => {\r\n                          totalAIHsFound++; //  Contar AIHs, no pacientes nicos\r\n\r\n                          //  FILTRO UNIFICADO: Intervalo de datas (mesmo filtro do relatrio simplificado)\r\n                          if (false) {\r\n                            const discharge = p?.aih_info?.discharge_date ? new Date(p.aih_info.discharge_date) : undefined;\r\n\r\n                            if (!discharge) {\r\n                              excludedByDateFilter++;\r\n                              return;\r\n                            }\r\n\r\n                            // Normalizar datas para comparao (incio do dia para startDate, fim do dia para endDate)\r\n                            const startOfPeriod = new Date();\r\n                            const endOfPeriod = new Date();\r\n                            endOfPeriod.setHours(23, 59, 59, 999);\r\n\r\n                            const dischargeDate = new Date(discharge);\r\n\r\n                            if (dischargeDate < startOfPeriod || dischargeDate > endOfPeriod) {\r\n                              excludedByDateFilter++;\r\n                              return;\r\n                            }\r\n                          }\r\n\r\n                          const patientId = p.patient_id;\r\n                          const name = p.patient_info?.name || 'Paciente';\r\n                          const medicalRecord = p.patient_info?.medical_record || '-';\r\n                          //  CORREO: Incluir AIHs sem nmero com aviso\r\n                          const aihRaw = (p?.aih_info?.aih_number || '').toString().replace(/\\D/g, '');\r\n                          const aih = aihRaw || 'Aguardando gerao';\r\n\r\n                          //  CORREO: NO pular duplicatas de paciente - cada AIH  nica\r\n                          // Mesmo paciente com mltiplas AIHs deve gerar mltiplas linhas\r\n\r\n                          if (!aihRaw) {\r\n                            aihsWithoutNumber++;\r\n                            console.log(` [RELATRIO GERAL] AIH sem nmero includa: ${name}`);\r\n                          }\r\n\r\n                          const careSpec = (p?.aih_info?.specialty || '').toString();\r\n                          const careCharacter = (() => {\r\n                            const raw = (p?.aih_info?.care_character ?? '').toString();\r\n                            try {\r\n                              return CareCharacterUtils.formatForDisplay(raw, false);\r\n                            } catch {\r\n                              return raw;\r\n                            }\r\n                          })();\r\n                          const disISO = p?.aih_info?.discharge_date || '';\r\n                          const disLabel = parseISODateToLocal(disISO);\r\n\r\n                          // Calcular valor da AIH com incrementos Opera Paran\r\n                          const baseAih = Number(p.total_value_reais || 0);\r\n                          const doctorCovered = isDoctorCoveredForOperaParana(doctorName, card.hospitals?.[0]?.hospital_id);\r\n                          const increment = doctorCovered ? computeIncrementForProcedures(p.procedures as any, p?.aih_info?.care_character, doctorName, card.hospitals?.[0]?.hospital_id) : 0;\r\n                          const aihWithIncrements = baseAih + increment;\r\n\r\n                          //  FIX: Mostrar todos os procedimentos, mas garantir que a AIH pertence  competncia correta\r\n                          // A competncia j foi filtrada no backend, ento esta AIH pertence  competncia selecionada\r\n                          const procedures = p.procedures || [];\r\n                          if (procedures.length > 0) {\r\n                            procedures.forEach((proc: any) => {\r\n                              //  PADRONIZAO: Remover \".\" e \"-\" do cdigo de procedimento\r\n                              const procCodeRaw = proc.procedure_code || '';\r\n                              const procCode = procCodeRaw.replace(/[.\\-]/g, '');\r\n\r\n                              const procDesc = proc.procedure_description || proc.sigtap_description || '';\r\n                              const procDate = proc.procedure_date || '';\r\n                              const procDateLabel = parseISODateToLocal(procDate);\r\n                              const procValue = Number(proc.value_reais || 0);\r\n\r\n                              const pgtAdm = p?.aih_info?.pgt_adm || 'no';\r\n\r\n                              rows.push([\r\n                                idx++,\r\n                                medicalRecord,\r\n                                name,\r\n                                aih, // Usar aih que pode ser \"Aguardando gerao\"\r\n                                procCode, //  Cdigo padronizado sem \".\" e \"-\"\r\n                                procDesc,\r\n                                procDateLabel,\r\n                                disLabel,\r\n                                careSpec,\r\n                                careCharacter,\r\n                                doctorName,\r\n                                hospitalName,\r\n                                pgtAdm,\r\n                                procValue,\r\n                                baseAih,\r\n                                increment,\r\n                                aihWithIncrements\r\n                              ]);\r\n                            });\r\n                          } else {\r\n                            // Se no tem procedimentos, criar uma linha sem dados de procedimento\r\n                            const pgtAdm = p?.aih_info?.pgt_adm || 'no';\r\n\r\n                            rows.push([\r\n                              idx++,\r\n                              medicalRecord,\r\n                              name,\r\n                              aih, // Usar aih que pode ser \"Aguardando gerao\"\r\n                              '',\r\n                              'Nenhum procedimento encontrado',\r\n                              '',\r\n                              disLabel,\r\n                              careSpec,\r\n                              careCharacter,\r\n                              doctorName,\r\n                              hospitalName,\r\n                              pgtAdm,\r\n                              0,\r\n                              baseAih,\r\n                              increment,\r\n                              aihWithIncrements\r\n                            ]);\r\n                          }\r\n                        });\r\n                      });\r\n\r\n                      // Ordenar por Data Alta (SUS) - mais recente primeiro\r\n                      rows.sort((a, b) => {\r\n                        const dateA = a[7] as string; // Data Alta (SUS) est na posio 7 (0-indexed)\r\n                        const dateB = b[7] as string;\r\n\r\n                        // Se no h data, colocar no final\r\n                        if (!dateA && !dateB) return 0;\r\n                        if (!dateA) return 1;\r\n                        if (!dateB) return -1;\r\n\r\n                        // Converter DD/MM/YYYY para Date para comparao\r\n                        const parseDate = (dateStr: string) => {\r\n                          const parts = dateStr.split('/');\r\n                          if (parts.length === 3) {\r\n                            return new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));\r\n                          }\r\n                          return new Date(0);\r\n                        };\r\n\r\n                        const parsedDateA = parseDate(dateA);\r\n                        const parsedDateB = parseDate(dateB);\r\n\r\n                        // Ordenar do mais recente para o mais antigo\r\n                        return parsedDateB.getTime() - parsedDateA.getTime();\r\n                      });\r\n\r\n                      //  Estatsticas finais do relatrio\r\n                      console.log(' [RELATRIO GERAL] Estatsticas finais:');\r\n                      console.log(` [RELATRIO GERAL] Total de AIHs encontradas: ${totalAIHsFound}`);\r\n                      console.log(` [RELATRIO GERAL] Excludas por filtro de data: ${excludedByDateFilter}`);\r\n                      console.log(` [RELATRIO GERAL] AIHs sem nmero includas: ${aihsWithoutNumber}`);\r\n                      console.log(` [RELATRIO GERAL] Total de linhas no relatrio: ${rows.length}`);\r\n\r\n                      // Renumerar aps ordenao\r\n                      rows.forEach((row, index) => {\r\n                        row[0] = index + 1; // Atualizar numerao sequencial\r\n                      });\r\n\r\n                      const wb = XLSX.utils.book_new();\r\n                      const ws = XLSX.utils.aoa_to_sheet([header, ...rows]);\r\n                      (ws as any)['!cols'] = [\r\n                        { wch: 5 },   // #\r\n                        { wch: 15 },  // Pronturio\r\n                        { wch: 35 },  // Nome do Paciente\r\n                        { wch: 18 },  // N AIH\r\n                        { wch: 20 },  // Cdigo Procedimento\r\n                        { wch: 45 },  // Descrio Procedimento\r\n                        { wch: 16 },  // Data Procedimento\r\n                        { wch: 16 },  // Data Alta (SUS)\r\n                        { wch: 25 },  // Especialidade de Atendimento\r\n                        { wch: 22 },  // Carter de Atendimento\r\n                        { wch: 30 },  // Mdico\r\n                        { wch: 35 },  // Hospital\r\n                        { wch: 20 },  // Pgt. Administrativo\r\n                        { wch: 18 },  // Valor Procedimento\r\n                        { wch: 18 },  // AIH Seca\r\n                        { wch: 18 },  // Incremento\r\n                        { wch: 20 },  // AIH c/ Incremento\r\n                      ];\r\n                      XLSX.utils.book_append_sheet(wb, ws, 'Pacientes');\r\n                      const fileName = `Relatorio_Pacientes_Procedimentos_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.xlsx`;\r\n                      XLSX.writeFile(wb, fileName);\r\n\r\n                      //  Notificao nica e clara\r\n                      if (aihsWithoutNumber > 0) {\r\n                        toast.success(`Relatrio geral gerado! ${aihsWithoutNumber} registro(s) sem AIH includo(s).`);\r\n                      } else {\r\n                        toast.success('Relatrio geral gerado com sucesso!');\r\n                      }\r\n                    } catch (e) {\r\n                      console.error('Erro ao exportar Relatrio Pacientes:', e);\r\n                      toast.error('Erro ao gerar relatrio geral');\r\n                    }\r\n                  }}\r\n                  className=\"inline-flex items-center gap-2 bg-black hover:bg-neutral-800 text-white justify-self-start w-auto min-w-[220px]\"\r\n                  title=\"Gerar relatrio geral de pacientes\"\r\n                >\r\n                  <FileSpreadsheet className=\"h-4 w-4\" />\r\n                  Relatrio Pacientes Geral\r\n                </Button>\r\n\r\n                {/*  NOVO: Relatrio Pacientes Conferncia */}\r\n                <Button\r\n                  variant=\"default\"\r\n                  size=\"sm\"\r\n                  onClick={async () => {\r\n                    try {\r\n                      const rows: Array<Array<string | number>> = [];\r\n                      const header = [\r\n                        '#',\r\n                        'Pronturio',\r\n                        'Nome do Paciente',\r\n                        'N AIH',\r\n                        'Data Alta (SUS)',\r\n                        'Mdico',\r\n                        'Hospital',\r\n                        'Pgt. Administrativo',\r\n                        'AIH Seca',\r\n                        'Incremento',\r\n                        'AIH c/ Incremento'\r\n                      ];\r\n                      let idx = 1;\r\n                      let totalAIHsFound = 0;\r\n                      let excludedByDateFilter = 0;\r\n                      let aihsWithoutNumber = 0;\r\n\r\n                      //  CORREO: NO deduplicate por paciente - cada AIH  um registro nico\r\n                      // Um paciente com mltiplas AIHs deve gerar mltiplas linhas no relatrio\r\n\r\n                      console.log(' [RELATRIO CONFERNCIA] Iniciando coleta de dados...');\r\n                      console.log(' [RELATRIO CONFERNCIA] Mdicos filtrados:', filteredDoctors.length);\r\n                      console.log(' [RELATRIO CONFERNCIA] Uma linha por AIH (internao)');\r\n\r\n                      filteredDoctors.forEach((card: any) => {\r\n                        const doctorName = card.doctor_info?.name || '';\r\n                        const hospitalName = card.hospitals?.[0]?.hospital_name || '';\r\n                        console.log(` [RELATRIO CONFERNCIA] Mdico: ${doctorName} - Pacientes: ${(card.patients || []).length}`);\r\n\r\n                        (card.patients || []).forEach((p: any) => {\r\n                          totalAIHsFound++; //  Contar AIHs, no pacientes nicos\r\n\r\n                          const patientId = p.patient_id;\r\n                          const name = p.patient_info?.name || 'Paciente';\r\n                          const medicalRecord = p.patient_info?.medical_record || '-';\r\n                          //  CORREO: Incluir AIHs sem nmero com aviso\r\n                          const aihRaw = (p?.aih_info?.aih_number || '').toString().replace(/\\D/g, '');\r\n                          const aih = aihRaw || 'Aguardando gerao';\r\n\r\n                          //  CORREO: NO pular duplicatas de paciente - cada AIH  nica\r\n                          // Mesmo paciente com mltiplas AIHs deve gerar mltiplas linhas\r\n\r\n                          if (!aihRaw) {\r\n                            aihsWithoutNumber++;\r\n                            console.log(` [RELATRIO CONFERNCIA] AIH sem nmero includa: ${name}`);\r\n                          }\r\n\r\n                          const disISO = p?.aih_info?.discharge_date || '';\r\n                          const disLabel = parseISODateToLocal(disISO);\r\n\r\n                          // Calcular valor da AIH com incrementos Opera Paran\r\n                          const baseAih = Number(p.total_value_reais || 0);\r\n                          const doctorCovered = isDoctorCoveredForOperaParana(doctorName, card.hospitals?.[0]?.hospital_id);\r\n                          const increment = doctorCovered ? computeIncrementForProcedures(p.procedures as any, p?.aih_info?.care_character, doctorName, card.hospitals?.[0]?.hospital_id) : 0;\r\n                          const aihWithIncrements = baseAih + increment;\r\n\r\n                          const pgtAdm = p?.aih_info?.pgt_adm || 'no';\r\n\r\n                          //  UMA LINHA POR AIH: Cada internao/atendimento  uma linha\r\n                          rows.push([\r\n                            idx++,\r\n                            medicalRecord,\r\n                            name,\r\n                            aih, // Usar aih que pode ser \"Aguardando gerao\"\r\n                            disLabel,\r\n                            doctorName,\r\n                            hospitalName,\r\n                            pgtAdm,\r\n                            formatCurrency(baseAih),\r\n                            formatCurrency(increment),\r\n                            formatCurrency(aihWithIncrements)\r\n                          ]);\r\n                        });\r\n                      });\r\n\r\n                      // Ordenar por Data Alta (SUS) - mais recente primeiro\r\n                      rows.sort((a, b) => {\r\n                        const dateA = a[4] as string; // Data Alta (SUS) est na posio 4 (0-indexed)\r\n                        const dateB = b[4] as string;\r\n\r\n                        // Se no h data, colocar no final\r\n                        if (!dateA && !dateB) return 0;\r\n                        if (!dateA) return 1;\r\n                        if (!dateB) return -1;\r\n\r\n                        // Converter DD/MM/YYYY para Date para comparao\r\n                        const parseDate = (dateStr: string) => {\r\n                          const parts = dateStr.split('/');\r\n                          if (parts.length === 3) {\r\n                            return new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));\r\n                          }\r\n                          return new Date(0);\r\n                        };\r\n\r\n                        const parsedDateA = parseDate(dateA);\r\n                        const parsedDateB = parseDate(dateB);\r\n\r\n                        // Ordenar do mais recente para o mais antigo\r\n                        return parsedDateB.getTime() - parsedDateA.getTime();\r\n                      });\r\n\r\n                      //  Estatsticas finais do relatrio\r\n                      console.log(' [RELATRIO CONFERNCIA] Estatsticas finais:');\r\n                      console.log(` [RELATRIO CONFERNCIA] Total de AIHs encontradas: ${totalAIHsFound}`);\r\n                      console.log(` [RELATRIO CONFERNCIA] Excludas por filtro de data: ${excludedByDateFilter}`);\r\n                      console.log(` [RELATRIO CONFERNCIA] AIHs sem nmero includas: ${aihsWithoutNumber}`);\r\n                      console.log(` [RELATRIO CONFERNCIA] Total de linhas no relatrio: ${rows.length}`);\r\n\r\n                      // Renumerar aps ordenao\r\n                      rows.forEach((row, index) => {\r\n                        row[0] = index + 1; // Atualizar numerao sequencial\r\n                      });\r\n\r\n                      const wb = XLSX.utils.book_new();\r\n                      const ws = XLSX.utils.aoa_to_sheet([header, ...rows]);\r\n                      (ws as any)['!cols'] = [\r\n                        { wch: 5 },   // #\r\n                        { wch: 15 },  // Pronturio\r\n                        { wch: 35 },  // Nome do Paciente\r\n                        { wch: 18 },  // N AIH\r\n                        { wch: 16 },  // Data Alta (SUS)\r\n                        { wch: 30 },  // Mdico\r\n                        { wch: 35 },  // Hospital\r\n                        { wch: 20 },  // Pgt. Administrativo\r\n                        { wch: 18 },  // AIH Seca\r\n                        { wch: 18 },  // Incremento\r\n                        { wch: 20 },  // AIH c/ Incremento\r\n                      ];\r\n                      XLSX.utils.book_append_sheet(wb, ws, 'AIHs');\r\n                      const fileName = `Relatorio_AIHs_Conferencia_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.xlsx`;\r\n                      XLSX.writeFile(wb, fileName);\r\n\r\n                      //  Notificao nica e clara\r\n                      if (aihsWithoutNumber > 0) {\r\n                        toast.success(`Relatrio de conferncia gerado! ${aihsWithoutNumber} AIH(s) sem nmero includa(s).`);\r\n                      } else {\r\n                        toast.success('Relatrio de conferncia gerado com sucesso!');\r\n                      }\r\n                    } catch (e) {\r\n                      console.error('Erro ao exportar Relatrio Conferncia:', e);\r\n                      toast.error('Erro ao gerar relatrio de conferncia');\r\n                    }\r\n                  }}\r\n                  className=\"inline-flex items-center gap-2 bg-black hover:bg-neutral-800 text-white justify-self-start w-auto min-w-[220px]\"\r\n                  title=\"Gerar relatrio de conferncia de pacientes (uma linha por paciente com valores consolidados)\"\r\n                >\r\n                  <FileSpreadsheet className=\"h-4 w-4\" />\r\n                  Relatrio Pacientes Conferncia\r\n                </Button>\r\n\r\n                {/*  NOVO: Relatrio Pacientes Geral Simplificado */}\r\n                <Button\r\n                  variant=\"default\"\r\n                  size=\"sm\"\r\n                  onClick={async () => {\r\n                    try {\r\n                      //  SIMPLIFICADO: Sem filtros de data (apenas competncia)\r\n                      const rows: Array<Array<string | number>> = [];\r\n                      const header = [\r\n                        '#',\r\n                        'Nome do Paciente',\r\n                        'Pronturio',\r\n                        'N AIH',\r\n                        'Data de Admisso',\r\n                        'Data de Alta',\r\n                        'Mdico',\r\n                        'Pgt. Administrativo',\r\n                        'AIH Seca',\r\n                        'Incremento',\r\n                        'AIH c/ Incremento'\r\n                      ];\r\n                      let idx = 1;\r\n\r\n                      //  CORREO: Coletar TODAS as AIHs (sem eliminar duplicatas)\r\n                      // Cada AIH  nica, mesmo paciente pode ter mltiplas AIHs (reabordagem, retorno)\r\n                      const allPatients: any[] = [];\r\n                      let totalPatientsFound = 0;\r\n                      let excludedByDateFilter = 0;\r\n                      let excludedByEmptyAIH = 0;\r\n\r\n                      console.log(' [RELATRIO SIMPLIFICADO] Iniciando coleta de dados...');\r\n                      console.log(' [RELATRIO SIMPLIFICADO] Mdicos filtrados:', filteredDoctors.length);\r\n                      console.log(' [RELATRIO SIMPLIFICADO] Sem filtro de data');\r\n\r\n                      //  CORREO: NO deduplicate por paciente - cada AIH  um registro nico\r\n                      // Um paciente com mltiplas AIHs deve gerar mltiplas linhas no relatrio\r\n\r\n                      filteredDoctors.forEach((card: any) => {\r\n                        const doctorName = card.doctor_info?.name || 'Mdico no identificado';\r\n                        const hospitalName = card.hospitals?.[0]?.hospital_name || 'Hospital no identificado';\r\n                        const doctorPatients = card.patients || [];\r\n                        console.log(` [RELATRIO SIMPLIFICADO] Mdico: ${doctorName} - Pacientes: ${doctorPatients.length}`);\r\n\r\n                        doctorPatients.forEach((p: any) => {\r\n                          totalPatientsFound++;\r\n\r\n                          //  FILTRO UNIFICADO: Intervalo de datas (mesmo do relatrio geral)\r\n                          if (false) {\r\n                            const discharge = p?.aih_info?.discharge_date ? new Date(p.aih_info.discharge_date) : undefined;\r\n\r\n                            if (!discharge) {\r\n                              excludedByDateFilter++;\r\n                              return;\r\n                            }\r\n\r\n                            // Normalizar datas para comparao (incio do dia para startDate, fim do dia para endDate)\r\n                            const startOfPeriod = new Date();\r\n                            const endOfPeriod = new Date();\r\n                            endOfPeriod.setHours(23, 59, 59, 999);\r\n\r\n                            const dischargeDate = new Date(discharge);\r\n\r\n                            if (dischargeDate < startOfPeriod || dischargeDate > endOfPeriod) {\r\n                              excludedByDateFilter++;\r\n                              return;\r\n                            }\r\n                          }\r\n\r\n                          const patientId = p.patient_id;\r\n\r\n                          //  CORREO: NO pular duplicatas de paciente - cada AIH  nica\r\n                          // Mesmo paciente com mltiplas AIHs deve gerar mltiplas linhas\r\n\r\n                          //  CORREO: AIHs podem no ter nmero gerado ainda - INCLUIR TODAS\r\n                          const aih = (p?.aih_info?.aih_number || '').toString().replace(/\\D/g, '');\r\n                          const aihDisplay = aih || 'Aguardando gerao';\r\n\r\n                          //  LOG ESPECFICO PARA PARTOS CESAREANOS\r\n                          const procedures = p.procedures || [];\r\n                          const hasCesarean = procedures.some((proc: any) => {\r\n                            const code = proc.procedure_code || '';\r\n                            return code === '04.11.01.003-4' || code === '04.11.01.004-2';\r\n                          });\r\n\r\n                          if (hasCesarean) {\r\n                            console.log(` [RELATRIO SIMPLIFICADO] PARTO CESARIANO INCLUDO: ${p.patient_info?.name || 'Sem nome'} - AIH: ${aihDisplay} - Mdico: ${doctorName}`);\r\n                          }\r\n\r\n                          if (!aih) {\r\n                            console.log(` [RELATRIO SIMPLIFICADO] AIH sem nmero includa: ${p.patient_info?.name || 'Sem nome'}`);\r\n                          }\r\n\r\n                          const name = p.patient_info?.name || 'Paciente';\r\n                          const medicalRecord = p.patient_info?.medical_record || '-';\r\n                          const admissionISO = p?.aih_info?.admission_date || '';\r\n                          const admissionLabel = parseISODateToLocal(admissionISO);\r\n                          const dischargeISO = p?.aih_info?.discharge_date || '';\r\n                          const dischargeLabel = parseISODateToLocal(dischargeISO);\r\n\r\n                          // Calcular valores da AIH com incrementos Opera Paran\r\n                          const baseAih = Math.round((Number(p.total_value_reais || 0)) * 100) / 100;\r\n                          const doctorCovered = isDoctorCoveredForOperaParana(doctorName, card.hospitals?.[0]?.hospital_id);\r\n                          const incrementRaw = doctorCovered ? computeIncrementForProcedures(p.procedures as any, p?.aih_info?.care_character, doctorName, card.hospitals?.[0]?.hospital_id) : 0;\r\n                          const increment = Math.round(incrementRaw * 100) / 100;\r\n                          const aihWithIncrements = Math.round((baseAih + increment) * 100) / 100;\r\n\r\n                          const pgtAdm = p?.aih_info?.pgt_adm || 'no';\r\n\r\n                          allPatients.push({\r\n                            name,\r\n                            medicalRecord,\r\n                            aih: aihDisplay, // Usar aihDisplay que inclui \"Aguardando gerao\" se vazio\r\n                            admissionLabel,\r\n                            dischargeLabel,\r\n                            doctorName,\r\n                            pgtAdm,\r\n                            baseAih,\r\n                            increment,\r\n                            aihWithIncrements\r\n                          });\r\n                        });\r\n                      });\r\n\r\n                      //  CONTAGEM DE PARTOS CESAREANOS\r\n                      let cesareanCount = 0;\r\n                      filteredDoctors.forEach((card: any) => {\r\n                        (card.patients || []).forEach((p: any) => {\r\n                          const procedures = p.procedures || [];\r\n                          const hasCesarean = procedures.some((proc: any) => {\r\n                            const code = proc.procedure_code || '';\r\n                            return code === '04.11.01.003-4' || code === '04.11.01.004-2';\r\n                          });\r\n                          if (hasCesarean) cesareanCount++;\r\n                        });\r\n                      });\r\n\r\n                      console.log(' [RELATRIO SIMPLIFICADO] ESTATSTICAS:');\r\n                      console.log(` [RELATRIO SIMPLIFICADO] Total de AIHs encontradas: ${totalPatientsFound}`);\r\n                      console.log(` [RELATRIO SIMPLIFICADO] Excludas por data: ${excludedByDateFilter}`);\r\n                      console.log(` [RELATRIO SIMPLIFICADO] AIHs sem nmero includas: ${allPatients.filter(p => p.aih === 'Aguardando gerao').length}`);\r\n                      console.log(` [RELATRIO SIMPLIFICADO] Partos cesareanos identificados: ${cesareanCount}`);\r\n                      console.log(` [RELATRIO SIMPLIFICADO] Includas no relatrio: ${allPatients.length}`);\r\n\r\n                      //  CORREO: Ordenar por data de alta (do mais antigo para o mais recente)\r\n                      const patientsArray = allPatients;\r\n                      patientsArray.sort((a, b) => {\r\n                        // Converter datas de DD/MM/YYYY para Date para comparao\r\n                        const parseDate = (dateStr: string): Date | null => {\r\n                          if (!dateStr || dateStr === '') return null;\r\n                          const parts = dateStr.split('/');\r\n                          if (parts.length === 3) {\r\n                            // DD/MM/YYYY -> YYYY-MM-DD\r\n                            return new Date(`${parts[2]}-${parts[1]}-${parts[0]}`);\r\n                          }\r\n                          return null;\r\n                        };\r\n\r\n                        const dateA = parseDate(a.dischargeLabel);\r\n                        const dateB = parseDate(b.dischargeLabel);\r\n\r\n                        // Se uma das datas no existe, colocar no final\r\n                        if (!dateA && !dateB) return 0;\r\n                        if (!dateA) return 1;\r\n                        if (!dateB) return -1;\r\n\r\n                        // Ordenar do mais antigo para o mais recente\r\n                        const dateCompare = dateA.getTime() - dateB.getTime();\r\n                        if (dateCompare !== 0) return dateCompare;\r\n\r\n                        // Se datas iguais, ordenar por nome do paciente\r\n                        return a.name.toLowerCase().localeCompare(b.name.toLowerCase());\r\n                      });\r\n\r\n                      // Criar linhas do Excel\r\n                      patientsArray.forEach((patient) => {\r\n                        rows.push([\r\n                          idx++,\r\n                          patient.name,\r\n                          patient.medicalRecord,\r\n                          patient.aih,\r\n                          patient.admissionLabel,\r\n                          patient.dischargeLabel,\r\n                          patient.doctorName,\r\n                          patient.pgtAdm,\r\n                          formatCurrency(patient.baseAih),\r\n                          formatCurrency(patient.increment),\r\n                          formatCurrency(patient.aihWithIncrements)\r\n                        ]);\r\n                      });\r\n\r\n                      const wb = XLSX.utils.book_new();\r\n                      const ws = XLSX.utils.aoa_to_sheet([header, ...rows]);\r\n                      (ws as any)['!cols'] = [\r\n                        { wch: 5 },   // #\r\n                        { wch: 40 },  // Nome do Paciente\r\n                        { wch: 16 },  // Pronturio\r\n                        { wch: 18 },  // N AIH\r\n                        { wch: 18 },  // Data de Admisso\r\n                        { wch: 18 },  // Data de Alta\r\n                        { wch: 30 },  // Mdico\r\n                        { wch: 20 },  // Pgt. Administrativo\r\n                        { wch: 18 },  // AIH Seca\r\n                        { wch: 18 },  // Incremento\r\n                        { wch: 20 },  // AIH c/ Incremento\r\n                      ];\r\n                      XLSX.utils.book_append_sheet(wb, ws, 'Pacientes Simplificado');\r\n                      const fileName = `Relatorio_Pacientes_Simplificado_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.xlsx`;\r\n                      XLSX.writeFile(wb, fileName);\r\n                      toast.success('Relatrio simplificado gerado com sucesso!');\r\n                    } catch (e) {\r\n                      console.error('Erro ao exportar Relatrio Simplificado:', e);\r\n                      toast.error('Erro ao gerar relatrio simplificado');\r\n                    }\r\n                  }}\r\n                  className=\"inline-flex items-center gap-2 bg-black hover:bg-neutral-800 text-white justify-self-start w-auto min-w-[220px]\"\r\n                  title=\"Gerar relatrio simplificado de pacientes\"\r\n                >\r\n                  <FileSpreadsheet className=\"h-4 w-4\" />\r\n                  Relatrio Pacientes Geral Simplificado\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-6\">\r\n\r\n          {/*  COMPETNCIA  CONTROLADA PELO EXECUTIVEDASHBOARD (filtro global) */}\r\n          {selectedCompetencia !== 'all' && (\r\n            <div className=\"bg-gradient-to-br from-indigo-50 to-blue-50/30 p-3 rounded-xl border border-indigo-200\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <Calendar className=\"w-4 h-4 text-indigo-600\" />\r\n                <span className=\"text-sm font-medium text-indigo-700\">\r\n                  Filtro ativo: Competncia {formatCompetencia(selectedCompetencia)}\r\n                </span>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/*  LISTA DE MDICOS COM PAGINAO */}\r\n          <div className=\"space-y-4\">\r\n            {filteredDoctors.length === 0 ? (\r\n              <div className=\"text-center py-12\">\r\n                <Users className=\"h-12 w-12 mx-auto text-gray-300 mb-4\" />\r\n                <div className=\"text-lg font-medium text-gray-600\">\r\n                  {(() => {\r\n                    const needsHospital = useSihSource && (\r\n                      !selectedHospitals || selectedHospitals.length === 0 || selectedHospitals.includes('all')\r\n                    );\r\n                    if (needsHospital) return 'Selecione o hospital para comear';\r\n                    const compSelected = selectedCompetencia && selectedCompetencia !== 'all' && selectedCompetencia.trim() !== '';\r\n                    if (useSihSource && compSelected && availableCompetencias?.length && !availableCompetencias.includes(selectedCompetencia)) {\r\n                      return 'Competncia sem dados para o hospital selecionado';\r\n                    }\r\n                    return searchTerm ? 'Nenhum mdico responsvel encontrado' : 'Nenhum mdico responsvel cadastrado';\r\n                  })()}\r\n                </div>\r\n                <div className=\"text-sm text-gray-500\">\r\n                  {(() => {\r\n                    const needsHospital = useSihSource && (\r\n                      !selectedHospitals || selectedHospitals.length === 0 || selectedHospitals.includes('all')\r\n                    );\r\n                    if (needsHospital) return 'Selecione o hospital e depois a competncia para visualizar os dados';\r\n                    const compSelected = selectedCompetencia && selectedCompetencia !== 'all' && selectedCompetencia.trim() !== '';\r\n                    if (useSihSource && compSelected && availableCompetencias?.length && !availableCompetencias.includes(selectedCompetencia)) {\r\n                      const list = availableCompetencias.map(c => {\r\n                        const m = c.match(/^(\\d{4})(\\d{2})$/);\r\n                        return m ? `${m[2]}/${m[1]}` : c;\r\n                      }).join(', ');\r\n                      return `Competncias disponveis: ${list}`;\r\n                    }\r\n                    return searchTerm ? 'Tente alterar os filtros de busca' : 'Processe algumas AIHs com mdicos responsveis para ver os dados';\r\n                  })()}\r\n                </div>\r\n              </div>\r\n            ) : (\r\n              (() => {\r\n                // Preparar dados dos mdicos ordenados\r\n                const sortedDoctors = filteredDoctors\r\n                  .map((doctor) => {\r\n                    //  PERFORMANCE: Usar cache de stats (evita reclculo)\r\n                    const key = getDoctorCardKey(doctor);\r\n                    const stats = doctorStatsCache.get(key);\r\n                    return {\r\n                      ...doctor,\r\n                      totalValue: stats?.totalValue || 0\r\n                    };\r\n                  })\r\n                  .sort((a, b) => b.totalValue - a.totalValue);\r\n\r\n                // Calcular paginao\r\n                const totalDoctors = sortedDoctors.length;\r\n                const totalPages = Math.ceil(totalDoctors / DOCTORS_PER_PAGE);\r\n                const startIndex = (currentDoctorPage - 1) * DOCTORS_PER_PAGE;\r\n                const endIndex = startIndex + DOCTORS_PER_PAGE;\r\n                const paginatedDoctors = sortedDoctors.slice(startIndex, endIndex);\r\n\r\n                return (\r\n                  <>\r\n                    {/* Pagination Controls - Top */}\r\n                    {totalPages > 1 && (\r\n                      <div className=\"flex items-center justify-between mb-4\">\r\n                        <div className=\"text-sm text-muted-foreground\">\r\n                          Mostrando {startIndex + 1}-{Math.min(endIndex, totalDoctors)} de {totalDoctors} mdicos\r\n                        </div>\r\n                        <div className=\"flex items-center space-x-2\">\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => setCurrentDoctorPage(prev => Math.max(prev - 1, 1))}\r\n                            disabled={currentDoctorPage === 1}\r\n                          >\r\n                            <ChevronLeft className=\"h-4 w-4\" />\r\n                          </Button>\r\n                          {Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (\r\n                            <Button\r\n                              key={page}\r\n                              variant={currentDoctorPage === page ? \"default\" : \"outline\"}\r\n                              size=\"sm\"\r\n                              onClick={() => setCurrentDoctorPage(page)}\r\n                            >\r\n                              {page}\r\n                            </Button>\r\n                          ))}\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => setCurrentDoctorPage(prev => Math.min(prev + 1, totalPages))}\r\n                            disabled={currentDoctorPage === totalPages}\r\n                          >\r\n                            <ChevronRight className=\"h-4 w-4\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n\r\n                    {/* Lista de mdicos paginada */}\r\n                    {paginatedDoctors.map((doctor, index) => {\r\n                      //  PERFORMANCE: Usar cache de stats (evita reclculo em cada render)\r\n                      const cardKey = getDoctorCardKey(doctor);\r\n                      const doctorStats = doctorStatsCache.get(cardKey);\r\n                      const isExpanded = expandedDoctors.has(cardKey);\r\n\r\n                      // Se stats no existe no cache, pular este mdico (no deve acontecer)\r\n                      if (!doctorStats) {\r\n                        console.warn(` Stats no encontrados no cache para: ${doctor.doctor_info.name}`);\r\n                        return null;\r\n                      }\r\n\r\n                      //  FUNO PARA MEDALHAS\r\n                      const getRankingMedal = (position: number) => {\r\n                        switch (position) {\r\n                          case 0: return '';\r\n                          case 1: return '';\r\n                          case 2: return '';\r\n                          default: return null;\r\n                        }\r\n                      };\r\n\r\n                      return (\r\n                        <Card key={cardKey} className=\"mb-8 border-2 border-gray-400 ring-1 ring-black/5 rounded-xl bg-white hover:shadow-md transition-all duration-300\">\r\n                          <Collapsible>\r\n                            <CollapsibleTrigger asChild>\r\n                              <div\r\n                                className=\"w-full cursor-pointer p-4 rounded-lg hover:bg-slate-50 transition-colors\"\r\n                                onClick={() => toggleDoctorExpansion(cardKey)}\r\n                              >\r\n                                {/* cone de expanso */}\r\n                                <div className=\"flex items-center gap-2 mb-2\">\r\n                                  {isExpanded ? (\r\n                                    <ChevronDown className=\"h-4 w-4 text-slate-500 transition-transform duration-200\" />\r\n                                  ) : (\r\n                                    <ChevronRight className=\"h-4 w-4 text-slate-500 transition-transform duration-200\" />\r\n                                  )}\r\n                                  <span className=\"text-xs text-slate-500 font-medium\">\r\n                                    {isExpanded ? 'Clique para recolher' : 'Clique para expandir pacientes e detalhes'}\r\n                                  </span>\r\n                                </div>\r\n\r\n                                {/* NOME DO MDICO - DESTAQUE */}\r\n                                <div className=\"mb-3 pb-3 border-b border-gray-100\">\r\n                                  <div className=\"flex items-center justify-between\">\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                      <div className=\"flex items-center justify-center w-10 h-10 bg-indigo-100 rounded-full\">\r\n                                        <Stethoscope className=\"h-5 w-5 text-indigo-600\" />\r\n                                      </div>\r\n                                      <div>\r\n                                        <div className=\"text-lg font-bold text-gray-900\">{doctor.doctor_info.name}</div>\r\n                                        <div className=\"text-xs text-gray-500 font-medium\">{doctor.doctor_info.specialty || ''}</div>\r\n                                      </div>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2\">\r\n                                      <Badge variant=\"outline\" className=\"bg-indigo-50 text-indigo-700 border-indigo-200 text-[10px] font-semibold\">\r\n                                        {doctorStats.simplifiedReportLineCount} PACIENTES\r\n                                      </Badge>\r\n                                      <Badge variant=\"outline\" className=\"bg-blue-50 text-blue-700 border-blue-200 text-[10px] font-semibold\">\r\n                                        {doctorStats.totalProcedures} PROC\r\n                                      </Badge>\r\n                                      {/*  BADGE: Pacientes sem Repasse Mdico */}\r\n                                      {(() => {\r\n                                        // Verificar se j foi calculado no cache\r\n                                        const cached = patientsWithoutPaymentCache.get(cardKey);\r\n\r\n                                        // Se foi expandido, calcular\r\n                                        if (isExpanded && !cached) {\r\n                                          // Calcular de forma assncrona (no bloqueia a UI)\r\n                                          setTimeout(() => calculatePatientsWithoutPayment(doctor, cardKey), 0);\r\n                                        }\r\n\r\n                                        // Mostrar badge apenas se houver dados e j foi calculado\r\n                                        if (cached && cached.calculated && doctor.patients && doctor.patients.length > 0) {\r\n                                          if (cached.count > 0) {\r\n                                            return (\r\n                                              <Badge variant=\"destructive\" className=\"text-[10px] font-semibold cursor-pointer\" onClick={() => openZeroRepasseModal(doctor)}>\r\n                                                <AlertCircle className=\"h-3 w-3 mr-1\" />\r\n                                                {cached.count} sem repasse\r\n                                              </Badge>\r\n                                            );\r\n                                          } else {\r\n                                            return (\r\n                                              <Badge variant=\"default\" className=\"text-[10px] font-semibold bg-green-100 text-green-800 border-green-300\">\r\n                                                <CheckCircle className=\"h-3 w-3 mr-1\" />\r\n                                                0 sem repasse\r\n                                              </Badge>\r\n                                            );\r\n                                          }\r\n                                        }\r\n\r\n                                        // Mostrar indicador \"clique para verificar\" se ainda no foi expandido\r\n                                        if (!cached && doctor.patients && doctor.patients.length > 0) {\r\n                                          return (\r\n                                            <Badge variant=\"outline\" className=\"text-[10px] font-semibold bg-gray-50 text-gray-600 border-gray-300\">\r\n                                              <Activity className=\"h-3 w-3 mr-1\" />\r\n                                              Expandir p/ verificar\r\n                                            </Badge>\r\n                                          );\r\n                                        }\r\n\r\n                                        return null;\r\n                                      })()}\r\n                                      {getRankingMedal(index) && (\r\n                                        <span className=\"text-2xl\">{getRankingMedal(index)}</span>\r\n                                      )}\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n\r\n                                {/* GRID DE INFORMAES - 2 COLUNAS */}\r\n                                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-2 mb-3\">\r\n                                  {/* Coluna 1 */}\r\n                                  <div className=\"space-y-2\">\r\n                                    <div className=\"flex items-baseline gap-2\">\r\n                                      <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">CNS:</span>\r\n                                      <span className=\"text-xs font-mono font-medium text-gray-900\">{doctor.doctor_info.cns || ''}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-baseline gap-2\">\r\n                                      <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">CRM:</span>\r\n                                      <span className=\"text-xs font-medium text-gray-900\">{doctor.doctor_info.crm || ''}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-baseline gap-2\">\r\n                                      <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Hospital:</span>\r\n                                      <span className=\"text-xs font-medium text-gray-900\">{(() => {\r\n                                        const hospitals = doctor.hospitals;\r\n                                        if (hospitals && hospitals.length > 0) {\r\n                                          const primaryHospital = hospitals.find((h: any) => h.is_primary_hospital);\r\n                                          const hospital = primaryHospital || hospitals[0];\r\n                                          return hospital.hospital_name;\r\n                                        }\r\n                                        return 'No definido';\r\n                                      })()}</span>\r\n                                    </div>\r\n                                  </div>\r\n\r\n                                  {/* Coluna 2 */}\r\n                                  <div className=\"space-y-2\">\r\n                                    <div className=\"flex items-baseline gap-2\">\r\n                                      <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Procedimentos:</span>\r\n                                      <span className=\"text-xs font-bold text-blue-700\">{doctorStats.totalProcedures}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-baseline gap-2\">\r\n                                      <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Ticket Mdio:</span>\r\n                                      <span className=\"text-xs font-medium text-gray-900\">{formatCurrency(doctorStats.avgTicket)}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-baseline gap-2\">\r\n                                      <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Regra Pagamento:</span>\r\n                                      <span className=\"text-xs font-medium text-gray-900\">{(() => {\r\n                                        const hospitalId = doctor.hospitals?.[0]?.hospital_id;\r\n\r\n                                        //  CORREO: Verificar se mdico tem regras individuais (rules)\r\n                                        // Se tiver rules, no  \"Valor Fixo\",  \"Regras por Proc.\"\r\n                                        const hasIndividualRules = hasIndividualPaymentRules(doctor.doctor_info.name, hospitalId);\r\n                                        const fixedCalc = calculateFixedPayment(doctor.doctor_info.name, hospitalId);\r\n\r\n                                        //  Se tem fixedPaymentRule MAS tambm tem rules individuais, no  \"Valor Fixo\"\r\n                                        if (fixedCalc.hasFixedRule && hasIndividualRules) {\r\n                                          // Tem regras individuais, ento  \"Regras por Proc.\" (fixedPaymentRule  apenas fallback)\r\n                                          if (doctorStats.calculatedPaymentValue > 0) return 'Regras por Proc.';\r\n                                          return '';\r\n                                        }\r\n\r\n                                        // Se tem fixedPaymentRule SEM rules individuais,  \"Valor Fixo\" (valor fixo mensal)\r\n                                        if (fixedCalc.hasFixedRule && !hasIndividualRules) return 'Valor Fixo';\r\n\r\n                                        const percentageCalc = calculatePercentagePayment(doctor.doctor_info.name, doctorStats.totalValue, hospitalId);\r\n                                        if (percentageCalc.hasPercentageRule) return `${percentageCalc.appliedRule.match(/\\d+%/)?.[0] || '65%'} do Total`;\r\n                                        if (doctorStats.calculatedPaymentValue > 0) return 'Regras por Proc.';\r\n                                        return '';\r\n                                      })()}</span>\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n\r\n                                {/* SEO DE VALORES - DESTAQUE ESPECIAL */}\r\n                                <div className=\"mt-3 pt-3 border-t-2 border-gray-200 space-y-2\">\r\n                                  {/* TOTAL DE AIHs - LINHA 1 */}\r\n                                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-2\">\r\n                                    <div className=\"bg-white rounded-lg p-3 border-2 border-emerald-400\">\r\n                                      <div className=\"flex items-center justify-between\">\r\n                                        <span className=\"text-xs font-bold text-black uppercase tracking-wide\">Total AIHs</span>\r\n                                        <span className=\"text-base font-black text-black\">{formatCurrency(doctorStats.totalValue)}</span>\r\n                                      </div>\r\n                                    </div>\r\n                                    <div className=\"bg-white rounded-lg p-3 border-2 border-blue-400\">\r\n                                      <div className=\"flex items-center justify-between\">\r\n                                        <span className=\"text-xs font-bold text-black uppercase tracking-wide\">Incremento</span>\r\n                                        <span className=\"text-base font-black text-black\">{(() => {\r\n                                          //  BEST PRACTICE: Usar valor pr-calculado de calculateDoctorStats\r\n                                          const increment = doctorStats.operaParanaIncrement || 0;\r\n\r\n                                          if (increment === 0) return '-';\r\n\r\n                                          //  LOG para verificao\r\n                                          console.log(` [CARD INCREMENTO] ${doctor.doctor_info.name}: R$ ${increment.toFixed(2)}`);\r\n\r\n                                          return formatCurrency(increment);\r\n                                        })()}</span>\r\n                                      </div>\r\n                                    </div>\r\n                                    <div className=\"bg-white rounded-lg p-3 border-2 border-violet-400\">\r\n                                      <div className=\"flex items-center justify-between\">\r\n                                        <span className=\"text-xs font-bold text-black uppercase tracking-wide\">c/ Opera Paran</span>\r\n                                        <span className=\"text-base font-black text-black\">{(() => {\r\n                                          //  BEST PRACTICE: Usar valor pr-calculado de calculateDoctorStats\r\n                                          const totalWithIncrement = doctorStats.totalValueWithOperaParana || doctorStats.totalValue || 0;\r\n                                          const increment = doctorStats.operaParanaIncrement || 0;\r\n\r\n                                          if (increment === 0) return '-';\r\n\r\n                                          //  LOG para verificao\r\n                                          console.log(` [CARD OPERA PARAN] ${doctor.doctor_info.name}: R$ ${totalWithIncrement.toFixed(2)} (Base: ${doctorStats.totalValue.toFixed(2)} + Incremento: ${increment.toFixed(2)})`);\r\n\r\n                                          return formatCurrency(totalWithIncrement);\r\n                                        })()}</span>\r\n                                      </div>\r\n                                    </div>\r\n                                  </div>\r\n\r\n                                  {/* PAGAMENTO MDICO - DESTAQUE ESPECIAL */}\r\n                                  <div className=\"bg-white rounded-lg p-4 border-2 border-green-500 shadow-sm\">\r\n                                    <div className=\"flex items-center justify-between\">\r\n                                      <div className=\"flex items-center gap-2\">\r\n                                        <DollarSign className=\"h-5 w-5 text-black\" />\r\n                                        <span className=\"text-sm font-bold text-black uppercase tracking-wide\">Pagamento Mdico</span>\r\n                                      </div>\r\n                                      <span className=\"text-xl font-black text-black\">\r\n                                        {formatCurrency((() => {\r\n                                          const hospitalId = doctor.hospitals?.[0]?.hospital_id;\r\n                                          const fixedCalc = calculateFixedPayment(doctor.doctor_info.name, hospitalId);\r\n                                          if (fixedCalc.hasFixedRule) {\r\n                                            return fixedCalc.calculatedPayment;\r\n                                          }\r\n                                          const percentageCalc = calculatePercentagePayment(doctor.doctor_info.name, doctorStats.totalValue, hospitalId);\r\n                                          if (percentageCalc.hasPercentageRule) {\r\n                                            return percentageCalc.calculatedPayment;\r\n                                          }\r\n                                          const fallback = doctorStats.calculatedPaymentValue || doctorStats.medicalProceduresValue || 0;\r\n                                          if (fallback > 0) {\r\n                                            console.log(` [CARD] ${doctor.doctor_info.name}: R$ ${fallback.toFixed(2)} (fallback regras por procedimento)`);\r\n                                          }\r\n                                          return fallback;\r\n                                        })())}\r\n                                      </span>\r\n                                    </div>\r\n                                  </div>\r\n                                </div>\r\n\r\n                                {/* BOTES DE AO - GRID HORIZONTAL */}\r\n                                <div className=\"mt-4 pt-3 border-t border-gray-100\">\r\n                                  <div className=\"flex flex-wrap gap-2 justify-start items-center\">\r\n\r\n                                    <Button\r\n                                      type=\"button\"\r\n                                      onClick={(e) => {\r\n                                        e.stopPropagation();\r\n                                        try {\r\n                                          const rows: Array<Array<string | number>> = [];\r\n                                          //  AGORA COM 16 COLUNAS (adicionado Instrumento de Registro)\r\n                                          const header = [\r\n                                            '#',\r\n                                            'Nome do Paciente',\r\n                                            'N AIH',\r\n                                            'Cdigo Procedimento',\r\n                                            'Descrio Procedimento',\r\n                                            'Instrumento de Registro',\r\n                                            'Data Procedimento',\r\n                                            'Data Alta (SUS)',\r\n                                            'Especialidade de Atendimento',\r\n                                            'Carter de Atendimento',\r\n                                            'Mdico',\r\n                                            'Hospital',\r\n                                            'Valor Procedimento',\r\n                                            'AIH Seca',\r\n                                            'Incremento',\r\n                                            'AIH c/ Incremento'\r\n                                          ];\r\n                                          let idx = 1;\r\n                                          const doctorName = doctor.doctor_info?.name || '';\r\n                                          const hospitalName = doctor.hospitals?.[0]?.hospital_name || '';\r\n                                          const hospitalId = doctor.hospitals?.[0]?.hospital_id;\r\n\r\n                                          //  CORREO: NO deduplicate - cada entrada em doctor.patients j  uma AIH nica\r\n                                          // O servio doctorPatientService j garante que no h duplicatas\r\n\r\n                                          console.log(` [RELATRIO MDICO] Gerando relatrio para ${doctorName}`);\r\n                                          console.log(` [RELATRIO MDICO] Total de AIHs: ${(doctor.patients || []).length}`);\r\n\r\n                                          (doctor.patients || []).forEach((p: any) => {\r\n                                            //  FILTRO UNIFICADO: Intervalo de datas (mesmo dos relatrios gerais)\r\n                                            if (false) {\r\n                                              const discharge = p?.aih_info?.discharge_date ? new Date(p.aih_info.discharge_date) : undefined;\r\n\r\n                                              if (!discharge) return;\r\n\r\n                                              const startOfPeriod = new Date();\r\n                                              const endOfPeriod = new Date();\r\n\r\n                                              const dischargeDate = new Date(discharge);\r\n\r\n                                              if (dischargeDate < startOfPeriod || dischargeDate > endOfPeriod) {\r\n                                                return;\r\n                                              }\r\n                                            }\r\n\r\n                                            const name = p.patient_info?.name || 'Paciente';\r\n                                            const aihRaw = (p?.aih_info?.aih_number || '').toString().replace(/\\D/g, '');\r\n                                            const aih = aihRaw || 'Aguardando gerao';\r\n\r\n                                            const careSpec = (p?.aih_info?.specialty || '').toString();\r\n                                            const careCharacter = (() => {\r\n                                              const raw = (p?.aih_info?.care_character ?? '').toString();\r\n                                              try { return CareCharacterUtils.formatForDisplay(raw, false); } catch { return raw; }\r\n                                            })();\r\n                                            const disISO = p?.aih_info?.discharge_date || '';\r\n                                            const disLabel = disISO\r\n                                              ? parseISODateToLocal(disISO)\r\n                                              : '';\r\n\r\n                                            //  CLCULOS FINANCEIROS (mesma lgica do relatrio geral)\r\n                                            const baseAih = Number(p.total_value_reais || 0);\r\n                                            const doctorCovered = isDoctorCoveredForOperaParana(doctorName, hospitalId);\r\n                                            const procedures = (p as any).calculable_procedures || (p.procedures || []).filter(filterCalculableProcedures);\r\n                                            const increment = doctorCovered ? computeIncrementForProcedures(procedures as any, p?.aih_info?.care_character, doctorName, hospitalId) : 0;\r\n                                            const aihWithIncrements = baseAih + increment;\r\n\r\n                                            //  FIX: Mostrar os mesmos procedimentos calculveis usados na tela\r\n                                            if (procedures.length > 0) {\r\n                                              procedures.forEach((proc: any) => {\r\n                                                const procCode = proc.procedure_code || '';\r\n                                                const procDesc = proc.procedure_description || proc.sigtap_description || '';\r\n                                                const registrationInstrument = proc.registration_instrument || '-';\r\n                                                const procDate = proc.procedure_date || '';\r\n                                                const procDateLabel = procDate\r\n                                                  ? (() => {\r\n                                                    const s = String(procDate);\r\n                                                    const m = s.match(/^(\\d{4})-(\\d{2})-(\\d{2})/);\r\n                                                    return m ? `${m[3]}/${m[2]}/${m[1]}` : parseISODateToLocal(s);\r\n                                                  })()\r\n                                                  : '';\r\n                                                const procValue = Number(proc.value_reais || 0);\r\n\r\n                                                rows.push([\r\n                                                  idx++,\r\n                                                  name,\r\n                                                  aih,\r\n                                                  procCode,\r\n                                                  procDesc,\r\n                                                  registrationInstrument,\r\n                                                  procDateLabel,\r\n                                                  disLabel,\r\n                                                  careSpec,\r\n                                                  careCharacter,\r\n                                                  doctorName,\r\n                                                  hospitalName,\r\n                                                  procValue,\r\n                                                  baseAih,\r\n                                                  increment,\r\n                                                  aihWithIncrements\r\n                                                ]);\r\n                                              });\r\n                                            } else {\r\n                                              // Paciente sem procedimentos\r\n                                              rows.push([\r\n                                                idx++,\r\n                                                name,\r\n                                                aih,\r\n                                                '',\r\n                                                'Nenhum procedimento encontrado',\r\n                                                '-',\r\n                                                '',\r\n                                                disLabel,\r\n                                                careSpec,\r\n                                                careCharacter,\r\n                                                doctorName,\r\n                                                hospitalName,\r\n                                                0,\r\n                                                baseAih,\r\n                                                increment,\r\n                                                aihWithIncrements\r\n                                              ]);\r\n                                            }\r\n                                          });\r\n\r\n                                          //  ORDENAO: Por Data de Alta (mais recente primeiro)\r\n                                          rows.sort((a, b) => {\r\n                                            const dateA = a[7] as string; // Data Alta (SUS) est na posio 7 (aps adicionar Instrumento)\r\n                                            const dateB = b[7] as string;\r\n\r\n                                            // Sem data  final\r\n                                            if (!dateA && !dateB) return 0;\r\n                                            if (!dateA) return 1;\r\n                                            if (!dateB) return -1;\r\n\r\n                                            // Converter DD/MM/YYYY para Date\r\n                                            const parseDate = (dateStr: string) => {\r\n                                              const parts = dateStr.split('/');\r\n                                              if (parts.length === 3) {\r\n                                                return new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));\r\n                                              }\r\n                                              return new Date(0);\r\n                                            };\r\n\r\n                                            const parsedDateA = parseDate(dateA);\r\n                                            const parsedDateB = parseDate(dateB);\r\n\r\n                                            // DESCENDENTE (mais recente primeiro)\r\n                                            return parsedDateB.getTime() - parsedDateA.getTime();\r\n                                          });\r\n\r\n                                          // Renumerar aps ordenao\r\n                                          rows.forEach((row, index) => {\r\n                                            row[0] = index + 1;\r\n                                          });\r\n\r\n                                          console.log(` [RELATRIO MDICO] Total de linhas geradas: ${rows.length} (ordenadas por data de alta DESC)`);\r\n\r\n                                          const wb = XLSX.utils.book_new();\r\n                                          const ws = XLSX.utils.aoa_to_sheet([header, ...rows]);\r\n                                          //  LARGURAS DAS COLUNAS (atualizado com Instrumento de Registro)\r\n                                          const wsAny: any = ws;\r\n                                          wsAny['!cols'] = [\r\n                                            { wch: 5 },   // #\r\n                                            { wch: 35 },  // Nome do Paciente\r\n                                            { wch: 18 },  // N AIH\r\n                                            { wch: 20 },  // Cdigo Procedimento\r\n                                            { wch: 45 },  // Descrio Procedimento\r\n                                            { wch: 25 },  // Instrumento de Registro\r\n                                            { wch: 16 },  // Data Procedimento\r\n                                            { wch: 16 },  // Data Alta (SUS)\r\n                                            { wch: 25 },  // Especialidade\r\n                                            { wch: 22 },  // Carter de Atendimento\r\n                                            { wch: 30 },  // Mdico\r\n                                            { wch: 35 },  // Hospital\r\n                                            { wch: 18 },  // Valor Procedimento\r\n                                            { wch: 18 },  // AIH Seca\r\n                                            { wch: 18 },  // Incremento\r\n                                            { wch: 20 },  // AIH c/ Incremento\r\n                                          ];\r\n                                          XLSX.utils.book_append_sheet(wb, ws, 'Pacientes');\r\n                                          //  Resumo por mdico\r\n                                          const uniqueKeys: Record<string, true> = {};\r\n                                          let aihsWithProcedures = 0;\r\n                                          for (const p of (doctor.patients || []) as any[]) {\r\n                                            const aihId = String(p.aih_id || '').trim();\r\n                                            const aihNumber = String((p?.aih_info?.aih_number || '')).replace(/\\D/g, '').replace(/^0+/, '');\r\n                                            const key = aihId || aihNumber || `${p.patient_id || ''}|${p?.aih_info?.admission_date || ''}`;\r\n                                            if (key) uniqueKeys[key] = true;\r\n                                            const calcs = (p as any).calculable_procedures || (p.procedures || []).filter(filterCalculableProcedures);\r\n                                            if (calcs.length > 0) aihsWithProcedures++;\r\n                                          }\r\n                                          const totalCardAihs = Object.keys(uniqueKeys).length;\r\n                                          const summaryRows = [\r\n                                            ['AIHs (registros nicos) na tela', totalCardAihs],\r\n                                            ['AIHs com 1 procedimento calculvel', aihsWithProcedures],\r\n                                            ['Linhas no relatrio (procedimentos + placeholders)', rows.length],\r\n                                          ];\r\n                                          const wsSummary = XLSX.utils.aoa_to_sheet([['Resumo'], ...summaryRows]);\r\n                                          const wsSummaryAny: any = wsSummary;\r\n                                          wsSummaryAny['!cols'] = [{ wch: 52 }, { wch: 18 }];\r\n                                          XLSX.utils.book_append_sheet(wb, wsSummary, 'Resumo');\r\n                                          const fileName = `Relatorio_Pacientes_${doctorName.replace(/\\s+/g, '_')}_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.xlsx`;\r\n                                          XLSX.writeFile(wb, fileName);\r\n                                          toast.success('Relatrio de pacientes do mdico gerado com sucesso!');\r\n                                        } catch (err) {\r\n                                          console.error('Erro ao exportar Relatrio Pacientes (card):', err);\r\n                                          toast.error('Erro ao gerar relatrio do mdico');\r\n                                        }\r\n                                      }}\r\n                                      className=\"inline-flex items-center gap-2 bg-[#0b1736] hover:bg-[#09122a] text-white shadow-sm h-9 px-3 rounded-md text-sm w-auto min-w-[200px]\"\r\n                                    >\r\n                                      <FileSpreadsheet className=\"h-4 w-4\" />\r\n                                      Relatrio Pacientes\r\n                                    </Button>\r\n\r\n                                    <Button\r\n                                      type=\"button\"\r\n                                      onClick={async (e) => {\r\n                                        e.stopPropagation();\r\n                                        await generateSimplifiedReport(doctor, false);\r\n                                        return;\r\n                                        try {\r\n                                          //  Carregar logo do CIS\r\n                                          let logoBase64 = null;\r\n                                          try {\r\n                                            const response = await fetch('/CIS Sem fundo.jpg');\r\n                                            const blob = await response.blob();\r\n                                            logoBase64 = await new Promise<string>((resolve) => {\r\n                                              const reader = new FileReader();\r\n                                              reader.onloadend = () => resolve(reader.result as string);\r\n                                              reader.readAsDataURL(blob);\r\n                                            });\r\n                                          } catch (error) {\r\n                                            console.error(' Erro ao carregar logo:', error);\r\n                                          }\r\n\r\n                                          const doctorName = doctor.doctor_info?.name || '';\r\n                                          const hospitalId = doctor.hospitals?.[0]?.hospital_id;\r\n                                          const hospitalName = doctor.hospitals?.[0]?.hospital_name || 'Hospital no identificado';\r\n\r\n                                          console.log(` [RELATRIO MDICO SIMPLIFICADO PDF] Gerando para ${doctorName}`);\r\n                                          console.log(` [RELATRIO MDICO SIMPLIFICADO PDF] Hospital: ${hospitalName}`);\r\n\r\n                                          // Preparar dados para a tabela\r\n                                          const tableData: Array<Array<string>> = [];\r\n                                          let totalRepasse = 0; //  Calcular total durante o loop\r\n                                          let totalPatientsProcessed = 0; //  Total de pacientes processados\r\n                                          let patientsWithPayment = 0; //  Pacientes com repasse > 0\r\n\r\n                                          //  Aprovao via fonte remota SIH: match por AIH\r\n                                          let approvedSet = new Set<string>();\r\n                                          try {\r\n                                            const allAihNumbers = (doctor.patients || [])\r\n                                              .map((p: any) => String(p?.aih_info?.aih_number || '').trim())\r\n                                              .filter((v: string) => !!v);\r\n                                            const uniqueAih = Array.from(new Set(allAihNumbers));\r\n                                            if (uniqueAih.length > 0 && ENV_CONFIG.SIH_SUPABASE_URL && ENV_CONFIG.SIH_SUPABASE_ANON_KEY) {\r\n                                              const { supabaseSih } = await import('../lib/sihSupabase');\r\n                                              if (supabaseSih) {\r\n                                                let compYear: number | undefined;\r\n                                                let compMonth: number | undefined;\r\n                                                if (selectedCompetencia && selectedCompetencia.trim() && selectedCompetencia !== 'all') {\r\n                                                  const raw = selectedCompetencia.trim();\r\n                                                  if (/^\\d{6}$/.test(raw)) {\r\n                                                    compYear = parseInt(raw.slice(0, 4), 10);\r\n                                                    compMonth = parseInt(raw.slice(4, 6), 10);\r\n                                                  } else {\r\n                                                    const m = raw.match(/^(\\d{4})-(\\d{2})/);\r\n                                                    if (m) {\r\n                                                      compYear = parseInt(m[1], 10);\r\n                                                      compMonth = parseInt(m[2], 10);\r\n                                                    }\r\n                                                  }\r\n                                                }\r\n                                                const chunkSize = 80;\r\n                                                for (let i = 0; i < uniqueAih.length; i += chunkSize) {\r\n                                                  const ch = uniqueAih.slice(i, i + chunkSize);\r\n                                                  let spQuery = supabaseSih\r\n                                                    .from('sih_sp')\r\n                                                    .select('sp_naih')\r\n                                                    .in('sp_naih', ch);\r\n                                                  if (typeof compMonth === 'number') spQuery = spQuery.eq('sp_mm', compMonth);\r\n                                                  if (typeof compYear === 'number') spQuery = spQuery.eq('sp_aa', compYear);\r\n                                                  const { data: spRows, error: spErr } = await spQuery;\r\n                                                  if (!spErr && spRows && spRows.length > 0) {\r\n                                                    spRows.forEach((r: any) => {\r\n                                                      const k = String(r.sp_naih || '').trim();\r\n                                                      if (k) approvedSet.add(k);\r\n                                                    });\r\n                                                  }\r\n                                                }\r\n                                                //  Atualizar coluna 'aprovado' na tabela local aihs (SIM/NO)\r\n                                                try {\r\n                                                  if (approvedSet.size > 0) {\r\n                                                    const approvedList = Array.from(approvedSet);\r\n                                                    await supabase\r\n                                                      .from('aihs')\r\n                                                      .update({ aprovado: 'sim' })\r\n                                                      .in('aih_number', approvedList);\r\n                                                    const notApproved = uniqueAih.filter(a => !approvedSet.has(a));\r\n                                                    if (notApproved.length > 0) {\r\n                                                      await supabase\r\n                                                        .from('aihs')\r\n                                                        .update({ aprovado: 'no' })\r\n                                                        .in('aih_number', notApproved);\r\n                                                    }\r\n                                                  } else if (uniqueAih.length > 0) {\r\n                                                    await supabase\r\n                                                      .from('aihs')\r\n                                                      .update({ aprovado: 'no' })\r\n                                                      .in('aih_number', uniqueAih);\r\n                                                  }\r\n                                                } catch (updErr) {\r\n                                                  console.warn(' Falha ao atualizar coluna aprovado nas AIHs locais:', updErr);\r\n                                                }\r\n                                              }\r\n                                            }\r\n                                          } catch (apprErr) {\r\n                                            console.warn(' Falha na verificao de aprovao remota SIH:', apprErr);\r\n                                          }\r\n\r\n                                          (doctor.patients || []).forEach((p: any) => {\r\n                                            totalPatientsProcessed++;\r\n                                            //  FILTRO UNIFICADO: Intervalo de datas (mesmo dos outros relatrios)\r\n                                            if (false) {\r\n                                              const discharge = p?.aih_info?.discharge_date ? new Date(p.aih_info.discharge_date) : undefined;\r\n\r\n                                              if (!discharge) return;\r\n\r\n                                              const startOfPeriod = new Date();\r\n                                              const endOfPeriod = new Date();\r\n\r\n                                              const dischargeDate = new Date(discharge);\r\n\r\n                                              if (dischargeDate < startOfPeriod || dischargeDate > endOfPeriod) {\r\n                                                return;\r\n                                              }\r\n                                            }\r\n\r\n                                            const medicalRecord = p.patient_info?.medical_record || '-';\r\n                                            const name = p.patient_info?.name || 'Paciente';\r\n\r\n                                            const mainProc = (p.procedures || [])\r\n                                              .reduce((max: any, proc: any) => {\r\n                                                const v = typeof proc.value_reais === 'number' ? proc.value_reais : 0;\r\n                                                const mv = typeof (max && max.value_reais) === 'number' ? max.value_reais : -1;\r\n                                                return v > mv ? proc : max;\r\n                                              }, null as any);\r\n                                            const mainProcDesc = ((mainProc?.procedure_description || mainProc?.sigtap_description || '') as string).trim();\r\n                                            const proceduresDisplay = mainProcDesc || (mainProc?.procedure_code ? `Procedimento ${mainProc.procedure_code}` : 'Sem procedimento principal');\r\n                                            const aihNumber = p?.aih_info?.aih_number || '-';\r\n                                            //  CORREO: Lgica de pendncia sincronizada\r\n                                            // Se aprovado = SIM, mostra a competncia\r\n                                            // Se aprovado = NO, mostra \"\" (em branco)\r\n                                            const isApproved = approvedSet.has(String(aihNumber).trim());\r\n                                            const approvedLabel = isApproved ? 'Sim' : 'No';\r\n                                            const competenciaLabel = getSafeCompetenciaLabel(p, selectedCompetencia, isApproved);\r\n\r\n                                            const dischargeISO = p?.aih_info?.discharge_date || '';\r\n                                            const dischargeLabel = parseISODateToLocal(dischargeISO);\r\n\r\n                                            //  NOVO: Carter de atendimento\r\n                                            const careCharacter = p?.aih_info?.care_character || '';\r\n\r\n                                            //  NOVO: Calcular valor de repasse (mesma lgica do card)\r\n                                            //  CORREO: Usar MESMO filtro do card (apenas cdigos 04.xxx)\r\n                                            //  CORREO 2: Ordenar procedimentos por sequence e valor (igual ao card)\r\n                                            const proceduresWithPayment = p.procedures\r\n                                              .filter((proc: any) =>\r\n                                                isMedicalProcedure(proc.procedure_code) &&\r\n                                                shouldCalculateAnesthetistProcedure(proc.cbo, proc.procedure_code)\r\n                                              )\r\n                                              .sort((a: any, b: any) => {\r\n                                                // Ordenar por sequence primeiro, depois por valor (decrescente)\r\n                                                const sa = typeof a.sequence === 'number' ? a.sequence : 9999;\r\n                                                const sb = typeof b.sequence === 'number' ? b.sequence : 9999;\r\n                                                if (sa !== sb) return sa - sb;\r\n                                                const va = typeof a.value_reais === 'number' ? a.value_reais : 0;\r\n                                                const vb = typeof b.value_reais === 'number' ? b.value_reais : 0;\r\n                                                return vb - va;\r\n                                              })\r\n                                              .map((proc: any) => ({\r\n                                                procedure_code: proc.procedure_code,\r\n                                                procedure_description: proc.procedure_description,\r\n                                                value_reais: proc.value_reais || 0,\r\n                                                cbo: proc.cbo,\r\n                                              }));\r\n\r\n                                            let repasseValue = 0;\r\n                                            if (proceduresWithPayment.length > 0) {\r\n                                              const isGenSurg = /cirurg/i.test(doctorName) || (/cirurg/i.test(doctor.doctor_info.specialty || '') && /geral/i.test(doctor.doctor_info.specialty || ''))\r\n                                              const useHon = shouldUseHonForHospital(doctorName, hospitalId, !!isGenSurg)\r\n                                              const paymentResult = useHon\r\n                                                ? calculateHonPayments(proceduresWithPayment)\r\n                                                : calculateDoctorPayment(\r\n                                                  doctorName,\r\n                                                  proceduresWithPayment,\r\n                                                  hospitalId\r\n                                                );\r\n                                              repasseValue = paymentResult.totalPayment || 0;\r\n                                              totalRepasse += repasseValue; //  Somar ao total\r\n                                            }\r\n\r\n                                            //  CORREO: INCLUIR TODOS OS PACIENTES (mesmo com R$ 0,00)\r\n                                            // Garante consistncia com o valor do card \"PAGAMENTO MDICO\"\r\n                                            patientsWithPayment++; //  Contar todos os pacientes\r\n                                            tableData.push([\r\n                                              medicalRecord,\r\n                                              aihNumber,\r\n                                              name,\r\n                                              proceduresDisplay,\r\n                                              dischargeLabel,\r\n                                              competenciaLabel,\r\n                                              approvedLabel,\r\n                                              formatCurrency(repasseValue) // Pode ser R$ 0,00\r\n                                            ]);\r\n                                          });\r\n\r\n                                          //  LOG: Resultado da incluso de pacientes\r\n                                          console.log(` [RELATRIO SIMPLIFICADO] Total de pacientes includos: ${patientsWithPayment}`);\r\n                                          console.log(` [RELATRIO SIMPLIFICADO] TODOS os pacientes foram includos (incluindo R$ 0,00)`);\r\n                                          console.log(` [RELATRIO SIMPLIFICADO] Valor total de repasse: R$ ${totalRepasse.toFixed(2)}`);\r\n\r\n                                          //  ORDENAO: Por Data de Alta (mais recente primeiro)\r\n                                          tableData.sort((a, b) => {\r\n                                            const dateA = a[4] as string; // Data de Alta est na posio 4\r\n                                            const dateB = b[4] as string;\r\n\r\n                                            // Sem data  final\r\n                                            if (!dateA && !dateB) return 0;\r\n                                            if (!dateA) return 1;\r\n                                            if (!dateB) return -1;\r\n\r\n                                            // Converter DD/MM/YYYY para Date\r\n                                            const parseDate = (dateStr: string) => {\r\n                                              const parts = dateStr.split('/');\r\n                                              if (parts.length === 3) {\r\n                                                return new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));\r\n                                              }\r\n                                              return new Date(0);\r\n                                            };\r\n\r\n                                            const parsedDateA = parseDate(dateA);\r\n                                            const parsedDateB = parseDate(dateB);\r\n\r\n                                            // DESCENDENTE (mais recente primeiro)\r\n                                            return parsedDateB.getTime() - parsedDateA.getTime();\r\n                                          });\r\n\r\n                                          console.log(` [RELATRIO MDICO SIMPLIFICADO PDF] Total de linhas: ${tableData.length} (ordenadas por data de alta DESC)`);\r\n\r\n                                          // Criar PDF\r\n                                          const doc = new jsPDF('landscape');\r\n                                          const pageWidth = doc.internal.pageSize.getWidth();\r\n                                          const pageHeight = doc.internal.pageSize.getHeight();\r\n                                          // Fonte do relatrio (topo)\r\n                                          try {\r\n                                            const sourceLabel = useSihSource ? 'TABWIN' : 'GSUS';\r\n                                            doc.setFontSize(10);\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.setTextColor(80, 80, 80);\r\n                                            doc.text(sourceLabel, pageWidth - 20, 10, { align: 'right' });\r\n                                          } catch { }\r\n\r\n                                          // ========== CABEALHO PROFISSIONAL COM LOGO ==========\r\n                                          let yPosition = 20;\r\n\r\n                                          // Logo CIS (se carregado)\r\n                                          if (logoBase64) {\r\n                                            const logoWidth = 40;\r\n                                            const logoHeight = 20;\r\n                                            const logoX = 20;\r\n                                            const logoY = 8;\r\n                                            doc.addImage(logoBase64, 'JPEG', logoX, logoY, logoWidth, logoHeight);\r\n                                            yPosition = logoY + logoHeight + 10;\r\n                                          }\r\n\r\n                                          // Ttulo do Documento\r\n                                          doc.setFontSize(16);\r\n                                          doc.setFont('helvetica', 'bold');\r\n                                          doc.setTextColor(0, 51, 102); // Azul escuro\r\n                                          doc.text('RELATRIO DE PACIENTES - MDICO', pageWidth / 2, yPosition, { align: 'center' });\r\n\r\n                                          // Barra de informaes horizontal (premium)\r\n                                          yPosition += 10;\r\n                                          const careHeader = (filterCareCharacter && filterCareCharacter !== 'all')\r\n                                            ? CareCharacterUtils.formatForDisplay(filterCareCharacter, false)\r\n                                            : 'TODOS';\r\n                                          const compHeader = (selectedCompetencia && selectedCompetencia !== 'all')\r\n                                            ? formatCompetencia(selectedCompetencia)\r\n                                            : 'TODAS';\r\n                                          const dataGeracao = new Date().toLocaleDateString('pt-BR', {\r\n                                            day: '2-digit',\r\n                                            month: '2-digit',\r\n                                            year: 'numeric',\r\n                                            hour: '2-digit',\r\n                                            minute: '2-digit'\r\n                                          });\r\n                                          const line1: Array<{ label: string; value: string; bold?: boolean }> = [\r\n                                            { label: 'Mdico: ', value: doctorName, bold: true },\r\n                                            { label: 'Hospital: ', value: hospitalName }\r\n                                          ];\r\n                                          const line2: Array<{ label: string; value: string; bold?: boolean }> = [\r\n                                            { label: 'Comp. Aprovao: ', value: compHeader },\r\n                                            { label: 'Carter: ', value: careHeader },\r\n                                            { label: 'Gerado em: ', value: dataGeracao }\r\n                                          ];\r\n                                          const separator = '  |  ';\r\n                                          const drawSegments = (segments: Array<{ label: string; value: string; bold?: boolean }>, y: number, fontSize = 10) => {\r\n                                            doc.setFontSize(fontSize);\r\n                                            doc.setTextColor(60, 60, 60);\r\n                                            let totalWidth = 0;\r\n                                            segments.forEach((seg, idx) => {\r\n                                              totalWidth += doc.getTextWidth(seg.label) + doc.getTextWidth(seg.value);\r\n                                              if (idx < segments.length - 1) totalWidth += doc.getTextWidth(separator);\r\n                                            });\r\n                                            let x = (pageWidth / 2) - (totalWidth / 2);\r\n                                            segments.forEach((seg, idx) => {\r\n                                              doc.setFont('helvetica', 'normal');\r\n                                              doc.text(seg.label, x, y);\r\n                                              x += doc.getTextWidth(seg.label);\r\n                                              doc.setFont('helvetica', seg.bold ? 'bold' : 'normal');\r\n                                              doc.text(seg.value, x, y);\r\n                                              x += doc.getTextWidth(seg.value);\r\n                                              if (idx < segments.length - 1) {\r\n                                                doc.setFont('helvetica', 'normal');\r\n                                                doc.setTextColor(100, 100, 100);\r\n                                                doc.text(separator, x, y);\r\n                                                doc.setTextColor(60, 60, 60);\r\n                                                x += doc.getTextWidth(separator);\r\n                                              }\r\n                                            });\r\n                                          };\r\n                                          drawSegments(line1, yPosition, 11);\r\n                                          yPosition += 6;\r\n                                          drawSegments(line2, yPosition, 10);\r\n\r\n                                          // Linha separadora\r\n                                          yPosition += 8;\r\n                                          doc.setDrawColor(200, 200, 200);\r\n                                          doc.setLineWidth(0.5);\r\n                                          doc.line(20, yPosition, pageWidth - 20, yPosition);\r\n\r\n                                          // ========== TABELA COM DADOS ==========\r\n                                          const startY = yPosition + 10;\r\n\r\n                                          autoTable(doc, {\r\n                                            head: [['Pronturio', 'N da AIH', 'Nome do Paciente', 'Procedimento Principal', 'Data Alta', 'Comp. Aprovao', 'Homologado (SIH)', 'Valor de Repasse']],\r\n                                            body: tableData,\r\n                                            startY: startY,\r\n                                            theme: 'striped',\r\n                                            tableWidth: 'auto',\r\n                                            headStyles: {\r\n                                              fillColor: [0, 51, 102],\r\n                                              textColor: [255, 255, 255],\r\n                                              fontStyle: 'bold',\r\n                                              fontSize: 9,\r\n                                              halign: 'center',\r\n                                              cellPadding: 2\r\n                                            },\r\n                                            bodyStyles: {\r\n                                              fontSize: 8,\r\n                                              textColor: [50, 50, 50],\r\n                                              cellPadding: 2\r\n                                            },\r\n                                            columnStyles: {\r\n                                              0: { cellWidth: 24, halign: 'center' },\r\n                                              1: { cellWidth: 32, halign: 'center' },\r\n                                              2: { cellWidth: 42, halign: 'left' },\r\n                                              3: { cellWidth: 62, halign: 'left', fontSize: 7 },\r\n                                              4: { cellWidth: 22, halign: 'center' },\r\n                                              5: { cellWidth: 28, halign: 'center' },\r\n                                              6: { cellWidth: 24, halign: 'center' },\r\n                                              7: { cellWidth: 32, halign: 'right', fontStyle: 'bold', textColor: [0, 102, 0] }\r\n                                            },\r\n                                            styles: {\r\n                                              overflow: 'linebreak',\r\n                                              cellPadding: 2,\r\n                                              fontSize: 8\r\n                                            },\r\n                                            margin: { left: 15, right: 15 },\r\n                                            alternateRowStyles: {\r\n                                              fillColor: [245, 245, 245]\r\n                                            }\r\n                                          });\r\n                                          const finalY = (doc as any).lastAutoTable?.finalY || startY + 50;\r\n                                          const footerY = pageHeight - 20;\r\n                                          doc.setDrawColor(200, 200, 200);\r\n                                          doc.setLineWidth(0.5);\r\n                                          doc.line(20, footerY - 10, pageWidth - 20, footerY - 10);\r\n                                          doc.setFontSize(8);\r\n                                          doc.setFont('helvetica', 'normal');\r\n                                          doc.setTextColor(120, 120, 120);\r\n                                          doc.text('CIS - Centro Integrado em Sade', pageWidth / 2, footerY - 5, { align: 'center' });\r\n                                          doc.setFontSize(9);\r\n                                          doc.setFont('helvetica', 'bold');\r\n                                          doc.setTextColor(0, 51, 102);\r\n                                          doc.text(`Total de Pacientes: ${tableData.length} | Valor Total de Repasse: ${formatCurrency(totalRepasse)}`, pageWidth / 2, footerY + 5, { align: 'center' });\r\n\r\n                                          // Salvar PDF\r\n                                          const fileName = `Relatorio_Pacientes_Simplificado_${doctorName.replace(/\\s+/g, '_')}_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.pdf`;\r\n                                          doc.save(fileName);\r\n\r\n                                          toast.success('Relatrio PDF gerado com sucesso!');\r\n                                        } catch (err) {\r\n                                          console.error('Erro ao exportar Relatrio Simplificado (PDF):', err);\r\n                                          toast.error('Erro ao gerar relatrio PDF');\r\n                                        }\r\n                                      }}\r\n                                      className=\"inline-flex items-center gap-2 bg-[#0b1736] hover:bg-[#09122a] text-white shadow-sm h-9 px-3 rounded-md text-sm w-auto min-w-[200px]\"\r\n                                    >\r\n                                      <FileSpreadsheet className=\"h-4 w-4\" />\r\n                                      Relatrio Pacientes Simplificado\r\n                                    </Button>\r\n                                    <Button\r\n                                      type=\"button\"\r\n                                      onClick={async (e) => {\r\n                                        e.stopPropagation();\r\n                                        await generateSimplifiedReport(doctor, false, true);\r\n                                      }}\r\n                                      className=\"inline-flex items-center gap-2 bg-[#0b1736] hover:bg-[#09122a] text-white shadow-sm h-9 px-3 rounded-md text-sm w-auto min-w-[200px]\"\r\n                                    >\r\n                                      <FileSpreadsheet className=\"h-4 w-4\" />\r\n                                      Relatrio Simplificado (Sem Zeros)\r\n                                    </Button>\r\n                                    {false && (<>\r\n                                      {/*  PROTOCOLO DE ATENDIMENTO APROVADO */}\r\n                                      <Button\r\n                                        type=\"button\"\r\n                                        onClick={async (e) => {\r\n                                          e.stopPropagation();\r\n                                          try {\r\n                                            //  Carregar logo do CIS\r\n                                            let logoBase64 = null;\r\n                                            try {\r\n                                              const response = await fetch('/CIS Sem fundo.jpg');\r\n                                              const blob = await response.blob();\r\n                                              logoBase64 = await new Promise<string>((resolve) => {\r\n                                                const reader = new FileReader();\r\n                                                reader.onloadend = () => resolve(reader.result as string);\r\n                                                reader.readAsDataURL(blob);\r\n                                              });\r\n                                            } catch (error) {\r\n                                              console.error(' [PROTOCOLO] Erro ao carregar logo:', error);\r\n                                            }\r\n\r\n                                            const doctorName = doctor.doctor_info?.name || 'Mdico';\r\n                                            const hospitalName = doctor.hospitals?.[0]?.hospital_name || 'Hospital';\r\n                                            const competenciaLabel = selectedCompetencia && selectedCompetencia !== 'all'\r\n                                              ? formatCompetencia(selectedCompetencia)\r\n                                              : 'Todas as competncias';\r\n\r\n                                            console.log(` [PROTOCOLO] Gerando protocolo de atendimento aprovado para ${doctorName}`);\r\n                                            console.log(` [PROTOCOLO] Competncia: ${competenciaLabel}`);\r\n                                            console.log(` [PROTOCOLO] Usando MESMA lgica do Relatrio Pacientes Geral`);\r\n\r\n                                            //  Usar a mesma fonte de dados e filtros do Relatrio Pacientes Geral\r\n                                            const protocolData: any[] = [];\r\n                                            let idx = 1;\r\n                                            let totalProcsFound = 0;\r\n                                            let totalProcsFiltered = 0;\r\n                                            let aihsWithoutMainProcedure = 0;\r\n\r\n                                            (doctor.patients || []).forEach((p: any) => {\r\n                                              const patientName = p.patient_info?.name || 'Paciente';\r\n                                              const medicalRecord = p.patient_info?.medical_record || '-';\r\n                                              const dischargeISO = p?.aih_info?.discharge_date || '';\r\n                                              const dischargeLabel = parseISODateToLocal(dischargeISO);\r\n\r\n                                              //  MESMA LGICA DO RELATRIO GERAL: Processar todos os procedimentos\r\n                                              const procedures = p.procedures || [];\r\n                                              totalProcsFound += procedures.length;\r\n\r\n                                              //  Buscar o PRIMEIRO procedimento principal no-anestesista\r\n                                              let mainProcedure = null;\r\n\r\n                                              if (procedures.length > 0) {\r\n                                                for (const proc of procedures) {\r\n                                                  const regInstrument = (proc.registration_instrument || '').toString().trim();\r\n                                                  const cbo = (proc.cbo || proc.professional_cbo || '').toString().trim();\r\n\r\n                                                  //  REGRA SIMPLIFICADA: Procedimento principal = CONTM \"03\" no instrumento de registro\r\n                                                  // Exemplos que passam:\r\n                                                  // - \"03 - AIH (Proc. Principal)\" \r\n                                                  // - \"02 - BPA (Individualizado) / 03 - AIH (Proc. Principal)\" \r\n                                                  // - \"03\" \r\n                                                  // - Qualquer variao com \"03\" \r\n                                                  const isMainProcedure = regInstrument.includes('03');\r\n\r\n                                                  // Verificar se NO  anestesista\r\n                                                  const isNotAnesthetist = cbo !== '225151';\r\n\r\n                                                  //  DEBUG detalhado\r\n                                                  if (isMainProcedure) {\r\n                                                    const procCode = proc.procedure_code || '';\r\n                                                    console.log(` [FILTRO] ${procCode} | Reg: \"${regInstrument}\" | CBO: \"${cbo}\" | PassaFiltro: ${isNotAnesthetist}`);\r\n                                                  }\r\n\r\n                                                  // Se passar no filtro, pegar este procedimento e parar\r\n                                                  if (isMainProcedure && isNotAnesthetist) {\r\n                                                    totalProcsFiltered++;\r\n                                                    const procCodeRaw = proc.procedure_code || '';\r\n                                                    const procCode = procCodeRaw.replace(/[.\\-]/g, '');\r\n                                                    const procDesc = (proc.procedure_description || proc.sigtap_description || '-').toString();\r\n\r\n                                                    mainProcedure = {\r\n                                                      code: procCode,\r\n                                                      description: procDesc.substring(0, 60)\r\n                                                    };\r\n\r\n                                                    console.log(` [PROTOCOLO] Primeiro procedimento encontrado: ${procCode} - ${patientName} (Reg: ${regInstrument})`);\r\n                                                    break; // Pegar apenas o primeiro\r\n                                                  }\r\n                                                }\r\n                                              }\r\n\r\n                                              //  CORREO CRTICA: SEMPRE adicionar AIH ao relatrio\r\n                                              // Mesmo que no tenha procedimento principal vlido\r\n                                              protocolData.push([\r\n                                                idx++,\r\n                                                medicalRecord,\r\n                                                patientName,\r\n                                                mainProcedure?.code || '-',                    // Se no encontrou, mostrar \"-\"\r\n                                                mainProcedure?.description || 'Sem proc. principal', // Se no encontrou, mensagem clara\r\n                                                dischargeLabel\r\n                                              ]);\r\n\r\n                                              if (!mainProcedure) {\r\n                                                aihsWithoutMainProcedure++;\r\n                                                console.log(` [PROTOCOLO] AIH sem procedimento principal: ${patientName} - includa mesmo assim`);\r\n                                              }\r\n                                            });\r\n\r\n                                            console.log(` [PROTOCOLO] Total de procedimentos encontrados: ${totalProcsFound}`);\r\n                                            console.log(` [PROTOCOLO] Total aps filtro (contm \"03\" + CBO  225151): ${totalProcsFiltered}`);\r\n                                            console.log(` [PROTOCOLO] Total de AIHs no relatrio: ${protocolData.length}`);\r\n                                            console.log(` [PROTOCOLO] AIHs sem procedimento principal: ${aihsWithoutMainProcedure}`);\r\n\r\n                                            // Ordenar por data de alta (mais antiga primeiro)\r\n                                            protocolData.sort((a, b) => {\r\n                                              const dateA = a[5] as string; // Data Alta na posio 5\r\n                                              const dateB = b[5] as string;\r\n\r\n                                              if (!dateA && !dateB) return 0;\r\n                                              if (!dateA) return 1;\r\n                                              if (!dateB) return -1;\r\n\r\n                                              const parseDate = (dateStr: string) => {\r\n                                                const parts = dateStr.split('/');\r\n                                                if (parts.length === 3) {\r\n                                                  return new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));\r\n                                                }\r\n                                                return new Date(0);\r\n                                              };\r\n\r\n                                              const parsedDateA = parseDate(dateA);\r\n                                              const parsedDateB = parseDate(dateB);\r\n\r\n                                              return parsedDateA.getTime() - parsedDateB.getTime(); // Mais antigo primeiro\r\n                                            });\r\n\r\n                                            // Renumerar aps ordenao\r\n                                            protocolData.forEach((row, index) => {\r\n                                              row[0] = index + 1;\r\n                                            });\r\n\r\n                                            // Criar PDF com orientao paisagem para mais espao\r\n                                            const doc = new jsPDF('landscape');\r\n                                            const pageWidth = doc.internal.pageSize.getWidth();\r\n                                            // Fonte do relatrio (topo)\r\n                                            try {\r\n                                              const sourceLabel = useSihSource ? 'TABWIN' : 'GSUS';\r\n                                              doc.setFontSize(10);\r\n                                              doc.setFont('helvetica', 'bold');\r\n                                              doc.setTextColor(80, 80, 80);\r\n                                              doc.text(sourceLabel, pageWidth - 20, 10, { align: 'right' });\r\n                                            } catch { }\r\n\r\n                                            // ========================================\r\n                                            // CABEALHO PROFISSIONAL COM LOGO\r\n                                            // ========================================\r\n\r\n                                            // Inserir Logo CIS (se carregado)\r\n                                            if (logoBase64) {\r\n                                              // Dimenses profissionais: 40mm de largura (151 pixels) mantendo proporo\r\n                                              const logoWidth = 40;\r\n                                              const logoHeight = 20; // Ajuste conforme proporo da imagem\r\n                                              const logoX = 20; // Margem esquerda\r\n                                              const logoY = 8;  // Topo\r\n\r\n                                              doc.addImage(logoBase64, 'JPEG', logoX, logoY, logoWidth, logoHeight);\r\n                                            }\r\n\r\n                                            // Ttulo do Documento (centralizado)\r\n                                            doc.setFontSize(16);\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.setTextColor(0, 51, 102); // Azul institucional\r\n                                            doc.text('PROTOCOLO DE ATENDIMENTO APROVADO', pageWidth / 2, 18, { align: 'center' });\r\n\r\n                                            // Subttulo\r\n                                            doc.setFontSize(10);\r\n                                            doc.setFont('helvetica', 'normal');\r\n                                            doc.setTextColor(60, 60, 60);\r\n                                            doc.text('CIS - Centro Integrado em Sade', pageWidth / 2, 25, { align: 'center' });\r\n\r\n                                            // Linha divisria profissional\r\n                                            doc.setDrawColor(0, 51, 102);\r\n                                            doc.setLineWidth(1);\r\n                                            doc.line(20, 32, pageWidth - 20, 32);\r\n\r\n                                            // Informaes do protocolo em layout organizado\r\n                                            doc.setFontSize(9);\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.setTextColor(40, 40, 40);\r\n\r\n                                            // Coluna Esquerda\r\n                                            doc.text('Mdico Responsvel:', 20, 40);\r\n                                            doc.setFont('helvetica', 'normal');\r\n                                            doc.text(doctorName, 60, 40);\r\n\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.text('Instituio:', 20, 46);\r\n                                            doc.setFont('helvetica', 'normal');\r\n                                            doc.text(hospitalName, 60, 46);\r\n\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.text('Competncia:', 20, 52);\r\n                                            doc.setFont('helvetica', 'normal');\r\n                                            doc.setTextColor(0, 51, 153); // Azul\r\n                                            doc.text(competenciaLabel, 60, 52);\r\n\r\n                                            // Coluna Direita\r\n                                            doc.setTextColor(40, 40, 40); // Resetar cor\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.text('Data de Emisso:', pageWidth - 110, 40);\r\n                                            doc.setFont('helvetica', 'normal');\r\n                                            doc.text(formatDateFns(new Date(), 'dd/MM/yyyy HH:mm'), pageWidth - 60, 40);\r\n\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.text('Total de Atendimentos:', pageWidth - 110, 46);\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.setTextColor(0, 102, 51); // Verde\r\n                                            doc.text(protocolData.length.toString(), pageWidth - 35, 46);\r\n\r\n                                            // ========================================\r\n                                            // TABELA DE ATENDIMENTOS\r\n                                            // ========================================\r\n\r\n                                            autoTable(doc, {\r\n                                              startY: 60,\r\n                                              head: [[\r\n                                                '#',\r\n                                                'Pronturio',\r\n                                                'Nome do Paciente',\r\n                                                'Cdigo',\r\n                                                'Descrio do Procedimento',\r\n                                                'Data Alta'\r\n                                              ]],\r\n                                              body: protocolData,\r\n                                              styles: {\r\n                                                fontSize: 8,\r\n                                                cellPadding: 2,\r\n                                                lineColor: [220, 220, 220],\r\n                                                lineWidth: 0.1,\r\n                                              },\r\n                                              headStyles: {\r\n                                                fillColor: [0, 51, 102], // Azul institucional\r\n                                                textColor: [255, 255, 255],\r\n                                                fontStyle: 'bold',\r\n                                                halign: 'center',\r\n                                                fontSize: 8,\r\n                                              },\r\n                                              columnStyles: {\r\n                                                0: { cellWidth: 10, halign: 'center' },     // #\r\n                                                1: { cellWidth: 22, halign: 'center' },     // Pronturio\r\n                                                2: { cellWidth: 65, halign: 'left' },       // Nome (aumentado +5)\r\n                                                3: { cellWidth: 28, halign: 'center' },     // Cdigo\r\n                                                4: { cellWidth: 115, halign: 'left' },      // Descrio (aumentado +20)\r\n                                                5: { cellWidth: 24, halign: 'center' }      // Data Alta\r\n                                              },\r\n                                              alternateRowStyles: {\r\n                                                fillColor: [248, 248, 248]\r\n                                              },\r\n                                              margin: { left: 15, right: 15 }\r\n                                            });\r\n\r\n                                            // ========================================\r\n                                            // RODAP PROFISSIONAL\r\n                                            // ========================================\r\n\r\n                                            const pageCount = (doc as any).internal.getNumberOfPages();\r\n                                            for (let i = 1; i <= pageCount; i++) {\r\n                                              doc.setPage(i);\r\n\r\n                                              const pageHeight = doc.internal.pageSize.getHeight();\r\n\r\n                                              // Linha superior do rodap\r\n                                              doc.setDrawColor(200, 200, 200);\r\n                                              doc.setLineWidth(0.3);\r\n                                              doc.line(20, pageHeight - 18, pageWidth - 20, pageHeight - 18);\r\n\r\n                                              // Texto do rodap\r\n                                              doc.setFontSize(7);\r\n                                              doc.setTextColor(100, 100, 100);\r\n                                              doc.setFont('helvetica', 'normal');\r\n                                              doc.text(\r\n                                                'CIS - Centro Integrado em Sade | Protocolo de Atendimento Aprovado',\r\n                                                20,\r\n                                                pageHeight - 12\r\n                                              );\r\n\r\n                                              // Nmero da pgina\r\n                                              doc.setFont('helvetica', 'bold');\r\n                                              doc.text(\r\n                                                `Pgina ${i} de ${pageCount}`,\r\n                                                pageWidth - 20,\r\n                                                pageHeight - 12,\r\n                                                { align: 'right' }\r\n                                              );\r\n                                            }\r\n\r\n                                            // Salvar PDF\r\n                                            const fileName = `Protocolo_Atendimento_Aprovado_${doctorName.replace(/\\s+/g, '_')}_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.pdf`;\r\n                                            doc.save(fileName);\r\n\r\n                                            console.log(` [PROTOCOLO] Gerado: ${fileName} - ${protocolData.length} atendimentos`);\r\n\r\n                                            // Notificao informativa\r\n                                            if (aihsWithoutMainProcedure > 0) {\r\n                                              toast.success(`Protocolo gerado! ${protocolData.length} atendimento(s). ${aihsWithoutMainProcedure} sem proc. principal (includos com \"-\").`);\r\n                                            } else {\r\n                                              toast.success(`Protocolo de Atendimento Aprovado gerado! ${protocolData.length} atendimento(s) registrado(s).`);\r\n                                            }\r\n                                          } catch (err) {\r\n                                            console.error(' [PROTOCOLO] Erro ao gerar:', err);\r\n                                            toast.error('Erro ao gerar protocolo de atendimento');\r\n                                          }\r\n                                        }}\r\n                                        className=\"inline-flex items-center gap-2 bg-black hover:bg-neutral-800 text-white shadow-sm h-9 px-3 rounded-md text-sm w-auto min-w-[200px]\"\r\n                                      >\r\n                                        <FileText className=\"h-4 w-4\" />\r\n                                        Protocolo de Atendimento Aprovado\r\n                                      </Button>\r\n\r\n                                      {/*  NOVO: PROTOCOLO DE ATENDIMENTO ATUAL */}\r\n                                      <Button\r\n                                        type=\"button\"\r\n                                        onClick={async (e) => {\r\n                                          e.stopPropagation();\r\n                                          try {\r\n                                            //  Carregar logo do CIS\r\n                                            let logoBase64 = null;\r\n                                            try {\r\n                                              const response = await fetch('/CIS Sem fundo.jpg');\r\n                                              const blob = await response.blob();\r\n                                              logoBase64 = await new Promise<string>((resolve) => {\r\n                                                const reader = new FileReader();\r\n                                                reader.onloadend = () => resolve(reader.result as string);\r\n                                                reader.readAsDataURL(blob);\r\n                                              });\r\n                                            } catch (error) {\r\n                                              console.error(' [PROTOCOLO ATUAL] Erro ao carregar logo:', error);\r\n                                            }\r\n\r\n                                            const doctorName = doctor.doctor_info?.name || 'Mdico';\r\n                                            const hospitalName = doctor.hospitals?.[0]?.hospital_name || 'Hospital';\r\n                                            const competenciaLabel = selectedCompetencia && selectedCompetencia !== 'all'\r\n                                              ? formatCompetencia(selectedCompetencia)\r\n                                              : 'Todas as competncias';\r\n\r\n                                            console.log(` [PROTOCOLO ATUAL] Gerando protocolo para ${doctorName}`);\r\n                                            console.log(` [PROTOCOLO ATUAL] Competncia: ${competenciaLabel}`);\r\n\r\n                                            //  LGICA ESPECFICA: Filtrar apenas pacientes cujo ms de alta = ms da competncia\r\n                                            const protocolData: any[] = [];\r\n                                            let idx = 1;\r\n                                            let totalPatientsProcessed = 0;\r\n                                            let patientsIncluded = 0;\r\n                                            let patientsExcluded = 0;\r\n                                            let aihsWithoutMainProcedure = 0;\r\n\r\n                                            // Extrair ano e ms da competncia selecionada\r\n                                            let competenciaYear: number | null = null;\r\n                                            let competenciaMonth: number | null = null;\r\n\r\n                                            if (selectedCompetencia && selectedCompetencia !== 'all') {\r\n                                              const match = selectedCompetencia.match(/^(\\d{4})-(\\d{2})/);\r\n                                              if (match) {\r\n                                                competenciaYear = parseInt(match[1]);\r\n                                                competenciaMonth = parseInt(match[2]);\r\n                                                console.log(` [PROTOCOLO ATUAL] Filtro: Ano=${competenciaYear}, Ms=${competenciaMonth}`);\r\n                                              }\r\n                                            }\r\n\r\n                                            (doctor.patients || []).forEach((p: any) => {\r\n                                              totalPatientsProcessed++;\r\n\r\n                                              const dischargeISO = p?.aih_info?.discharge_date || '';\r\n\r\n                                              //  FILTRO CRTICO: Verificar se o ms de alta = ms da competncia\r\n                                              if (competenciaYear !== null && competenciaMonth !== null && dischargeISO) {\r\n                                                const dischargeMatch = dischargeISO.match(/^(\\d{4})-(\\d{2})-(\\d{2})/);\r\n                                                if (dischargeMatch) {\r\n                                                  const dischargeYear = parseInt(dischargeMatch[1]);\r\n                                                  const dischargeMonth = parseInt(dischargeMatch[2]);\r\n\r\n                                                  // Se ms/ano de alta DIFERENTE da competncia, EXCLUIR\r\n                                                  if (dischargeYear !== competenciaYear || dischargeMonth !== competenciaMonth) {\r\n                                                    console.log(` [PROTOCOLO ATUAL] Excluindo: ${p.patient_info?.name} - Alta: ${dischargeMonth}/${dischargeYear}, Competncia: ${competenciaMonth}/${competenciaYear}`);\r\n                                                    patientsExcluded++;\r\n                                                    return; // Pular este paciente\r\n                                                  }\r\n                                                }\r\n                                              }\r\n\r\n                                              patientsIncluded++;\r\n\r\n                                              const patientName = p.patient_info?.name || 'Paciente';\r\n                                              const medicalRecord = p.patient_info?.medical_record || '-';\r\n                                              const dischargeLabel = parseISODateToLocal(dischargeISO);\r\n\r\n                                              // Buscar procedimento principal (mesma lgica do Protocolo de Atendimento Aprovado)\r\n                                              const procedures = p.procedures || [];\r\n                                              let mainProcedure = null;\r\n\r\n                                              if (procedures.length > 0) {\r\n                                                for (const proc of procedures) {\r\n                                                  const regInstrument = (proc.registration_instrument || '').toString().trim();\r\n                                                  const cbo = (proc.cbo || proc.professional_cbo || '').toString().trim();\r\n\r\n                                                  const isMainProcedure = regInstrument.includes('03');\r\n                                                  const isNotAnesthetist = cbo !== '225151';\r\n\r\n                                                  if (isMainProcedure && isNotAnesthetist) {\r\n                                                    const procCodeRaw = proc.procedure_code || '';\r\n                                                    const procCode = procCodeRaw.replace(/[.\\-]/g, '');\r\n                                                    const procDesc = (proc.procedure_description || proc.sigtap_description || '-').toString();\r\n\r\n                                                    mainProcedure = {\r\n                                                      code: procCode,\r\n                                                      description: procDesc.substring(0, 60)\r\n                                                    };\r\n                                                    break;\r\n                                                  }\r\n                                                }\r\n                                              }\r\n\r\n                                              // Adicionar ao relatrio\r\n                                              protocolData.push([\r\n                                                idx++,\r\n                                                medicalRecord,\r\n                                                patientName,\r\n                                                mainProcedure?.code || '-',\r\n                                                mainProcedure?.description || 'Sem proc. principal',\r\n                                                dischargeLabel\r\n                                              ]);\r\n\r\n                                              if (!mainProcedure) {\r\n                                                aihsWithoutMainProcedure++;\r\n                                              }\r\n                                            });\r\n\r\n                                            console.log(` [PROTOCOLO ATUAL] Total de pacientes processados: ${totalPatientsProcessed}`);\r\n                                            console.log(` [PROTOCOLO ATUAL] Pacientes includos (alta na competncia): ${patientsIncluded}`);\r\n                                            console.log(` [PROTOCOLO ATUAL] Pacientes excludos (alta em outro ms): ${patientsExcluded}`);\r\n                                            console.log(` [PROTOCOLO ATUAL] AIHs sem procedimento principal: ${aihsWithoutMainProcedure}`);\r\n\r\n                                            // Ordenar por data de alta (mais antiga primeiro)\r\n                                            protocolData.sort((a, b) => {\r\n                                              const dateA = a[5] as string;\r\n                                              const dateB = b[5] as string;\r\n\r\n                                              if (!dateA && !dateB) return 0;\r\n                                              if (!dateA) return 1;\r\n                                              if (!dateB) return -1;\r\n\r\n                                              const parseDate = (dateStr: string) => {\r\n                                                const parts = dateStr.split('/');\r\n                                                if (parts.length === 3) {\r\n                                                  return new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));\r\n                                                }\r\n                                                return new Date(0);\r\n                                              };\r\n\r\n                                              const parsedDateA = parseDate(dateA);\r\n                                              const parsedDateB = parseDate(dateB);\r\n\r\n                                              return parsedDateA.getTime() - parsedDateB.getTime();\r\n                                            });\r\n\r\n                                            // Renumerar aps ordenao\r\n                                            protocolData.forEach((row, index) => {\r\n                                              row[0] = index + 1;\r\n                                            });\r\n\r\n                                            // Criar PDF\r\n                                            const doc = new jsPDF('landscape');\r\n                                            const pageWidth = doc.internal.pageSize.getWidth();\r\n                                            // Fonte do relatrio (topo)\r\n                                            try {\r\n                                              const sourceLabel = useSihSource ? 'TABWIN' : 'GSUS';\r\n                                              doc.setFontSize(10);\r\n                                              doc.setFont('helvetica', 'bold');\r\n                                              doc.setTextColor(80, 80, 80);\r\n                                              doc.text(sourceLabel, pageWidth - 20, 10, { align: 'right' });\r\n                                            } catch { }\r\n\r\n                                            // Logo\r\n                                            if (logoBase64) {\r\n                                              const logoWidth = 40;\r\n                                              const logoHeight = 20;\r\n                                              const logoX = 20;\r\n                                              const logoY = 8;\r\n                                              doc.addImage(logoBase64, 'JPEG', logoX, logoY, logoWidth, logoHeight);\r\n                                            }\r\n\r\n                                            // Ttulo\r\n                                            doc.setFontSize(16);\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.setTextColor(0, 51, 102);\r\n                                            doc.text('PROTOCOLO DE ATENDIMENTO ATUAL', pageWidth / 2, 18, { align: 'center' });\r\n\r\n                                            // Subttulo\r\n                                            doc.setFontSize(10);\r\n                                            doc.setFont('helvetica', 'normal');\r\n                                            doc.setTextColor(60, 60, 60);\r\n                                            doc.text('CIS - Centro Integrado em Sade', pageWidth / 2, 25, { align: 'center' });\r\n\r\n                                            // Linha divisria\r\n                                            doc.setDrawColor(0, 51, 102);\r\n                                            doc.setLineWidth(1);\r\n                                            doc.line(20, 32, pageWidth - 20, 32);\r\n\r\n                                            // Informaes do protocolo\r\n                                            doc.setFontSize(9);\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.setTextColor(40, 40, 40);\r\n\r\n                                            doc.text('Mdico Responsvel:', 20, 40);\r\n                                            doc.setFont('helvetica', 'normal');\r\n                                            doc.text(doctorName, 60, 40);\r\n\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.text('Instituio:', 20, 46);\r\n                                            doc.setFont('helvetica', 'normal');\r\n                                            doc.text(hospitalName, 60, 46);\r\n\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.text('Competncia:', 20, 52);\r\n                                            doc.setFont('helvetica', 'normal');\r\n                                            doc.setTextColor(0, 51, 153);\r\n                                            doc.text(competenciaLabel, 60, 52);\r\n\r\n                                            // Coluna Direita\r\n                                            doc.setTextColor(40, 40, 40);\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.text('Data de Emisso:', pageWidth - 110, 40);\r\n                                            doc.setFont('helvetica', 'normal');\r\n                                            doc.text(formatDateFns(new Date(), 'dd/MM/yyyy HH:mm'), pageWidth - 60, 40);\r\n\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.text('Total de Atendimentos:', pageWidth - 110, 46);\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.setTextColor(0, 102, 51);\r\n                                            doc.text(protocolData.length.toString(), pageWidth - 35, 46);\r\n\r\n                                            //  NOVO: Destacar critrio de filtro\r\n                                            doc.setTextColor(204, 0, 0); // Vermelho\r\n                                            doc.setFont('helvetica', 'bold');\r\n                                            doc.setFontSize(8);\r\n                                            doc.text('* Alta na competncia atual', pageWidth - 110, 52);\r\n\r\n                                            // Tabela\r\n                                            autoTable(doc, {\r\n                                              startY: 60,\r\n                                              head: [[\r\n                                                '#',\r\n                                                'Pronturio',\r\n                                                'Nome do Paciente',\r\n                                                'Cdigo',\r\n                                                'Descrio do Procedimento',\r\n                                                'Data Alta'\r\n                                              ]],\r\n                                              body: protocolData,\r\n                                              styles: {\r\n                                                fontSize: 8,\r\n                                                cellPadding: 2,\r\n                                                lineColor: [220, 220, 220],\r\n                                                lineWidth: 0.1,\r\n                                              },\r\n                                              headStyles: {\r\n                                                fillColor: [0, 51, 102],\r\n                                                textColor: [255, 255, 255],\r\n                                                fontStyle: 'bold',\r\n                                                halign: 'center',\r\n                                                fontSize: 8,\r\n                                              },\r\n                                              columnStyles: {\r\n                                                0: { cellWidth: 10, halign: 'center' },\r\n                                                1: { cellWidth: 22, halign: 'center' },\r\n                                                2: { cellWidth: 65, halign: 'left' },\r\n                                                3: { cellWidth: 28, halign: 'center' },\r\n                                                4: { cellWidth: 115, halign: 'left' },\r\n                                                5: { cellWidth: 24, halign: 'center' }\r\n                                              },\r\n                                              alternateRowStyles: {\r\n                                                fillColor: [248, 248, 248]\r\n                                              },\r\n                                              margin: { left: 15, right: 15 }\r\n                                            });\r\n\r\n                                            // Rodap\r\n                                            const pageCount = (doc as any).internal.getNumberOfPages();\r\n                                            for (let i = 1; i <= pageCount; i++) {\r\n                                              doc.setPage(i);\r\n                                              const pageHeight = doc.internal.pageSize.getHeight();\r\n\r\n                                              doc.setDrawColor(200, 200, 200);\r\n                                              doc.setLineWidth(0.3);\r\n                                              doc.line(20, pageHeight - 18, pageWidth - 20, pageHeight - 18);\r\n\r\n                                              doc.setFontSize(7);\r\n                                              doc.setTextColor(100, 100, 100);\r\n                                              doc.setFont('helvetica', 'normal');\r\n                                              doc.text(\r\n                                                'CIS - Centro Integrado em Sade | Protocolo de Atendimento Atual',\r\n                                                20,\r\n                                                pageHeight - 12\r\n                                              );\r\n\r\n                                              doc.setFont('helvetica', 'bold');\r\n                                              doc.text(\r\n                                                `Pgina ${i} de ${pageCount}`,\r\n                                                pageWidth - 20,\r\n                                                pageHeight - 12,\r\n                                                { align: 'right' }\r\n                                              );\r\n                                            }\r\n\r\n                                            // Salvar PDF\r\n                                            const fileName = `Protocolo_Atendimento_Atual_${doctorName.replace(/\\s+/g, '_')}_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.pdf`;\r\n                                            doc.save(fileName);\r\n\r\n                                            console.log(` [PROTOCOLO ATUAL] Gerado: ${fileName}`);\r\n\r\n                                            // Toast\r\n                                            if (patientsExcluded > 0) {\r\n                                              toast.success(`Protocolo Atual gerado! ${protocolData.length} atendimento(s) com alta na competncia. ${patientsExcluded} excludo(s) (alta em outro ms).`);\r\n                                            } else {\r\n                                              toast.success(`Protocolo de Atendimento Atual gerado! ${protocolData.length} atendimento(s) registrado(s).`);\r\n                                            }\r\n                                          } catch (err) {\r\n                                            console.error(' [PROTOCOLO ATUAL] Erro ao gerar:', err);\r\n                                            toast.error('Erro ao gerar protocolo de atendimento atual');\r\n                                          }\r\n                                        }}\r\n                                        className=\"inline-flex items-center gap-2 bg-black hover:bg-neutral-800 text-white shadow-sm h-9 px-3 rounded-md text-sm w-auto min-w-[200px]\"\r\n                                      >\r\n                                        <FileText className=\"h-4 w-4\" />\r\n                                        Protocolo Atendimento Atual\r\n                                      </Button>\r\n                                    </>)}\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            </CollapsibleTrigger>\r\n\r\n                            {/*  LISTA DE PACIENTES - DESIGN SOFISTICADO */}\r\n                            <CollapsibleContent>\r\n                              <div className=\"px-6 pb-6\">\r\n                                <div className=\"border-t border-slate-200/60 pt-6\">\r\n                                  <div className=\"flex items-center justify-between mb-5\">\r\n                                    <h4 className=\"text-base font-semibold text-slate-800 flex items-center gap-3\">\r\n                                      <div className=\"w-7 h-7 bg-[#0b1736] rounded-xl flex items-center justify-center\">\r\n                                        <User className=\"h-4 w-4 text-white\" />\r\n                                      </div>\r\n                                      Pacientes Atendidos ({(() => {\r\n                                        const doctorKey = doctor.doctor_info.cns;\r\n                                        const nameTerm = (localPatientSearchTerm.get(doctorKey) || '').toLowerCase().trim();\r\n                                        const procTermRaw = (procedureSearchTerm.get(doctorKey) || '').toLowerCase().trim();\r\n                                        const procTerm = procTermRaw.replace(/[\\.\\s]/g, '');\r\n                                        const filteredCount = doctor.patients.filter(patient => {\r\n                                          const matchesName = !nameTerm || (patient.patient_info.name || '').toLowerCase().includes(nameTerm);\r\n                                          const matchesProc = !procTermRaw || (patient.procedures || []).some(proc => {\r\n                                            const codeNorm = (proc.procedure_code || '').toLowerCase().replace(/[\\.\\s]/g, '');\r\n                                            const desc = (proc.procedure_description || '').toLowerCase();\r\n                                            return codeNorm.includes(procTerm) || desc.includes(procTermRaw);\r\n                                          });\r\n                                          //  SIMPLIFICADO: Sem filtros de data (apenas competncia)\r\n                                          return matchesName && matchesProc;\r\n                                        }).length;\r\n                                        return nameTerm || procTermRaw ? `${filteredCount} de ${doctor.patients.length}` : filteredCount;\r\n                                      })()})\r\n                                    </h4>\r\n\r\n                                    <div className=\"flex items-center gap-3\">\r\n                                      {/* Campo de busca */}\r\n                                      <div className=\"relative\">\r\n                                        <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n                                        <Input\r\n                                          placeholder=\"Buscar paciente...\"\r\n                                          value={localPatientSearchTerm.get(doctor.doctor_info.cns) || ''}\r\n                                          onChange={(e) => {\r\n                                            const newSearchTerms = new Map(localPatientSearchTerm);\r\n                                            newSearchTerms.set(doctor.doctor_info.cns, e.target.value);\r\n                                            setLocalPatientSearchTerm(newSearchTerms);\r\n                                            // Reset para primeira pgina ao buscar\r\n                                            const newPages = new Map(currentPatientPage);\r\n                                            newPages.set(doctor.doctor_info.cns, 1);\r\n                                            setCurrentPatientPage(newPages);\r\n                                          }}\r\n                                          className=\"pl-10 w-64\"\r\n                                        />\r\n                                      </div>\r\n                                      {/* Filtro de procedimento (cdigo ou descrio) */}\r\n                                      <div className=\"relative\">\r\n                                        <FileText className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\r\n                                        <Input\r\n                                          placeholder=\"Buscar procedimento (cdigo ou descrio)...\"\r\n                                          value={procedureSearchTerm.get(doctor.doctor_info.cns) || ''}\r\n                                          onChange={(e) => {\r\n                                            const newTerms = new Map(procedureSearchTerm);\r\n                                            newTerms.set(doctor.doctor_info.cns, e.target.value);\r\n                                            setProcedureSearchTerm(newTerms);\r\n                                            // Reset para primeira pgina ao buscar\r\n                                            const newPages = new Map(currentPatientPage);\r\n                                            newPages.set(doctor.doctor_info.cns, 1);\r\n                                            setCurrentPatientPage(newPages);\r\n                                          }}\r\n                                          className=\"pl-10 w-96\"\r\n                                        />\r\n                                      </div>\r\n                                      {/* Boto global movido para o cabealho superior */}\r\n\r\n                                      {/* Paginao do header removida para dar espao aos filtros */}\r\n                                    </div>\r\n                                  </div>\r\n\r\n                                  <div className=\"space-y-4\">\r\n                                    {(() => {\r\n                                      const doctorKey = doctor.doctor_info.cns;\r\n                                      const nameTerm = (localPatientSearchTerm.get(doctorKey) || '').toLowerCase().trim();\r\n                                      const procTermRaw = (procedureSearchTerm.get(doctorKey) || '').toLowerCase().trim();\r\n                                      const procTerm = procTermRaw.replace(/[\\.\\s]/g, '');\r\n                                      const filteredPatients = doctor.patients.filter(patient => {\r\n                                        const matchesName = !nameTerm || (patient.patient_info.name || '').toLowerCase().includes(nameTerm);\r\n                                        const matchesProc = !procTermRaw || (patient.procedures || []).some(proc => {\r\n                                          const codeNorm = (proc.procedure_code || '').toLowerCase().replace(/[\\.\\s]/g, '');\r\n                                          const desc = (proc.procedure_description || '').toLowerCase();\r\n                                          return codeNorm.includes(procTerm) || desc.includes(procTermRaw);\r\n                                        });\r\n                                        //  SIMPLIFICADO: Sem filtros de data (apenas competncia)\r\n                                        return matchesName && matchesProc;\r\n                                      });\r\n                                      // Ordenar por data mais recente primeiro (Alta SUS; fallback para Admisso)\r\n                                      const sortedPatients = [...filteredPatients].sort((a, b) => {\r\n                                        const aDate = new Date(a.aih_info.discharge_date || a.aih_info.admission_date);\r\n                                        const bDate = new Date(b.aih_info.discharge_date || b.aih_info.admission_date);\r\n                                        return bDate.getTime() - aDate.getTime();\r\n                                      });\r\n                                      const currentPage = currentPatientPage.get(doctorKey) || 1;\r\n                                      const startIndex = (currentPage - 1) * PATIENTS_PER_PAGE;\r\n                                      const endIndex = startIndex + PATIENTS_PER_PAGE;\r\n                                      const paginatedPatients = sortedPatients.slice(startIndex, endIndex);\r\n                                      const totalPages = Math.ceil(filteredPatients.length / PATIENTS_PER_PAGE);\r\n\r\n                                      return (\r\n                                        <>\r\n                                          {paginatedPatients.length === 0 && searchTerm ? (\r\n                                            <div className=\"text-center py-8 text-slate-500\">\r\n                                              <Search className=\"h-8 w-8 mx-auto mb-3 text-slate-300\" />\r\n                                              <div className=\"text-sm\">Nenhum paciente encontrado para \"{searchTerm}\"</div>\r\n                                            </div>\r\n                                          ) : paginatedPatients.length === 0 ? (\r\n                                            <div className=\"text-center py-8 text-slate-500\">\r\n                                              <User className=\"h-8 w-8 mx-auto mb-3 text-slate-300\" />\r\n                                              <div className=\"text-sm\">Nenhum paciente encontrado</div>\r\n                                            </div>\r\n                                          ) : null}\r\n\r\n                                          {/*  PR-CALCULAR VALORES DOS PACIENTES PARA ESTABILIDADE */}\r\n                                          {(() => {\r\n                                            //  Calcular valores para evitar reclculo durante expanso\r\n                                            const hospitalId = doctor.hospitals?.[0]?.hospital_id;\r\n\r\n                                            const enrichedPatients = paginatedPatients.map((patient, idx) => {\r\n                                              //  CORREO: Chave estvel e nica por AIH/paciente\r\n                                              const keySuffix = (\r\n                                                patient.aih_id ||\r\n                                                (patient as any)?.aih_info?.aih_number ||\r\n                                                `${patient.patient_info.cns || 'NO_CNS'}-${(patient as any)?.aih_info?.admission_date || 'NO_DATE'}-${idx}`\r\n                                              );\r\n                                              const patientKey = `${doctor.doctor_info.cns}-${keySuffix}`;\r\n\r\n                                              // Calcular AIH Seca (estvel)\r\n                                              const baseAih = typeof (patient as any).total_value_reais === 'number'\r\n                                                ? (patient as any).total_value_reais\r\n                                                : sumProceduresBaseReais(patient.procedures as any);\r\n\r\n                                              // Calcular Incremento (estvel)\r\n                                              const careCharacter = (patient as any)?.aih_info?.care_character;\r\n                                              const doctorCovered = isDoctorCoveredForOperaParana(\r\n                                                doctor.doctor_info.name,\r\n                                                hospitalId\r\n                                              );\r\n                                              const increment = doctorCovered\r\n                                                ? computeIncrementForProcedures(\r\n                                                  patient.procedures as any,\r\n                                                  careCharacter,\r\n                                                  doctor.doctor_info.name,\r\n                                                  hospitalId\r\n                                                )\r\n                                                : 0;\r\n\r\n                                              // Calcular Repasse Mdico (estvel)\r\n                                              const fixedCalc = calculateFixedPayment(doctor.doctor_info.name, hospitalId);\r\n                                              const hasIndividualRules = hasIndividualPaymentRules(\r\n                                                doctor.doctor_info.name,\r\n                                                hospitalId\r\n                                              );\r\n                                              const isMonthlyFixed = isFixedMonthlyPayment(\r\n                                                doctor.doctor_info.name,\r\n                                                hospitalId,\r\n                                                ALL_HOSPITAL_RULES\r\n                                              );\r\n\r\n                                              let totalPayment = 0;\r\n                                              let showRepasseCard = false;\r\n\r\n                                              if (fixedCalc.hasFixedRule && !hasIndividualRules) {\r\n                                                showRepasseCard = false;\r\n                                              } else if (isMonthlyFixed) {\r\n                                                showRepasseCard = false;\r\n                                              } else {\r\n                                                //  CORREO: Usar MESMO filtro do relatrio e stats (04.xxx + anestesista)\r\n                                                //  CORREO 2: Ordenar procedimentos por sequence e valor (igual ao relatrio)\r\n                                                const proceduresWithPayment = patient.procedures\r\n                                                  .filter((proc: any) =>\r\n                                                    isMedicalProcedure(proc.procedure_code) &&\r\n                                                    shouldCalculateAnesthetistProcedure(proc.cbo, proc.procedure_code)\r\n                                                  )\r\n                                                  .sort((a: any, b: any) => {\r\n                                                    // Ordenar por sequence primeiro, depois por valor (decrescente)\r\n                                                    const sa = typeof a.sequence === 'number' ? a.sequence : 9999;\r\n                                                    const sb = typeof b.sequence === 'number' ? b.sequence : 9999;\r\n                                                    if (sa !== sb) return sa - sb;\r\n                                                    const va = typeof a.value_reais === 'number' ? a.value_reais : 0;\r\n                                                    const vb = typeof b.value_reais === 'number' ? b.value_reais : 0;\r\n                                                    return vb - va;\r\n                                                  })\r\n                                                  .map((proc: any) => ({\r\n                                                    procedure_code: proc.procedure_code,\r\n                                                    procedure_description: proc.procedure_description,\r\n                                                    value_reais: proc.value_reais || 0,\r\n                                                    cbo: proc.cbo,\r\n                                                  }));\r\n\r\n                                                //  CORREO: Usar MESMA lgica do relatrio para isGenSurg\r\n                                                const isGenSurg2 = /cirurg/i.test(doctor.doctor_info.name || '') || (/cirurg/i.test(doctor.doctor_info.specialty || '') && /geral/i.test(doctor.doctor_info.specialty || ''))\r\n                                                const useHon2 = shouldUseHonForHospital(doctor.doctor_info.name, hospitalId, isGenSurg2)\r\n                                                const paymentResult = useHon2\r\n                                                  ? calculateHonPayments(proceduresWithPayment)\r\n                                                  : calculateDoctorPayment(\r\n                                                    doctor.doctor_info.name,\r\n                                                    proceduresWithPayment,\r\n                                                    hospitalId\r\n                                                  );\r\n\r\n                                                totalPayment = paymentResult.totalPayment || 0;\r\n                                                showRepasseCard = totalPayment > 0;\r\n                                              }\r\n\r\n                                              return {\r\n                                                ...patient,\r\n                                                _enriched: {\r\n                                                  patientKey,\r\n                                                  baseAih,\r\n                                                  increment,\r\n                                                  hasIncrement: increment > 0,\r\n                                                  withIncrement: baseAih + increment,\r\n                                                  totalPayment,\r\n                                                  showRepasseCard\r\n                                                }\r\n                                              };\r\n                                            });\r\n\r\n                                            return (\r\n                                              <>\r\n                                                {enrichedPatients.map((patient) => {\r\n                                                  const patientKey = patient._enriched.patientKey;\r\n                                                  const isPatientExpanded = expandedPatients.has(patientKey);\r\n\r\n                                                  return (\r\n                                                    <div key={patientKey} className=\"p-3 rounded-lg bg-white border border-slate-200 hover:bg-slate-50 transition-colors\">\r\n                                                      <Collapsible open={isPatientExpanded}>\r\n                                                        <CollapsibleTrigger asChild>\r\n                                                          {/*  CARD DO PACIENTE - DESIGN LIMPO E OBJETIVO */}\r\n                                                          <div\r\n                                                            className=\"w-full cursor-pointer p-4 rounded-lg hover:bg-slate-50 border border-slate-200 transition-colors bg-white\"\r\n                                                            onClick={() => togglePatientExpansion(patientKey)}\r\n                                                          >\r\n                                                            {/* cone de expanso */}\r\n                                                            <div className=\"flex items-center gap-2 mb-2\">\r\n                                                              {isPatientExpanded ? (\r\n                                                                <ChevronDown className=\"h-4 w-4 text-slate-500 transition-transform duration-200\" />\r\n                                                              ) : (\r\n                                                                <ChevronRight className=\"h-4 w-4 text-slate-500 transition-transform duration-200\" />\r\n                                                              )}\r\n                                                              <span className=\"text-xs text-slate-500 font-medium\">\r\n                                                                {isPatientExpanded ? 'Clique para recolher' : 'Clique para expandir procedimentos'}\r\n                                                              </span>\r\n                                                            </div>\r\n\r\n                                                            {/* NOME DO PACIENTE - DESTAQUE */}\r\n                                                            <div className=\"mb-3 pb-3 border-b border-gray-100\">\r\n                                                              <div className=\"flex items-center justify-between\">\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                  <div className=\"flex items-center justify-center w-8 h-8 bg-[#0b1736] rounded-full\">\r\n                                                                    <User className=\"h-4 w-4 text-white\" />\r\n                                                                  </div>\r\n                                                                  <div className=\"text-base font-bold text-gray-900\">\r\n                                                                    {(/procedimento/i.test(patient.patient_info.name) || /\\b\\d{2}\\.\\d{2}\\.\\d{2}\\.\\d{3}-\\d\\b/.test(patient.patient_info.name)) ? 'Nome no disponvel' : patient.patient_info.name}\r\n                                                                  </div>\r\n                                                                </div>\r\n                                                                <div className=\"flex items-center gap-2\">\r\n                                                                  {(() => {\r\n                                                                    const selComp = selectedCompetencia && selectedCompetencia !== 'all' ? selectedCompetencia : String((patient.aih_info as any).competencia || '')\r\n                                                                    const sm = selComp.match(/^(\\d{4})-(\\d{2})/) || selComp.match(/^([0-9]{4})([0-9]{2})$/)\r\n                                                                    const selY = sm ? parseInt(sm[1], 10) : undefined\r\n                                                                    const selM = sm ? parseInt(sm[2], 10) : undefined\r\n                                                                    const disStr = String((patient.aih_info as any).discharge_date || '')\r\n                                                                    const dm = disStr.match(/^(\\d{4})-(\\d{2})/)\r\n                                                                    const disY = dm ? parseInt(dm[1], 10) : undefined\r\n                                                                    const disM = dm ? parseInt(dm[2], 10) : undefined\r\n                                                                    const mismatch = selY && selM && disY && disM && (selY !== disY || selM !== disM)\r\n                                                                    const disLabel = disStr ? (() => { const m = disStr.match(/^(\\d{4})-(\\d{2})/); return m ? `${m[2]}/${m[1]}` : '-' })() : '-'\r\n                                                                    const compLabel = formatCompetencia(selComp)\r\n                                                                    const cls = mismatch ? 'bg-red-50 text-red-700 border-red-200' : 'bg-slate-100 text-slate-700 border-slate-200'\r\n                                                                    return (\r\n                                                                      <Badge variant=\"outline\" className={`text-[10px] font-semibold ${cls}`}>\r\n                                                                        {disLabel} | {compLabel}\r\n                                                                      </Badge>\r\n                                                                    )\r\n                                                                  })()}\r\n                                                                  <Badge variant=\"outline\" className=\"bg-blue-50 text-blue-700 border-blue-200 text-[10px] font-semibold\">\r\n                                                                    {patient.procedures.length} PROC\r\n                                                                  </Badge>\r\n                                                                  {patient.aih_info.care_character && (() => {\r\n                                                                    const raw = String(patient.aih_info.care_character || '').toLowerCase().trim();\r\n                                                                    return (\r\n                                                                      <Badge variant=\"outline\" className={`text-[10px] font-semibold ${raw === '1' || raw.includes('eletivo')\r\n                                                                        ? 'bg-emerald-50 border-emerald-200 text-emerald-700'\r\n                                                                        : 'bg-amber-50 border-amber-200 text-amber-700'\r\n                                                                        }`}>\r\n                                                                        {CareCharacterUtils.formatForDisplay(\r\n                                                                          typeof patient.aih_info.care_character === 'string'\r\n                                                                            ? patient.aih_info.care_character.trim()\r\n                                                                            : String(patient.aih_info.care_character),\r\n                                                                          false\r\n                                                                        )}\r\n                                                                      </Badge>\r\n                                                                    );\r\n                                                                  })()}\r\n                                                                  {patient.common_name && (\r\n                                                                    <Badge variant=\"outline\" className=\"bg-amber-50 text-amber-700 border-amber-200 text-[10px] px-2 py-0.5\">\r\n                                                                      {patient.common_name}\r\n                                                                    </Badge>\r\n                                                                  )}\r\n                                                                </div>\r\n                                                              </div>\r\n                                                            </div>\r\n\r\n                                                            {/* GRID PROFISSIONAL: Agrupado por contexto */}\r\n                                                            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-3\">\r\n                                                              {/* Identificao */}\r\n                                                              <div className=\"space-y-2\">\r\n                                                                <div className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wide underline decoration-slate-300 underline-offset-2\">Identificao</div>\r\n                                                                <div className=\"flex items-baseline gap-2\">\r\n                                                                  <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">N AIH:</span>\r\n                                                                  <span className=\"text-xs font-mono font-medium text-gray-900\">{patient.aih_info.aih_number || '-'}</span>\r\n                                                                </div>\r\n                                                                {useSihSource && (\r\n                                                                  <div className=\"flex items-baseline gap-2\">\r\n                                                                    <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Competncia:</span>\r\n                                                                    <span className=\"text-xs font-semibold text-blue-700\">\r\n                                                                      {(() => {\r\n                                                                        const comp = (patient as any)?.aih_info?.competencia;\r\n                                                                        if (!comp) return '-';\r\n                                                                        const m = String(comp).match(/^(\\d{4})-(\\d{2})/);\r\n                                                                        if (m) return `${m[2]}/${m[1]}`;\r\n                                                                        return comp;\r\n                                                                      })()}\r\n                                                                    </span>\r\n                                                                  </div>\r\n                                                                )}\r\n                                                                {patient.patient_info.medical_record && (\r\n                                                                  <div className=\"flex items-baseline gap-2\">\r\n                                                                    <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Pronturio:</span>\r\n                                                                    <span className=\"text-xs font-medium text-gray-900\">{patient.patient_info.medical_record}</span>\r\n                                                                  </div>\r\n                                                                )}\r\n                                                              </div>\r\n\r\n                                                              {/* Internao */}\r\n                                                              <div className=\"space-y-2\">\r\n                                                                <div className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wide underline decoration-slate-300 underline-offset-2\">Internao</div>\r\n                                                                <div className=\"flex items-baseline gap-2\">\r\n                                                                  <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Admisso:</span>\r\n                                                                  <span className=\"text-xs font-medium text-gray-900\">\r\n                                                                    {patient.aih_info.admission_date ? (() => {\r\n                                                                      const d = String(patient.aih_info.admission_date);\r\n                                                                      const match = d.match(/^(\\d{4})-(\\d{2})-(\\d{2})/);\r\n                                                                      return match ? `${match[3]}/${match[2]}/${match[1]}` : d;\r\n                                                                    })() : '-'}\r\n                                                                  </span>\r\n                                                                </div>\r\n                                                                <div className=\"flex items-baseline gap-2\">\r\n                                                                  <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Alta:</span>\r\n                                                                  <span className=\"text-xs font-medium text-gray-900\">\r\n                                                                    {patient.aih_info.discharge_date ? (() => {\r\n                                                                      const d = String(patient.aih_info.discharge_date);\r\n                                                                      const match = d.match(/^(\\d{4})-(\\d{2})-(\\d{2})/);\r\n                                                                      return match ? `${match[3]}/${match[2]}/${match[1]}` : d;\r\n                                                                    })() : '-'}\r\n                                                                  </span>\r\n                                                                </div>\r\n                                                                <div className=\"flex items-baseline gap-2\">\r\n                                                                  <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Carter:</span>\r\n                                                                  <span className={`inline-flex items-center px-2 py-0.5 rounded-md text-[10px] border ${careBadgeClass((patient.aih_info as any).care_character)}`}>\r\n                                                                    {formatCareCharacterLabel((patient.aih_info as any).care_character)}\r\n                                                                  </span>\r\n                                                                </div>\r\n                                                                {(patient.aih_info as any).dias_perm !== undefined && (\r\n                                                                  <div className=\"flex items-baseline gap-2\">\r\n                                                                    <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Permanncia:</span>\r\n                                                                    <span className=\"text-xs font-medium text-gray-900\">{String((patient.aih_info as any).dias_perm)} dias</span>\r\n                                                                  </div>\r\n                                                                )}\r\n                                                              </div>\r\n\r\n                                                              {/* Clnico/Demografia */}\r\n                                                              <div className=\"space-y-2\">\r\n                                                                <div className=\"text-[10px] font-bold text-slate-500 uppercase tracking-wide underline decoration-slate-300 underline-offset-2\">Clnico</div>\r\n                                                                {(patient.aih_info as any).main_cid && (\r\n                                                                  <div className=\"flex items-baseline gap-2\">\r\n                                                                    <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">CID Principal:</span>\r\n                                                                    <span className=\"text-xs font-medium text-gray-900\">{(patient.aih_info as any).main_cid}</span>\r\n                                                                  </div>\r\n                                                                )}\r\n                                                                {(patient.aih_info as any).specialty && (\r\n                                                                  <div className=\"flex items-baseline gap-2\">\r\n                                                                    <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Especialidade:</span>\r\n                                                                    <span className=\"inline-flex items-center px-2 py-0.5 rounded-md text-[10px] bg-violet-50 text-violet-700 border border-violet-200\">\r\n                                                                      {formatEspecialidade((patient.aih_info as any).specialty)}\r\n                                                                    </span>\r\n                                                                  </div>\r\n                                                                )}\r\n                                                                <div className=\"flex items-baseline gap-2\">\r\n                                                                  <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Nascimento:</span>\r\n                                                                  <span className=\"text-xs font-medium text-gray-900\">\r\n                                                                    {patient.patient_info.birth_date ? (() => {\r\n                                                                      const d = String(patient.patient_info.birth_date);\r\n                                                                      const match = d.match(/^(\\d{4})-(\\d{2})-(\\d{2})/);\r\n                                                                      return match ? `${match[3]}/${match[2]}/${match[1]}` : d;\r\n                                                                    })() : '-'}\r\n                                                                  </span>\r\n                                                                </div>\r\n                                                                {typeof patient.patient_info.age === 'number' && (\r\n                                                                  <div className=\"flex items-baseline gap-2\">\r\n                                                                    <span className=\"text-[10px] font-semibold text-gray-500 uppercase tracking-wide\">Idade:</span>\r\n                                                                    <span className=\"text-xs font-medium text-gray-900\">{patient.patient_info.age}</span>\r\n                                                                  </div>\r\n                                                                )}\r\n                                                              </div>\r\n                                                            </div>\r\n\r\n                                                            {/* SEO DE VALORES - DESTAQUE ESPECIAL */}\r\n                                                            {/*  USAR VALORES PR-CALCULADOS (MEMOIZADOS) */}\r\n                                                            <div className=\"mt-3 pt-3 border-t-2 border-gray-200 space-y-2\">\r\n                                                              {/* AIH SECA - CAMPO MAIS IMPORTANTE */}\r\n                                                              <div className=\"bg-white rounded-lg p-3 border-2 border-emerald-400\">\r\n                                                                <div className=\"flex items-center justify-between\">\r\n                                                                  <div className=\"flex items-center gap-2\">\r\n                                                                    <DollarSign className=\"h-4 w-4 text-black\" />\r\n                                                                    <span className=\"text-xs font-bold text-black uppercase tracking-wide\">AIH Seca</span>\r\n                                                                  </div>\r\n                                                                  <span className=\"text-lg font-black text-black\">\r\n                                                                    {formatCurrency(patient.total_value_reais)}\r\n                                                                  </span>\r\n                                                                </div>\r\n                                                              </div>\r\n\r\n                                                              {/* INCREMENTO - SE HOUVER */}\r\n                                                              {patient._enriched.hasIncrement && (\r\n                                                                <>\r\n                                                                  <div className=\"bg-white rounded-lg p-3 border-2 border-blue-400\">\r\n                                                                    <div className=\"flex items-center justify-between\">\r\n                                                                      <div className=\"flex items-center gap-2\">\r\n                                                                        <span className=\"text-lg\"></span>\r\n                                                                        <span className=\"text-xs font-bold text-black uppercase tracking-wide\">Incremento</span>\r\n                                                                      </div>\r\n                                                                      <span className=\"text-lg font-black text-black\">\r\n                                                                        {formatCurrency(patient._enriched.increment)}\r\n                                                                      </span>\r\n                                                                    </div>\r\n                                                                  </div>\r\n\r\n                                                                  {/* AIH C/ INCREMENTO - TOTAL FINAL */}\r\n                                                                  <div className=\"bg-white rounded-lg p-3 border-2 border-violet-400\">\r\n                                                                    <div className=\"flex items-center justify-between\">\r\n                                                                      <div className=\"flex items-center gap-2\">\r\n                                                                        <CheckCircle className=\"h-4 w-4 text-black\" />\r\n                                                                        <span className=\"text-xs font-bold text-black uppercase tracking-wide\">AIH c/ Incremento</span>\r\n                                                                      </div>\r\n                                                                      <span className=\"text-lg font-black text-black\">\r\n                                                                        {formatCurrency(patient._enriched.withIncrement)}\r\n                                                                      </span>\r\n                                                                    </div>\r\n                                                                  </div>\r\n                                                                </>\r\n                                                              )}\r\n\r\n                                                              {/* PROCEDIMENTOS MDICOS (04) - OCULTO CONFORME SOLICITAO */}\r\n                                                              {/* {medicalCount > 0 && (\r\n                                                  <div className=\"bg-gradient-to-r from-orange-50 to-amber-50 rounded-lg p-2 border border-orange-200\">\r\n                                                    <div className=\"flex items-center justify-between\">\r\n                                                      <div className=\"flex items-center gap-2\">\r\n                                                        <div className=\"flex items-center justify-center w-5 h-5 bg-orange-100 rounded-full\">\r\n                                                          <span className=\"text-[10px] font-bold text-orange-700\">04</span>\r\n                                                        </div>\r\n                                                        <span className=\"text-[10px] font-semibold text-orange-800 uppercase\">Proc. Mdicos ({medicalCount})</span>\r\n                                                      </div>\r\n                                                      <span className=\"text-sm font-bold text-orange-700\">{formatCurrency(medicalValue)}</span>\r\n                                                    </div>\r\n                                                  </div>\r\n                                                )} */}\r\n\r\n                                                              {/*  VALOR DE REPASSE PARA O MDICO */}\r\n                                                              {/*  USAR VALOR PR-CALCULADO (MEMOIZADO) */}\r\n                                                              {useSihSource && remoteConfigured ? (\r\n                                                                <div className=\"bg-white rounded-lg p-3 border-2 border-blue-400\">\r\n                                                                  <div className=\"flex items-center justify-between\">\r\n                                                                    <div className=\"flex items-center gap-2\">\r\n                                                                      <Stethoscope className=\"h-4 w-4 text-black\" />\r\n                                                                      <span className=\"text-xs font-bold text-black uppercase tracking-wide\">Valor Calculado</span>\r\n                                                                    </div>\r\n                                                                    <span className=\"text-lg font-black text-black\">\r\n                                                                      {formatCurrency(patient._enriched.totalPayment)}\r\n                                                                    </span>\r\n                                                                  </div>\r\n                                                                </div>\r\n                                                              ) : (\r\n                                                                patient._enriched.showRepasseCard && (\r\n                                                                  <div className=\"bg-white rounded-lg p-3 border-2 border-teal-400\">\r\n                                                                    <div className=\"flex items-center justify-between\">\r\n                                                                      <div className=\"flex items-center gap-2\">\r\n                                                                        <Stethoscope className=\"h-4 w-4 text-black\" />\r\n                                                                        <span className=\"text-xs font-bold text-black uppercase tracking-wide\">Repasse Mdico</span>\r\n                                                                      </div>\r\n                                                                      <span className=\"text-lg font-black text-black\">\r\n                                                                        {formatCurrency(patient._enriched.totalPayment)}\r\n                                                                      </span>\r\n                                                                    </div>\r\n                                                                  </div>\r\n                                                                )\r\n                                                              )}\r\n                                                            </div>\r\n                                                          </div>\r\n                                                        </CollapsibleTrigger>\r\n\r\n                                                        {/*  LISTA DE PROCEDIMENTOS */}\r\n                                                        <CollapsibleContent>\r\n                                                          <div className=\"mt-4 space-y-3\">\r\n                                                            <div className=\"flex items-center justify-between\">\r\n                                                              <h5 className=\"font-medium text-slate-700 flex items-center gap-2 text-sm\">\r\n                                                                <FileText className=\"h-4 w-4\" />\r\n                                                                Procedimentos Realizados\r\n                                                              </h5>\r\n                                                              <Badge variant=\"secondary\" className=\"bg-slate-100 text-slate-700 text-xs border-slate-200\">\r\n                                                                {patient.procedures.length} procedimento(s)\r\n                                                              </Badge>\r\n                                                            </div>\r\n\r\n                                                            {patient.procedures.length === 0 ? (\r\n                                                              <div className=\"text-center py-8 text-slate-500\">\r\n                                                                <Activity className=\"h-8 w-8 mx-auto mb-3 text-slate-300\" />\r\n                                                                <div className=\"text-sm\">Nenhum procedimento encontrado</div>\r\n                                                              </div>\r\n                                                            ) : (\r\n                                                              <div className=\"space-y-3\">\r\n                                                                {patient.procedures\r\n                                                                  .sort((a, b) => {\r\n                                                                    // 1) Ordenar primeiro pela sequncia (seq. 1, 2, 3...)\r\n                                                                    const seqA = Number((a as any)?.sequence ?? (a as any)?.procedure_sequence ?? 0);\r\n                                                                    const seqB = Number((b as any)?.sequence ?? (b as any)?.procedure_sequence ?? 0);\r\n                                                                    const hasSeqA = Number.isFinite(seqA) && seqA > 0;\r\n                                                                    const hasSeqB = Number.isFinite(seqB) && seqB > 0;\r\n                                                                    if (hasSeqA && hasSeqB && seqA !== seqB) {\r\n                                                                      return seqA - seqB; // ascendente por seq\r\n                                                                    }\r\n                                                                    if (hasSeqA && !hasSeqB) return -1;\r\n                                                                    if (!hasSeqA && hasSeqB) return 1;\r\n                                                                    // 2) Fallback: priorizar 04.xxx e depois por data desc\r\n                                                                    const a04 = ((a?.procedure_code || '').toString().trim().startsWith('04')) ? 1 : 0;\r\n                                                                    const b04 = ((b?.procedure_code || '').toString().trim().startsWith('04')) ? 1 : 0;\r\n                                                                    if (a04 !== b04) return b04 - a04; // 04 primeiro\r\n                                                                    const ad = new Date(a.procedure_date).getTime();\r\n                                                                    const bd = new Date(b.procedure_date).getTime();\r\n                                                                    return bd - ad; // depois por data desc\r\n                                                                  })\r\n                                                                  .map((procedure, procIndex) => {\r\n                                                                    const careCharRaw = (patient as any)?.aih_info?.care_character;\r\n                                                                    const careCharStr = typeof careCharRaw === 'string' ? careCharRaw.trim() : String(careCharRaw ?? '');\r\n                                                                    const isMedical04 = !!(procedure?.procedure_code || '').toString().trim().startsWith('04');\r\n                                                                    const isPrincipal = Number((procedure as any)?.sequence ?? (procedure as any)?.procedure_sequence ?? 0) === 1;\r\n                                                                    const effectiveCareChar = careCharStr;\r\n                                                                    const aihHasExcluded = hasAnyExcludedCodeInProcedures(patient.procedures as any);\r\n                                                                    const operaEligible = !aihHasExcluded && isOperaEligibleConfig(procedure.procedure_code, effectiveCareChar);\r\n                                                                    const diagReason = (() => {\r\n                                                                      if (!isMedical04) return '';\r\n                                                                      const cc = (effectiveCareChar ?? '').toString();\r\n                                                                      const isElective = cc === '1' || cc.toLowerCase?.() === 'eletivo';\r\n                                                                      if (!isElective) return 'Sem +150%: carter  Eletivo';\r\n                                                                      // Normalizar aqui igual ao helper sem reimportar o Set\r\n                                                                      const normalized = (procedure.procedure_code || '').toString().replace(/[\\.\\s-]/g, '');\r\n                                                                      // Duplicamos a verificao via helper: se no elegvel, e  mdico 04 e eletivo, resta excluso\r\n                                                                      if (!operaEligible) return 'Sem +150%: cdigo em lista de excluses';\r\n                                                                      return '';\r\n                                                                    })();\r\n                                                                    return (\r\n                                                                      <div key={procedure.procedure_id || procIndex} className={`bg-white border rounded-lg overflow-hidden ${isMedical04 && isPrincipal ? 'border-emerald-300 shadow-sm' : 'border-slate-200'\r\n                                                                        } ${operaEligible && isPrincipal ? 'ring-2 ring-emerald-200' : ''}`}>\r\n                                                                        {/* CABEALHO DO PROCEDIMENTO */}\r\n                                                                        <div className={`px-4 py-2.5 border-b flex items-center justify-between ${isMedical04 && isPrincipal ? 'bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-200' : 'bg-slate-50 border-slate-200'\r\n                                                                          }`}>\r\n                                                                          <div className=\"flex items-center gap-2 flex-wrap\">\r\n                                                                            <span className={`text-xs font-bold uppercase tracking-wide px-2 py-1 rounded ${isMedical04 && isPrincipal ? 'bg-emerald-600 text-white' : 'bg-slate-600 text-white'\r\n                                                                              }`}>\r\n                                                                              {procedure.procedure_code}\r\n                                                                            </span>\r\n                                                                            {isMedical04 && (\r\n                                                                              <Badge\r\n                                                                                variant=\"outline\"\r\n                                                                                className={`${isPrincipal ? 'bg-emerald-100 text-emerald-700 border-emerald-300' : 'bg-slate-100 text-slate-700 border-slate-300'} text-[10px]`}\r\n                                                                              >\r\n                                                                                 Mdico 04\r\n                                                                              </Badge>\r\n                                                                            )}\r\n                                                                            {isMedical04 && isPrincipal && (\r\n                                                                              <Badge variant=\"outline\" className=\"bg-emerald-50 text-emerald-800 border-emerald-200 text-[10px] font-bold\">\r\n                                                                                Principal\r\n                                                                              </Badge>\r\n                                                                            )}\r\n                                                                            {operaEligible && (\r\n                                                                              <Badge variant=\"outline\" className=\"bg-emerald-50 text-emerald-800 border-emerald-200 text-[10px] font-bold\">\r\n                                                                                Opera Paran +150%\r\n                                                                              </Badge>\r\n                                                                            )}\r\n                                                                            {!operaEligible && isMedical04 && diagReason && (\r\n                                                                              <Badge variant=\"outline\" className=\"bg-amber-50 text-amber-800 border-amber-200 text-[10px]\">\r\n                                                                                {diagReason}\r\n                                                                              </Badge>\r\n                                                                            )}\r\n                                                                            {(() => {\r\n                                                                              const anesthetistInfo = getAnesthetistProcedureType(procedure.cbo, procedure.procedure_code);\r\n                                                                              if (anesthetistInfo.isAnesthetist) {\r\n                                                                                return (\r\n                                                                                  <Badge\r\n                                                                                    variant={anesthetistInfo.badgeVariant}\r\n                                                                                    className={`${anesthetistInfo.badgeClass} text-[10px] ${anesthetistInfo.shouldCalculate ? '' : 'animate-pulse'}`}\r\n                                                                                  >\r\n                                                                                    {anesthetistInfo.badge}\r\n                                                                                  </Badge>\r\n                                                                                );\r\n                                                                              }\r\n                                                                              return null;\r\n                                                                            })()}\r\n                                                                            {procedure.sequence && procedure.sequence > 1 && (\r\n                                                                              <Badge variant=\"outline\" className=\"bg-slate-100 text-slate-700 border-slate-300 text-[10px]\">\r\n                                                                                Seq. {procedure.sequence}\r\n                                                                              </Badge>\r\n                                                                            )}\r\n                                                                          </div>\r\n\r\n                                                                          {/* VALOR NO CABEALHO */}\r\n                                                                          <div className=\"text-right\">\r\n                                                                            {(() => {\r\n                                                                              const anesthetistInfo = getAnesthetistProcedureType(procedure.cbo, procedure.procedure_code);\r\n                                                                              if (operaEligible && (!anesthetistInfo.isAnesthetist || anesthetistInfo.shouldCalculate)) {\r\n                                                                                const base = procedure.value_reais || 0;\r\n                                                                                const increment = base * 1.5; // +150%\r\n                                                                                return (\r\n                                                                                  <div className=\"text-right\">\r\n                                                                                    <div className=\"text-[10px] text-slate-500 line-through\">{formatCurrency(base)}</div>\r\n                                                                                    <div className=\"text-base font-black text-emerald-700\">{formatCurrency(increment)}</div>\r\n                                                                                  </div>\r\n                                                                                );\r\n                                                                              }\r\n                                                                              if (anesthetistInfo.isAnesthetist && !anesthetistInfo.shouldCalculate) {\r\n                                                                                const base = procedure.value_reais || 0;\r\n                                                                                return (\r\n                                                                                  <div className=\"text-right\">\r\n                                                                                    <div className=\"text-base font-bold text-slate-900\">\r\n                                                                                      {formatCurrency(base)}\r\n                                                                                    </div>\r\n                                                                                    <div className=\"text-[10px] text-slate-500\">visualizao</div>\r\n                                                                                  </div>\r\n                                                                                );\r\n                                                                              } else {\r\n                                                                                //  PROCEDIMENTO NORMAL OU ANESTESISTA 03.xxx: Mostrar valor\r\n                                                                                return (\r\n                                                                                  <div className={`text-base font-bold ${isMedical04 && isPrincipal ? 'text-emerald-700' : 'text-slate-900'\r\n                                                                                    }`}>\r\n                                                                                    {formatCurrency(procedure.value_reais)}\r\n                                                                                  </div>\r\n                                                                                );\r\n                                                                              }\r\n                                                                            })()}\r\n                                                                          </div>\r\n                                                                        </div>\r\n\r\n                                                                        {/* CORPO DO PROCEDIMENTO */}\r\n                                                                        <div className=\"px-4 py-3\">\r\n                                                                          {/* DESCRIO */}\r\n                                                                          <div className=\"mb-3\">\r\n                                                                            <p className=\"text-sm text-slate-700 leading-relaxed\">\r\n                                                                              {(() => {\r\n                                                                                const current = String(procedure.procedure_description || '').trim()\r\n                                                                                const hasCurrent = current && current.toLowerCase() !== 'descrio no disponvel'\r\n                                                                                if (!useSihSource) return hasCurrent ? current : 'Descrio no disponvel'\r\n                                                                                const code = String(procedure.procedure_code || '')\r\n                                                                                const digits = code.replace(/\\D/g, '')\r\n                                                                                const formatted = `${digits.slice(0, 2)}.${digits.slice(2, 4)}.${digits.slice(4, 6)}.${digits.slice(6, 9)}-${digits.slice(9)}`\r\n                                                                                const csv = sigtapMap?.get(formatted) || sigtapMap?.get(digits)\r\n                                                                                return csv || (hasCurrent ? current : 'Descrio no disponvel')\r\n                                                                              })()}\r\n                                                                            </p>\r\n                                                                          </div>\r\n\r\n                                                                          {/* GRID DE INFORMAES (2 COLUNAS) */}\r\n                                                                          <div className=\"grid grid-cols-2 gap-x-6 gap-y-2 text-xs\">\r\n                                                                            {/* CBO */}\r\n                                                                            {procedure.cbo && (\r\n                                                                              <div>\r\n                                                                                <span className=\"text-slate-500 font-medium uppercase tracking-wide\">CBO:</span>\r\n                                                                                <Badge\r\n                                                                                  variant=\"outline\"\r\n                                                                                  className={`ml-2 text-[10px] ${procedure.cbo === '225151' ? 'bg-gradient-to-r from-purple-500 to-fuchsia-500 text-white border-0' : 'bg-slate-100 text-slate-700 border-slate-300'}`}\r\n                                                                                >\r\n                                                                                  {procedure.cbo}\r\n                                                                                </Badge>\r\n                                                                              </div>\r\n                                                                            )}\r\n\r\n                                                                            {procedure.procedure_date && (\r\n                                                                              <div>\r\n                                                                                <span className=\"text-slate-500 font-medium uppercase tracking-wide\">Data:</span>\r\n                                                                                <span className=\"ml-2 text-slate-900 font-medium\">{parseISODateToLocal(procedure.procedure_date)}</span>\r\n                                                                              </div>\r\n                                                                            )}\r\n                                                                            {typeof (procedure as any).quantity !== 'undefined' && (\r\n                                                                              <div>\r\n                                                                                <span className=\"text-slate-500 font-medium uppercase tracking-wide\">Qtd. atos:</span>\r\n                                                                                <span className=\"ml-2 text-slate-900 font-medium\">{formatNumber((procedure as any).quantity)}</span>\r\n                                                                              </div>\r\n                                                                            )}\r\n                                                                            {procedure.cid_primary && (\r\n                                                                              <div>\r\n                                                                                <span className=\"text-slate-500 font-medium uppercase tracking-wide\">CID:</span>\r\n                                                                                <span className=\"ml-2 text-slate-900 font-medium\">{procedure.cid_primary}</span>\r\n                                                                              </div>\r\n                                                                            )}\r\n\r\n                                                                            {/* PROFISSIONAL */}\r\n                                                                            {procedure.professional_name && (\r\n                                                                              <div className=\"col-span-2\">\r\n                                                                                <span className=\"text-slate-500 font-medium uppercase tracking-wide\">Profissional:</span>\r\n                                                                                <span className=\"ml-2 text-slate-900\">{procedure.professional_name}</span>\r\n                                                                              </div>\r\n                                                                            )}\r\n\r\n                                                                            {/* PARTICIPAO */}\r\n                                                                            {procedure.participation && (\r\n                                                                              <div>\r\n                                                                                <span className=\"text-slate-500 font-medium uppercase tracking-wide\">Participao:</span>\r\n                                                                                <span className=\"ml-2 text-slate-900\">{procedure.participation}</span>\r\n                                                                              </div>\r\n                                                                            )}\r\n\r\n                                                                            {/* COMPLEXIDADE */}\r\n                                                                            {procedure.complexity && (\r\n                                                                              <div>\r\n                                                                                <span className=\"text-slate-500 font-medium uppercase tracking-wide\">Complexidade:</span>\r\n                                                                                <span className=\"ml-2 text-slate-900\">{procedure.complexity}</span>\r\n                                                                              </div>\r\n                                                                            )}\r\n                                                                          </div>\r\n                                                                        </div>\r\n                                                                      </div>\r\n                                                                    );\r\n                                                                  })}\r\n                                                              </div>\r\n                                                            )}\r\n\r\n                                                            {/*  COMPONENTE DE REGRAS DE PAGAMENTO ESPECFICAS */}\r\n                                                            {patient.procedures.filter(proc =>\r\n                                                              isMedicalProcedure(proc.procedure_code) &&\r\n                                                              shouldCalculateAnesthetistProcedure(proc.cbo, proc.procedure_code)\r\n                                                            ).length > 0 && (\r\n                                                                <DoctorPaymentRules\r\n                                                                  doctorName={doctor.doctor_info.name}\r\n                                                                  procedures={patient.procedures\r\n                                                                    .filter(proc =>\r\n                                                                      isMedicalProcedure(proc.procedure_code) &&\r\n                                                                      shouldCalculateAnesthetistProcedure(proc.cbo, proc.procedure_code)\r\n                                                                    )\r\n                                                                    .map(proc => ({\r\n                                                                      procedure_code: proc.procedure_code,\r\n                                                                      procedure_description: proc.procedure_description,\r\n                                                                      value_reais: proc.value_reais || 0,\r\n                                                                      cbo: proc.cbo\r\n                                                                    }))}\r\n                                                                  hospitalId={getDoctorContextualHospitalId(doctor)}\r\n                                                                  className=\"mt-5\"\r\n                                                                  useCsvHon={ENV_CONFIG.USE_SIH_SOURCE && /cirurg/i.test(doctor.doctor_info.specialty || '') && /geral/i.test(doctor.doctor_info.specialty || '')}\r\n                                                                />\r\n                                                              )}\r\n                                                          </div>\r\n                                                        </CollapsibleContent>\r\n                                                      </Collapsible>\r\n                                                    </div>\r\n                                                  );\r\n                                                })}\r\n\r\n                                                {/*  CONTROLES DE PAGINAO */}\r\n                                                {totalPages > 1 && (\r\n                                                  <div className=\"flex items-center justify-between mt-6 pt-4 border-t border-slate-200/60\">\r\n                                                    <div className=\"text-sm text-slate-600\">\r\n                                                      Mostrando {startIndex + 1}-{Math.min(endIndex, doctor.patients.length)} de {doctor.patients.length} pacientes\r\n                                                    </div>\r\n                                                    <div className=\"flex items-center gap-2\">\r\n                                                      <button\r\n                                                        onClick={() => {\r\n                                                          const newPage = Math.max(1, currentPage - 1);\r\n                                                          const newMap = new Map(currentPatientPage);\r\n                                                          newMap.set(doctorKey, newPage);\r\n                                                          setCurrentPatientPage(newMap);\r\n                                                        }}\r\n                                                        disabled={currentPage === 1}\r\n                                                        className=\"px-3 py-1 text-sm border border-slate-300 rounded-md hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                                                      >\r\n                                                        Anterior\r\n                                                      </button>\r\n                                                      <span className=\"text-sm text-slate-600\">\r\n                                                        Pgina {currentPage} de {totalPages}\r\n                                                      </span>\r\n                                                      <button\r\n                                                        onClick={() => {\r\n                                                          const newPage = Math.min(totalPages, currentPage + 1);\r\n                                                          const newMap = new Map(currentPatientPage);\r\n                                                          newMap.set(doctorKey, newPage);\r\n                                                          setCurrentPatientPage(newMap);\r\n                                                        }}\r\n                                                        disabled={currentPage === totalPages}\r\n                                                        className=\"px-3 py-1 text-sm border border-slate-300 rounded-md hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                                                      >\r\n                                                        Prxima\r\n                                                      </button>\r\n                                                    </div>\r\n                                                  </div>\r\n                                                )}\r\n                                              </>\r\n                                            );\r\n                                          })()}\r\n                                        </>\r\n                                      );\r\n                                    })()}\r\n                                  </div>\r\n                                </div>\r\n                              </div>\r\n                            </CollapsibleContent>\r\n                          </Collapsible>\r\n                        </Card>\r\n                      );\r\n                    })}\r\n\r\n                    {/*  CONTROLES DE PAGINAO DOS MDICOS */}\r\n                    {totalPages > 1 && (\r\n                      <div className=\"flex items-center justify-between mt-8 pt-6 border-t border-slate-200/60\">\r\n                        <div className=\"text-sm text-slate-600\">\r\n                          Mostrando {startIndex + 1}-{Math.min(endIndex, totalDoctors)} de {totalDoctors} mdicos\r\n                        </div>\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => setCurrentDoctorPage(prev => Math.max(1, prev - 1))}\r\n                            disabled={currentDoctorPage === 1}\r\n                            className=\"h-8 w-8 p-0\"\r\n                          >\r\n                            <ChevronLeft className=\"h-4 w-4\" />\r\n                          </Button>\r\n\r\n                          <div className=\"flex items-center gap-1\">\r\n                            {Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (\r\n                              <Button\r\n                                key={page}\r\n                                variant={currentDoctorPage === page ? \"default\" : \"outline\"}\r\n                                size=\"sm\"\r\n                                onClick={() => setCurrentDoctorPage(page)}\r\n                                className=\"h-8 w-8 p-0\"\r\n                              >\r\n                                {page}\r\n                              </Button>\r\n                            ))}\r\n                          </div>\r\n\r\n                          <Button\r\n                            variant=\"outline\"\r\n                            size=\"sm\"\r\n                            onClick={() => setCurrentDoctorPage(prev => Math.min(totalPages, prev + 1))}\r\n                            disabled={currentDoctorPage === totalPages}\r\n                            className=\"h-8 w-8 p-0\"\r\n                          >\r\n                            <ChevronRight className=\"h-4 w-4\" />\r\n                          </Button>\r\n                        </div>\r\n                      </div>\r\n                    )}\r\n                  </>\r\n                );\r\n              })()\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n      {/* Modal: Report Generator (SUS) */}\r\n      <Dialog open={reportModalOpen} onOpenChange={setReportModalOpen}>\r\n        <DialogContent className=\"max-w-3xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Relatrio SUS</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"mt-2\">\r\n            <ReportGenerator\r\n              preset={{\r\n                type: 'sus-report',\r\n                hospitalId: reportPreset?.hospitalId,\r\n                doctorName: reportPreset?.doctorName,\r\n                startDate: (reportPreset as any)?.startDate,\r\n                endDate: (reportPreset as any)?.endDate,\r\n                lock: true\r\n              }}\r\n              onClose={() => setReportModalOpen(false)}\r\n            />\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <Dialog open={zeroRepasseOpen} onOpenChange={setZeroRepasseOpen}>\r\n        <DialogContent className=\"max-w-5xl w-[90vw]\">\r\n          <DialogHeader>\r\n            <DialogTitle>Pacientes sem repasse  {zeroRepasseDoctorName}</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"flex justify-end mb-3\">\r\n            <Button onClick={exportZeroRepasseExcel} className=\"inline-flex items-center gap-2 bg-[#0b1736] hover:bg-[#09122a] text-white h-8 px-3 rounded-md text-xs\">\r\n              <FileSpreadsheet className=\"h-3 w-3\" />\r\n              Exportar Excel\r\n            </Button>\r\n          </div>\r\n          <div>\r\n            <table className=\"w-full text-sm\">\r\n              <thead>\r\n                <tr className=\"text-xs text-gray-600\">\r\n                  <th className=\"text-left p-2\">Pronturio</th>\r\n                  <th className=\"text-left p-2\">N AIH</th>\r\n                  <th className=\"text-left p-2\">Nome</th>\r\n                  <th className=\"text-left p-2\">Procedimentos</th>\r\n                  <th className=\"text-left p-2\">Data Alta</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {zeroRepasseItems.map((it, idx) => (\r\n                  <tr key={idx} className={idx % 2 === 0 ? 'bg-gray-50' : ''}>\r\n                    <td className=\"p-2\">{it.medicalRecord}</td>\r\n                    <td className=\"p-2\">{it.aihNumber}</td>\r\n                    <td className=\"p-2\">{it.name}</td>\r\n                    <td className=\"p-2\">{it.procedures}</td>\r\n                    <td className=\"p-2\">{it.discharge}</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n      <Dialog open={simplifiedValidationOpen} onOpenChange={setSimplifiedValidationOpen}>\r\n        <DialogContent className=\"max-w-xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>Validao do Relatrio Simplificado</DialogTitle>\r\n          </DialogHeader>\r\n          <div className=\"space-y-3\">\r\n            {simplifiedValidationLoading ? (\r\n              <div className=\"flex items-center gap-2 text-sm text-gray-600\">\r\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\r\n                Validando AIHs no DATASUS...\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <div className=\"text-sm text-gray-700\">\r\n                  <div className=\"font-semibold\">Mdico: <span className=\"text-gray-900\">{selectedDoctorForReport?.doctor_info?.name}</span></div>\r\n                  <div>Hospital: {selectedDoctorForReport?.hospitals?.[0]?.hospital_name || ''}</div>\r\n                </div>\r\n                <div className=\"grid grid-cols-3 gap-3 text-sm\">\r\n                  <div className=\"bg-gray-50 rounded p-2 border\">\r\n                    <div className=\"text-gray-500\">AIHs Locais</div>\r\n                    <div className=\"text-lg font-bold text-blue-700\">{simplifiedValidationStats?.total ?? 0}</div>\r\n                  </div>\r\n                  <div className=\"bg-gray-50 rounded p-2 border\">\r\n                    <div className=\"text-gray-500\">Homologadas (SIH)</div>\r\n                    <div className=\"text-lg font-bold text-emerald-700\">{simplifiedValidationStats?.approved ?? 0}</div>\r\n                  </div>\r\n                  <div className=\"bg-gray-50 rounded p-2 border\">\r\n                    <div className=\"text-gray-500\">No Homologadas</div>\r\n                    <div className=\"text-lg font-bold text-red-700\">{simplifiedValidationStats?.notApproved ?? 0}</div>\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex items-center justify-end gap-2\">\r\n                  <Button variant=\"outline\" onClick={() => setSimplifiedValidationOpen(false)}>Cancelar</Button>\r\n                  <Button onClick={async () => { setSimplifiedValidationOpen(false); await generateSimplifiedReport(selectedDoctorForReport, false); }}>Gerar Produo (todos)</Button>\r\n                  <Button className=\"bg-black hover:bg-neutral-800 text-white\" onClick={async () => { setSimplifiedValidationOpen(false); await generateSimplifiedReport(selectedDoctorForReport, true); }}>Gerar Homologadas (SIH)</Button>\r\n                </div>\r\n              </>\r\n            )}\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MedicalProductionDashboard;\r\nconst generateValidationReport = async (\r\n  selectedHospitals: string[] | undefined,\r\n  selectedCompetencia: string | undefined,\r\n  useSihSource: boolean,\r\n  filteredDoctors: any[]\r\n) => {\r\n  try {\r\n    const normalizeAih = (s: string) => s.replace(/\\D/g, '').replace(/^0+/, '')\r\n    const hospitalIds = selectedHospitals?.filter(h => h !== 'all') || []\r\n    const competenciaFilter = (selectedCompetencia && selectedCompetencia !== 'all' && selectedCompetencia.trim()) ? selectedCompetencia.trim() : undefined\r\n\r\n    // Local AIHs com nome (por hospital/competncia)\r\n    let localQuery = supabase\r\n      .from('aihs')\r\n      .select('aih_number, hospital_id, competencia, patients(name)')\r\n    if (hospitalIds.length > 0) localQuery = localQuery.in('hospital_id', hospitalIds)\r\n    if (competenciaFilter) localQuery = localQuery.eq('competencia', competenciaFilter)\r\n    const { data: localRows } = await localQuery\r\n    const localNameByAih = new Map<string, { name: string; hospital_id?: string; competencia?: string }>()\r\n      ; (localRows || []).forEach((r: any) => {\r\n        const k = normalizeAih(String(r.aih_number || ''))\r\n        const nm = String(r?.patients?.name || '')\r\n        if (k) localNameByAih.set(k, { name: nm, hospital_id: r.hospital_id, competencia: r.competencia })\r\n      })\r\n    const localSet = new Set(localNameByAih.keys())\r\n\r\n    // Remoto (produo) por hospital/competncia\r\n    let remoteSet = new Set<string>()\r\n    let remoteMetaByAih = new Map<string, { hospital_id?: string; competencia?: string }>()\r\n    if (useSihSource) {\r\n      try {\r\n        const { SihApiAdapter } = await import('../services/sihApiAdapter')\r\n        const remoteDocs = await SihApiAdapter.getDoctorsWithPatients({ hospitalIds, competencia: competenciaFilter })\r\n        remoteDocs.forEach((d: any) => {\r\n          (d.patients || []).forEach((p: any) => {\r\n            const k = normalizeAih(String(p?.aih_info?.aih_number || ''))\r\n            if (!k) return\r\n            remoteSet.add(k)\r\n            if (!remoteMetaByAih.has(k)) remoteMetaByAih.set(k, { hospital_id: p?.aih_info?.hospital_id, competencia: p?.aih_info?.competencia })\r\n          })\r\n        })\r\n      } catch { }\r\n    }\r\n\r\n    // Remoto (homologao) sem filtro de competncia\r\n    const { supabaseSih } = await import('../lib/sihSupabase')\r\n    const allKeys = Array.from(new Set([...remoteSet, ...localSet])).filter(Boolean)\r\n    const approvedSet = new Set<string>()\r\n    const chunkSize = 80\r\n    for (let i = 0; i < allKeys.length; i += chunkSize) {\r\n      const ch = allKeys.slice(i, i + chunkSize)\r\n      const { data: spRows } = await supabaseSih\r\n        .from('sih_sp')\r\n        .select('sp_naih')\r\n        .in('sp_naih', ch)\r\n        ; (spRows || []).forEach((r: any) => {\r\n          const k = normalizeAih(String(r.sp_naih || ''))\r\n          if (k) approvedSet.add(k)\r\n        })\r\n    }\r\n\r\n    // Conjuntos\r\n    const missingLocal = Array.from(remoteSet).filter(k => !localSet.has(k))\r\n    const pendingApproved = Array.from(localSet).filter(k => !approvedSet.has(k))\r\n\r\n    // Exportar Excel\r\n    const rowsMissingLocal: any[] = [['N AIH', 'Hospital', 'Competncia (produo)']]\r\n    missingLocal.forEach(k => {\r\n      const meta = remoteMetaByAih.get(k)\r\n      const hospName = (() => {\r\n        try {\r\n          const card = filteredDoctors.find((d: any) => (d.hospitals?.[0]?.hospital_id || '') === (meta?.hospital_id || ''))\r\n          return card?.hospitals?.[0]?.hospital_name || meta?.hospital_id || ''\r\n        } catch { return meta?.hospital_id || '' }\r\n      })()\r\n      rowsMissingLocal.push([k, hospName, formatCompetencia(String(meta?.competencia || ''))])\r\n    })\r\n\r\n    const rowsPendingApproved: any[] = [['N AIH', 'Hospital', 'Competncia (produo)', 'Paciente']]\r\n    pendingApproved.forEach(k => {\r\n      const local = localNameByAih.get(k)\r\n      const hospName = (() => {\r\n        try {\r\n          const card = filteredDoctors.find((d: any) => (d.hospitals?.[0]?.hospital_id || '') === (local?.hospital_id || ''))\r\n          return card?.hospitals?.[0]?.hospital_name || local?.hospital_id || ''\r\n        } catch { return local?.hospital_id || '' }\r\n      })()\r\n      rowsPendingApproved.push([k, hospName, formatCompetencia(String(local?.competencia || '')), local?.name || ''])\r\n    })\r\n\r\n    const wb = XLSX.utils.book_new()\r\n    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(rowsMissingLocal), 'Sem insero local')\r\n    XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(rowsPendingApproved), 'Pendentes SIH')\r\n    const fileName = `Validacao_Local_vs_Remoto_${formatDateFns(new Date(), 'yyyyMMdd_HHmm')}.xlsx`\r\n    XLSX.writeFile(wb, fileName)\r\n    toast.success('Relatrio de validao gerado com sucesso!')\r\n  } catch (e) {\r\n    console.error('Erro ao gerar relatrio de validao:', e)\r\n    toast.error('Erro ao gerar relatrio de validao')\r\n  }\r\n}\r\n","usedDeprecatedRules":[]}]