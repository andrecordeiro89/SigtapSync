<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - CorreÃ§Ã£o LÃ³gica Sequencial SUS</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 10px 0; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .procedure { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; margin: 5px 0; border-radius: 4px; }
        .badge { padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .instrument04 { background-color: #e3f2fd; color: #1976d2; }
        .normal { background-color: #f3e5f5; color: #7b1fa2; }
        .special { background-color: #fff3e0; color: #f57c00; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Teste - CorreÃ§Ã£o da LÃ³gica Sequencial SUS</h1>
    
    <div class="card info">
        <h2>ğŸ“‹ CenÃ¡rio de Teste</h2>
        <p><strong>AIH com 3 procedimentos:</strong></p>
        <ol>
            <li><strong>04.08.01.014-2</strong> - REPARO DE ROTURA DO MANGUITO ROTADOR (Procedimento Normal)</li>
            <li><strong>07.02.03.002-3</strong> - ANCORA (Instrumento 04)</li>
            <li><strong>04.08.06.071-9</strong> - VIDEOARTROSCOPIA (Instrumento 04)</li>
        </ol>
    </div>

    <div class="card error">
        <h2>âŒ LÃ³gica ANTERIOR (Incorreta)</h2>
        <div class="procedure">
            <strong>1Âº - 04.08.01.014-2</strong><br>
            Porcentagem: <strong>100%</strong> (primeira posiÃ§Ã£o sequencial geral)<br>
            <span class="badge normal">Procedimento Normal</span>
        </div>
        <div class="procedure">
            <strong>2Âº - 07.02.03.002-3</strong><br>
            Porcentagem: <strong>75%</strong> âŒ (segunda posiÃ§Ã£o sequencial geral - ERRO!)<br>
            <span class="badge instrument04">Instrumento 04</span>
        </div>
        <div class="procedure">
            <strong>3Âº - 04.08.06.071-9</strong><br>
            Porcentagem: <strong>50%</strong> âŒ (terceira posiÃ§Ã£o sequencial geral - ERRO!)<br>
            <span class="badge instrument04">Instrumento 04</span>
        </div>
        <p><strong>Problema:</strong> Instrumento 04 nÃ£o deveria seguir sequÃªncia - sempre deve ser 100%!</p>
    </div>

    <div class="card success">
        <h2>âœ… LÃ³gica CORRIGIDA (Atual)</h2>
        
        <h3>ğŸ”„ ClassificaÃ§Ã£o dos Procedimentos:</h3>
        <ul>
            <li><strong>ğŸ¯ Instrumento 04:</strong> [2Âº - 07.02.03.002-3, 3Âº - 04.08.06.071-9]</li>
            <li><strong>ğŸ¥ Regras Especiais:</strong> []</li>
            <li><strong>ğŸ“Š Procedimentos Normais:</strong> [1Âº - 04.08.01.014-2]</li>
        </ul>

        <h3>ğŸ“Š AplicaÃ§Ã£o das Regras:</h3>
        <div class="procedure">
            <strong>1Âº - 04.08.01.014-2</strong><br>
            Porcentagem: <strong>100%</strong> âœ… (1Âº procedimento entre normais)<br>
            <span class="badge normal">Procedimento Normal</span><br>
            <em>Regra: 1Âº procedimento normal = 100%</em>
        </div>
        <div class="procedure">
            <strong>2Âº - 07.02.03.002-3</strong><br>
            Porcentagem: <strong>100%</strong> âœ… (Instrumento 04 - sempre 100%)<br>
            <span class="badge instrument04">Instrumento 04</span><br>
            <em>Regra: Instrumento 04 - AIH (Proc. Especial) - Sempre 100%</em>
        </div>
        <div class="procedure">
            <strong>3Âº - 04.08.06.071-9</strong><br>
            Porcentagem: <strong>100%</strong> âœ… (Instrumento 04 - sempre 100%)<br>
            <span class="badge instrument04">Instrumento 04</span><br>
            <em>Regra: Instrumento 04 - AIH (Proc. Especial) - Sempre 100%</em>
        </div>
    </div>

    <div class="card info">
        <h2>ğŸ¯ Hierarquia das Regras Implementada</h2>
        <ol>
            <li><strong>PRIORIDADE 1:</strong> Instrumento 04 - Sempre 100% (SH, SP, SA)</li>
            <li><strong>PRIORIDADE 2:</strong> Regras especiais de cirurgias mÃºltiplas/sequenciais</li>
            <li><strong>PRIORIDADE 3:</strong> Regras padrÃ£o (100% para 1Âº normal, 70% para demais normais)</li>
        </ol>
    </div>

    <div class="card">
        <h2>ğŸ—ï¸ ImplementaÃ§Ã£o TÃ©cnica</h2>
        <h3>Arquivo: <code>src/components/AIHMultiPageTester.tsx</code></h3>
        <h4>FunÃ§Ã£o <code>calculateTotalsWithPercentage()</code>:</h4>
        <ul>
            <li>âœ… ClassificaÃ§Ã£o inteligente por tipo de procedimento</li>
            <li>âœ… CÃ¡lculo de posiÃ§Ã£o sequencial independente por categoria</li>
            <li>âœ… Logs detalhados para debug</li>
        </ul>
        
        <h4>Console Output Esperado:</h4>
        <pre style="background-color: #f8f9fa; padding: 10px; border-radius: 4px;">
ğŸ”„ CLASSIFICAÃ‡ÃƒO DOS PROCEDIMENTOS:
ğŸ¯ Instrumento 04: ['2Âº - 07.02.03.002-3', '3Âº - 04.08.06.071-9']
ğŸ¥ Regras Especiais: []
ğŸ“Š Procedimentos Normais: ['1Âº - 04.08.01.014-2']

ğŸ¯ INSTRUMENTO 04 - 07.02.03.002-3 (2Âº): SEMPRE 100%
ğŸ¯ INSTRUMENTO 04 - 04.08.06.071-9 (3Âº): SEMPRE 100%
ğŸ“Š PROCEDIMENTO NORMAL - 04.08.01.014-2 (1Âº na AIH, 1Âº entre normais): 100%
        </pre>
    </div>

    <script>
        // Simular funÃ§Ã£o de teste
        function testarLogicaSequencial() {
            console.log('ğŸ§ª TESTE - LÃ³gica Sequencial Corrigida');
            
            const procedimentos = [
                {
                    sequencia: 1,
                    codigo: '04.08.01.014-2',
                    nome: 'REPARO DE ROTURA DO MANGUITO ROTADOR',
                    tipo: 'NORMAL',
                    instrumentoSigtap: 'NÃ£o informado'
                },
                {
                    sequencia: 2,
                    codigo: '07.02.03.002-3',
                    nome: 'ANCORA',
                    tipo: 'INSTRUMENTO_04',
                    instrumentoSigtap: '04 - AIH (Proc. Especial)'
                },
                {
                    sequencia: 3,
                    codigo: '04.08.06.071-9',
                    nome: 'VIDEOARTROSCOPIA',
                    tipo: 'INSTRUMENTO_04',
                    instrumentoSigtap: '04 - AIH (Proc. Especial)'
                }
            ];
            
            console.log('ğŸ“‹ Procedimentos:', procedimentos);
            
            // Simular classificaÃ§Ã£o
            const instrumento04 = procedimentos.filter(p => p.tipo === 'INSTRUMENTO_04');
            const normais = procedimentos.filter(p => p.tipo === 'NORMAL');
            
            console.log('ğŸ¯ Instrumento 04:', instrumento04.map(p => `${p.sequencia}Âº - ${p.codigo}`));
            console.log('ğŸ“Š Procedimentos Normais:', normais.map(p => `${p.sequencia}Âº - ${p.codigo}`));
            
            // Simular aplicaÃ§Ã£o das regras
            procedimentos.forEach(proc => {
                if (proc.tipo === 'INSTRUMENTO_04') {
                    console.log(`ğŸ¯ ${proc.codigo} (${proc.sequencia}Âº): 100% - Instrumento 04`);
                } else {
                    const posicaoEntreNormais = normais.findIndex(n => n.sequencia === proc.sequencia) + 1;
                    const porcentagem = posicaoEntreNormais === 1 ? 100 : 70;
                    console.log(`ğŸ“Š ${proc.codigo} (${proc.sequencia}Âº): ${porcentagem}% - ${posicaoEntreNormais}Âº entre normais`);
                }
            });
            
            return 'âœ… Teste concluÃ­do - verifique o console!';
        }
        
        // Executar teste automaticamente
        console.log(testarLogicaSequencial());
    </script>
</body>
</html> 